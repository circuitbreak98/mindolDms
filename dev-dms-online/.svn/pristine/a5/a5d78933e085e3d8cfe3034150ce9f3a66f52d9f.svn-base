<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="DEPReportMgmt">
	<select id="SMthSaleList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SMthSaleList 월별판매현황조회 */
/* IO: 정동현,2015-10-16T15:16:02(정동현,2015-09-24T14:17:37) */
WITH  TMP_A  AS (
SELECT  #SELL_YR#  AS  SELL_YR
       ,SUBSTR(A.SELL_DTM,5,6)  AS  SELL_DTM
       ,NVL(A.SELL_TYP,B.NUM)  AS  SELL_TYP
       ,A.SELL_QTY
       ,A.SELL_PRC
       ,A.SELL_PCOST
  FROM(
       SELECT  SUBSTR(IA.SELL_DTM,0,6)  AS  SELL_DTM
              ,DECODE(IA.SELL_TYP,'03','02',IA.SELL_TYP) SELL_TYP
              ,NVL(COUNT(IB.GNRL_SELL_NO),0) AS SELL_QTY                                         /* 판매 건수*/
              ,NVL(SUM(IB.SELL_PRC),0) AS SELL_PRC                                               /* 판매금액 */
             /*, NVL(SUM(IB.SELL_UPRC),0) AS 판매단가 */
             ,NVL(SUM(IB.SELL_PCOST),0) AS SELL_PCOST                                            /* 매입금액 */
        FROM  TB_EP_SAL_GNRL_SALE  IA
             ,TB_EP_SAL_EQUIPMENT_SALE  IB
       WHERE  IA.SELL_DTM >= #SELL_YR# || '0101000000'
         AND  IA.SELL_DTM <= #SELL_YR#  || '1231240000'
         AND  IA.SELL_CNCL_YN <> 'Y'
         AND  IA.SELL_TYP IN ('01','02','03')
         AND  IA.GNRL_SELL_NO = IB.GNRL_SELL_NO
         AND  IA.GNRL_SELL_CHG_SEQ = IB.GNRL_SELL_CHG_SEQ
         AND  IB.EQP_MDL_CD IS NOT NULL 
       GROUP  BY  SUBSTR(IA.SELL_DTM,0,6), IA.SELL_TYP
       ORDER  BY  SUBSTR(IA.SELL_DTM,0,6) DESC
      )  A
        ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=2 ) B 
 WHERE  A.SELL_TYP(+)= B.NUM
)
SELECT  C.* 
  FROM(
        SELECT  TMP_A.SELL_YR
               ,'01' AS  DATA_GB /*판매(건)*/
               ,GROUPING(TMP_A.SELL_TYP)  AS  G_ID
               ,TMP_A.SELL_TYP
               ,NVL(SUM(SELL_QTY),0)  AS  RSLT_SUM
               ,NVL(ROUND(SUM(SELL_QTY)/#MTH_CNT#),0)  AS  MTH_AVG   
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'01',SELL_QTY )),0)  AS  MTH_1
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'02',SELL_QTY )),0)  AS  MTH_2
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'03',SELL_QTY )),0)  AS  MTH_3
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'04',SELL_QTY )),0)  AS  MTH_4
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'05',SELL_QTY )),0)  AS  MTH_5
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'06',SELL_QTY )),0)  AS  MTH_6
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'07',SELL_QTY )),0)  AS  MTH_7
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'08',SELL_QTY )),0)  AS  MTH_8
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'09',SELL_QTY )),0)  AS  MTH_9
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'10',SELL_QTY )),0)  AS  MTH_10
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'11',SELL_QTY )),0)  AS  MTH_11
               ,NVL(SUM(DECODE(TMP_A.SELL_DTM ,'12',SELL_QTY )),0)  AS  MTH_12
          FROM  TMP_A
         GROUP  BY TMP_A.SELL_YR,ROLLUP(TMP_A.SELL_TYP)
        UNION ALL
        SELECT  TMP_A.SELL_YR
               ,'02'  AS  DATA_GB /*판매금액(백만원)*/
               ,GROUPING(TMP_A.SELL_TYP)  AS  G_ID
               ,TMP_A.SELL_TYP
               ,NVL(ROUND(SUM(SELL_PRC)/1000000),0)  AS RSLT_SUM
               ,NVL(ROUND((SUM(SELL_PRC)/#MTH_CNT#)/1000000),0)  AS  MTH_AVG 
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '01',SELL_PRC ))/1000000),0) AS  MTH_1
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '02',SELL_PRC ))/1000000),0) AS  MTH_2
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '03',SELL_PRC ))/1000000),0) AS  MTH_3 
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '04',SELL_PRC ))/1000000),0) AS  MTH_4 
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '05',SELL_PRC ))/1000000),0) AS  MTH_5 
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '06',SELL_PRC ))/1000000),0) AS  MTH_6 
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '07',SELL_PRC ))/1000000),0) AS  MTH_7 
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '08',SELL_PRC ))/1000000),0) AS  MTH_8 
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '09',SELL_PRC ))/1000000),0) AS  MTH_9 
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '10',SELL_PRC ))/1000000),0) AS  MTH_10
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '11',SELL_PRC ))/1000000),0) AS  MTH_11
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM, '12',SELL_PRC ))/1000000),0) AS  MTH_12
          FROM  TMP_A
         GROUP  BY TMP_A.SELL_YR,ROLLUP(TMP_A.SELL_TYP)         
        UNION ALL
        SELECT  TMP_A.SELL_YR
               ,'03'  AS  DATA_GB /*판매단가(원)*/
               ,GROUPING(TMP_A.SELL_TYP)  AS  G_ID
               ,TMP_A.SELL_TYP
               ,NVL(ROUND(SUM(TMP_A.SELL_PRC)/SUM(TMP_A.SELL_QTY)),0) AS RSLT_SUM /* 판매단가 (판매금액/판매건) */
               ,NVL(ROUND((SUM(TMP_A.SELL_PRC)/#MTH_CNT#)/(SUM(TMP_A.SELL_QTY)/#MTH_CNT#)),0)  AS  MTH_AVG
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'01',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'01',SELL_QTY ))),0)  AS  MTH_1
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'02',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'02',SELL_QTY ))),0)  AS  MTH_2
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'03',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'03',SELL_QTY ))),0)  AS  MTH_3
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'04',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'04',SELL_QTY ))),0)  AS  MTH_4
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'05',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'05',SELL_QTY ))),0)  AS  MTH_5
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'06',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'06',SELL_QTY ))),0)  AS  MTH_6
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'07',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'07',SELL_QTY ))),0)  AS  MTH_7
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'08',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'08',SELL_QTY ))),0)  AS  MTH_8
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'09',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'09',SELL_QTY ))),0)  AS  MTH_9
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'10',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'10',SELL_QTY ))),0)  AS  MTH_10
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'11',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'11',SELL_QTY ))),0)  AS  MTH_11
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'12',SELL_PRC ))/SUM(DECODE(TMP_A.SELL_DTM ,'12',SELL_QTY ))),0)  AS  MTH_12
          FROM  TMP_A
         GROUP  BY TMP_A.SELL_YR,ROLLUP(TMP_A.SELL_TYP)      
        UNION ALL
        SELECT  TMP_A.SELL_YR
               ,'04'  AS  DATA_GB /*매입금액(백만원)*/
               ,GROUPING(TMP_A.SELL_TYP)  AS  G_ID
               ,TMP_A.SELL_TYP
               ,NVL( ROUND(SUM(TMP_A.SELL_PCOST)/1000000),0)  AS  RSLT_SUM
               ,NVL( ROUND((SUM(TMP_A.SELL_PCOST)/#MTH_CNT#)/1000000),0)  AS  MTH_AVG
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'01',SELL_PCOST ))/1000000),0) AS  MTH_1
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'02',SELL_PCOST ))/1000000),0) AS  MTH_2
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'03',SELL_PCOST ))/1000000),0) AS  MTH_3
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'04',SELL_PCOST ))/1000000),0) AS  MTH_4
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'05',SELL_PCOST ))/1000000),0) AS  MTH_5
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'06',SELL_PCOST ))/1000000),0) AS  MTH_6
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'07',SELL_PCOST ))/1000000),0) AS  MTH_7
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'08',SELL_PCOST ))/1000000),0) AS  MTH_8
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'09',SELL_PCOST ))/1000000),0) AS  MTH_9
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'10',SELL_PCOST ))/1000000),0) AS  MTH_10
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'11',SELL_PCOST ))/1000000),0) AS  MTH_11
               ,NVL(ROUND( SUM(DECODE(TMP_A.SELL_DTM ,'12',SELL_PCOST ))/1000000),0) AS  MTH_12
          FROM  TMP_A
         GROUP  BY TMP_A.SELL_YR,ROLLUP(TMP_A.SELL_TYP)
        UNION ALL
        SELECT  TMP_A.SELL_YR
               ,'05'  AS  DATA_GB /*매입단가(원)*/
               ,GROUPING(TMP_A.SELL_TYP)  AS  G_ID
               ,TMP_A.SELL_TYP
               ,NVL(ROUND(SUM(SELL_PCOST)/SUM(SELL_QTY)),0)  AS  RSLT_SUM    /* 매입단가 (매입금액/판매건수) */
               ,NVL(ROUND((SUM(SELL_PCOST)/#MTH_CNT#)/(SUM(SELL_QTY)/#MTH_CNT#)),0)  AS  MTH_AVG
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'01',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'01',TMP_A.SELL_QTY ))),0)  AS  MTH_1
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'02',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'02',TMP_A.SELL_QTY ))),0)  AS  MTH_2
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'03',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'03',TMP_A.SELL_QTY ))),0)  AS  MTH_3
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'04',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'04',TMP_A.SELL_QTY ))),0)  AS  MTH_4
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'05',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'05',TMP_A.SELL_QTY ))),0)  AS  MTH_5
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'06',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'06',TMP_A.SELL_QTY ))),0)  AS  MTH_6
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'07',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'07',TMP_A.SELL_QTY ))),0)  AS  MTH_7
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'08',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'08',TMP_A.SELL_QTY ))),0)  AS  MTH_8
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'09',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'09',TMP_A.SELL_QTY ))),0)  AS  MTH_9
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'10',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'10',TMP_A.SELL_QTY ))),0)  AS  MTH_10
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'11',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'11',TMP_A.SELL_QTY ))),0)  AS  MTH_11
               ,NVL(ROUND(SUM(DECODE(TMP_A.SELL_DTM ,'12',TMP_A.SELL_PCOST ))/SUM(DECODE(TMP_A.SELL_DTM ,'12',TMP_A.SELL_QTY ))),0)  AS  MTH_12
          FROM  TMP_A 
         GROUP  BY TMP_A.SELL_YR,ROLLUP(TMP_A.SELL_TYP)
        UNION ALL
        SELECT  TMP_A.SELL_YR
               ,'06'  AS  DATA_GB /*매출이익(백만원)*/
               ,GROUPING(TMP_A.SELL_TYP)  AS  G_ID
               ,TMP_A.SELL_TYP
               ,NVL(ROUND((SUM(SELL_PRC) -  SUM(SELL_PCOST))/1000000)  ,0)  AS  RSLT_SUM /* 매출이익 (판매금액-매입금액) */
               ,NVL(ROUND(((SUM(SELL_PRC)/#MTH_CNT#) -  (SUM(SELL_PCOST)/#MTH_CNT#))/1000000),0)  AS  MTH_AVG
        	   ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'01',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'01',SELL_PCOST)))/1000000),0)  AS  MTH_1
               ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'02',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'02',SELL_PCOST)))/1000000),0)  AS  MTH_2
               ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'03',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'03',SELL_PCOST)))/1000000),0)  AS  MTH_3
               ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'04',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'04',SELL_PCOST)))/1000000),0)  AS  MTH_4
               ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'05',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'05',SELL_PCOST)))/1000000),0)  AS  MTH_5
               ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'06',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'06',SELL_PCOST)))/1000000),0)  AS  MTH_6
               ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'07',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'07',SELL_PCOST)))/1000000),0)  AS  MTH_7
               ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'08',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'08',SELL_PCOST)))/1000000),0)  AS  MTH_8
               ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'09',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'09',SELL_PCOST)))/1000000),0)  AS  MTH_9
               ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'10',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'10',SELL_PCOST)))/1000000),0)  AS  MTH_10
               ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'11',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'11',SELL_PCOST)))/1000000),0)  AS  MTH_11
               ,NVL(ROUND((SUM(DECODE(TMP_A.SELL_DTM ,'12',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'12',SELL_PCOST)))/1000000),0)  AS  MTH_12
          FROM  TMP_A
         GROUP  BY TMP_A.SELL_YR,ROLLUP(TMP_A.SELL_TYP)
        UNION ALL
        SELECT  TMP_A.SELL_YR
               ,'07' AS DATA_GB /*매출이익률(%)*/
               ,GROUPING(TMP_A.SELL_TYP)  AS  G_ID
               ,TMP_A.SELL_TYP
               ,NVL(ROUND(((SUM(SELL_PRC)-SUM(SELL_PCOST))/SUM(SELL_PRC))*100,1),0)  AS  RSLT_SUM  /* 매출이익률 (매출이익/판매금액) */
               ,NVL(ROUND((((SUM(SELL_PRC)/#MTH_CNT#)-(SUM(SELL_PCOST)/#MTH_CNT#))/(SUM(SELL_PRC)/#MTH_CNT#))*100,1),0)  AS  MTH_AVG
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'01',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'01',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '01',SELL_PRC )))*100,1),0) AS  MTH_1
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'02',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'02',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '02',SELL_PRC )))*100,1),0) AS  MTH_2
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'03',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'03',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '03',SELL_PRC )))*100,1),0) AS  MTH_3
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'04',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'04',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '04',SELL_PRC )))*100,1),0) AS  MTH_4
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'05',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'05',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '05',SELL_PRC )))*100,1),0) AS  MTH_5
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'06',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'06',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '06',SELL_PRC )))*100,1),0) AS  MTH_6
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'07',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'07',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '07',SELL_PRC )))*100,1),0) AS  MTH_7
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'08',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'08',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '08',SELL_PRC )))*100,1),0) AS  MTH_8
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'09',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'09',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '09',SELL_PRC )))*100,1),0) AS  MTH_9
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'10',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'10',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '10',SELL_PRC )))*100,1),0) AS  MTH_10
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'11',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'11',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '11',SELL_PRC )))*100,1),0) AS  MTH_11
               ,NVL(ROUND(((SUM(DECODE(TMP_A.SELL_DTM ,'12',SELL_PRC))-SUM(DECODE(TMP_A.SELL_DTM ,'12',SELL_PCOST)))/SUM(DECODE(TMP_A.SELL_DTM, '12',SELL_PRC )))*100,1),0) AS  MTH_12
          FROM  TMP_A
         GROUP  BY TMP_A.SELL_YR,ROLLUP(TMP_A.SELL_TYP)
  )  C
 ORDER  BY C.DATA_GB,C.G_ID DESC,C.SELL_TYP]]>
	</select>
	<select id="SInqB2BSaleList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SInqB2BSaleList B2B판매실적현황조회 */
/* IO: 정동현,2015-10-16T15:22:50(박민정,2015-10-01T15:31:25) */
WITH  TMP_A  AS (
SELECT  SUBSTR(IA.SELL_DTM,0,6)  AS  SELL_DTM
        ,DECODE(nvl(IE.PROD_CHRTIC_1,'N'),'S','4','P','1','T','3','2') AS PHONE_TYP                                                     /* 분류(스마트폰,피처폰)*/  
        ,(CASE WHEN IE.PROD_CHRTIC_1 in ('S','T') OR IE.PROD_CHRTIC_1 in ('')
               THEN DECODE(IE.MFACT_CD,'SS','B','CG','A','LG','C','D')
               ELSE 'P'
          END) AS MFACT_TYP                                                                /* 제조사 구분*/ 
        ,NVL(COUNT(IB.GNRL_SELL_NO),0) AS SELL_QTY                                         /* 판매 건수*/
        ,NVL(SUM(IB.SELL_PRC),0) AS SELL_PRC                                               /* 판매금액 */
        ,NVL(SUM(IB.SELL_PCOST),0) AS SELL_PCOST                                            /* 매입금액 */
  FROM  TB_EP_SAL_GNRL_SALE  IA
       ,TB_EP_SAL_EQUIPMENT_SALE  IB
       ,TB_EQP_MDL IE
 WHERE  IA.SELL_DTM >= #SELL_YR# || '0101000000'
   AND  IA.SELL_DTM <= #SELL_YR# || '1231240000'
   AND  IA.SELL_CNCL_YN <> 'Y'
   AND  IA.SELL_TYP = '01'                             /* B2B 판매 */
                                                       /*태블릿과 분류없는 것은 제외*/
   AND  IA.GNRL_SELL_NO = IB.GNRL_SELL_NO
   AND  IA.GNRL_SELL_CHG_SEQ = IB.GNRL_SELL_CHG_SEQ
   AND  IB.EQP_MDL_CD = IE.EQP_MDL_CD
   AND  IB.EQP_MDL_CD IS NOT NULL 
 GROUP  BY  SUBSTR(IA.SELL_DTM,0,6), IE.PROD_CHRTIC_1, IE.MFACT_CD
 ORDER  BY  SUBSTR(IA.SELL_DTM,0,6)
)
SELECT  B.* 
  FROM(
        SELECT  #SELL_YR# AS  SELL_YR
               ,'01' AS  DATA_GB /*판매(건)*/
               ,PHONE_TYP    
               ,MFACT_TYP
               ,NVL(SUM(SELL_QTY),0)  AS  RSLT_SUM
               ,NVL(TRUNC(SUM(SELL_QTY)/12),0)  AS  MTH_AVG   
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_QTY )),0)  AS  MTH_1
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_QTY )),0)  AS  MTH_2
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_QTY )),0)  AS  MTH_3
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_QTY )),0)  AS  MTH_4
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_QTY )),0)  AS  MTH_5
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_QTY )),0)  AS  MTH_6
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_QTY )),0)  AS  MTH_7
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_QTY )),0)  AS  MTH_8
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_QTY )),0)  AS  MTH_9
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_QTY )),0)  AS  MTH_10
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_QTY )),0)  AS  MTH_11
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_QTY )),0)  AS  MTH_12
          FROM  TMP_A
         GROUP  BY SUBSTR(TMP_A.SELL_DTM,0,4), ROLLUP((TMP_A.PHONE_TYP ,TMP_A.MFACT_TYP))
        UNION ALL
        SELECT  #SELL_YR#  AS  SELL_YR
               ,'02'  AS  DATA_GB /*판매금액(백만원)*/
               ,PHONE_TYP    
               ,MFACT_TYP
               ,ROUND(NVL(TRUNC(SUM(SELL_PRC)),0)/1000000)  AS RSLT_SUM
               ,ROUND(NVL(TRUNC(SUM(SELL_PRC)/12),0)/1000000)   AS  MTH_AVG 
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_PRC ))),0)/1000000)  AS  MTH_1
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_PRC ))),0)/1000000)  AS  MTH_2
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_PRC ))),0)/1000000)  AS  MTH_3 
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_PRC ))),0)/1000000)  AS  MTH_4 
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_PRC ))),0)/1000000)  AS  MTH_5 
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_PRC ))),0)/1000000)  AS  MTH_6 
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_PRC ))),0)/1000000)  AS  MTH_7 
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_PRC ))),0)/1000000)  AS  MTH_8 
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_PRC ))),0)/1000000)  AS  MTH_9 
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_PRC ))),0)/1000000)  AS  MTH_10
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_PRC ))),0)/1000000)  AS  MTH_11
               ,ROUND(NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_PRC ))),0)/1000000)  AS  MTH_12
          FROM  TMP_A
         GROUP  BY SUBSTR(TMP_A.SELL_DTM,0,4), ROLLUP((TMP_A.PHONE_TYP ,TMP_A.MFACT_TYP))
        UNION ALL
        SELECT  #SELL_YR#  AS  SELL_YR
               ,'03'  AS  DATA_GB /*판매단가(원)*/
               ,PHONE_TYP    
               ,MFACT_TYP
               ,NVL(TRUNC(SUM(SELL_PRC)/SUM(SELL_QTY)),0) AS RSLT_SUM /* 판매단가 (판매금액/판매건) */
               ,NVL(TRUNC((SUM(SELL_PRC)/12)/(SUM(SELL_QTY)/12)),0)  AS  MTH_AVG
               ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_QTY ))),0)  AS  MTH_1
               ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_QTY ))),0)  AS  MTH_2
        	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_QTY ))),0)  AS  MTH_3
        	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_QTY ))),0)  AS  MTH_4
               ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_QTY ))),0)  AS  MTH_5
               ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_QTY ))),0)  AS  MTH_6
               ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_QTY ))),0)  AS  MTH_7
               ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_QTY ))),0)  AS  MTH_8
               ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_QTY ))),0)  AS  MTH_9
        	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_QTY ))),0)  AS  MTH_10
        	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_QTY ))),0)  AS  MTH_11
          	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_PRC )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_QTY ))),0)  AS  MTH_12	
          FROM  TMP_A
         GROUP  BY SUBSTR(TMP_A.SELL_DTM,0,4), ROLLUP((TMP_A.PHONE_TYP ,TMP_A.MFACT_TYP))
        UNION ALL
        SELECT  #SELL_YR#  AS  SELL_YR
               ,'04'  AS  DATA_GB /*매입금액(백만원)*/
               ,PHONE_TYP    
               ,MFACT_TYP
               ,ROUND(NVL( SUM(SELL_PCOST),0)/1000000)  AS  RSLT_SUM
               ,ROUND(NVL( SUM(SELL_PCOST)/12,0)/1000000)  AS  MTH_AVG
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_PCOST ))),0)/1000000) AS  MTH_1
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_PCOST ))),0)/1000000) AS  MTH_2
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_PCOST ))),0)/1000000) AS  MTH_3
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_PCOST ))),0)/1000000) AS  MTH_4
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_PCOST ))),0)/1000000) AS  MTH_5
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_PCOST ))),0)/1000000) AS  MTH_6
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_PCOST ))),0)/1000000) AS  MTH_7
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_PCOST ))),0)/1000000) AS  MTH_8
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_PCOST ))),0)/1000000) AS  MTH_9
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_PCOST ))),0)/1000000) AS  MTH_10
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_PCOST ))),0)/1000000) AS  MTH_11
               ,ROUND(NVL(TRUNC( SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_PCOST ))),0)/1000000) AS  MTH_12
          FROM  TMP_A
        GROUP  BY SUBSTR(TMP_A.SELL_DTM,0,4), ROLLUP((TMP_A.PHONE_TYP ,TMP_A.MFACT_TYP))
        UNION ALL
        SELECT  #SELL_YR#  AS  SELL_YR
               ,'05'  AS  DATA_GB /*매입단가(원)*/
               ,PHONE_TYP    
               ,MFACT_TYP
               ,NVL(TRUNC(SUM(SELL_PCOST) /SUM(SELL_QTY)),0)  AS  RSLT_SUM    /* 매입단가 (매입금액/판매건수) */
               ,NVL(TRUNC(  ( SUM(SELL_PCOST)/12)/(SUM(SELL_QTY)/12)  ),0)  AS  MTH_AVG
        	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_QTY ))),0)  AS  MTH_1
          	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_QTY ))),0)  AS  MTH_2
          	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_QTY ))),0)  AS  MTH_3
          	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_QTY ))),0)  AS  MTH_4
          	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_QTY ))),0)  AS  MTH_5
          	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_QTY ))),0)  AS  MTH_6
          	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_QTY ))),0)  AS  MTH_7
          	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_QTY ))),0)  AS  MTH_8
          	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_QTY ))),0)  AS  MTH_9
          	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_QTY ))),0)  AS  MTH_10
          	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_QTY ))),0)  AS  MTH_11
           	   ,NVL(TRUNC(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_PCOST )) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_QTY ))),0)  AS  MTH_12
          FROM  TMP_A
         GROUP  BY SUBSTR(TMP_A.SELL_DTM,0,4), ROLLUP((TMP_A.PHONE_TYP ,TMP_A.MFACT_TYP))
        UNION ALL
        SELECT  #SELL_YR#  AS  SELL_YR
               ,'06'  AS  DATA_GB /*매출이익(백만원)*/
               ,PHONE_TYP    
               ,MFACT_TYP
               ,ROUND(NVL(SUM(SELL_PRC) -  SUM(SELL_PCOST)  ,0)/1000000)  AS  RSLT_SUM /* 매출이익 (판매금액-매입금액) */
               ,ROUND(NVL((SUM(SELL_PRC)/12) -  (SUM(SELL_PCOST)/12),0)/1000000)  AS  MTH_AVG
        	   ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_PCOST )),0))/1000000)  AS  MTH_1
               ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_PCOST )),0))/1000000)  AS  MTH_2
        	   ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_PCOST )),0))/1000000)  AS  MTH_3
        	   ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_PCOST )),0))/1000000)  AS  MTH_4
          	   ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_PCOST )),0))/1000000)  AS  MTH_5
          	   ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_PCOST )),0))/1000000)  AS  MTH_6
        	   ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_PCOST )),0))/1000000)  AS  MTH_7
        	   ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_PCOST )),0))/1000000)  AS  MTH_8
          	   ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_PCOST )),0))/1000000)  AS  MTH_9
          	   ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_PCOST )),0))/1000000)  AS  MTH_10
          	   ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_PCOST )),0))/1000000)  AS  MTH_11
          	   ,ROUND((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_PCOST )),0))/1000000)  AS  MTH_12
          FROM  TMP_A
         GROUP  BY SUBSTR(TMP_A.SELL_DTM,0,4), ROLLUP((TMP_A.PHONE_TYP ,TMP_A.MFACT_TYP))
        UNION ALL
        SELECT  #SELL_YR# AS SELL_YR
               ,'07' AS DATA_GB /*매출이익률(%)*/
               ,PHONE_TYP    
               ,MFACT_TYP
               ,ROUND(NVL(((SUM(SELL_PRC) -  SUM(SELL_PCOST))/SUM(SELL_PRC)),0)*100)  AS  RSLT_SUM  /* 매출이익률 (매출이익/판매금액) */
               ,ROUND(NVL((((SUM(SELL_PRC)/12) -  (SUM(SELL_PCOST)/12))/(SUM(SELL_PRC)/12)),0)*100)  AS  MTH_AVG
        	   ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'01',SELL_PRC )),0),1)  AS  MTH_1
               ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'02',SELL_PRC )),0),1)  AS  MTH_2
        	   ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'03',SELL_PRC )),0),1)  AS  MTH_3
               ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'04',SELL_PRC )),0),1)  AS  MTH_4
               ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'05',SELL_PRC )),0),1)  AS  MTH_5
               ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'06',SELL_PRC )),0),1)  AS  MTH_6
               ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'07',SELL_PRC )),0),1)  AS  MTH_7
        	   ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'08',SELL_PRC )),0),1)  AS  MTH_8
               ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'09',SELL_PRC )),0),1)  AS  MTH_9
          	   ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'10',SELL_PRC )),0),1)  AS  MTH_10
          	   ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'11',SELL_PRC )),0),1)  AS  MTH_11
          	   ,ROUND(NVL(((NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_PRC )),0) - NVL(SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_PCOST )),0))) / SUM(DECODE(SUBSTR(TMP_A.SELL_DTM,5,6) ,'12',SELL_PRC )),0),1)  AS  MTH_12
          FROM  TMP_A
         GROUP  BY SUBSTR(TMP_A.SELL_DTM,0,4), ROLLUP((TMP_A.PHONE_TYP ,TMP_A.MFACT_TYP))
       )  B
 ORDER  BY B.DATA_GB, B.PHONE_TYP DESC, B.MFACT_TYP]]>
	</select>
	<select id="SDirPrchList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SDirPrchList 직매입현황조회 */
/* IO: 정동현,2015-10-12T16:52:28(정동현,2015-10-05T19:32:21) */
WITH  TMP_A  AS  (
                    SELECT  A.CNSL_YM                         /* 조회년도 */
                           ,B.NUM AS DEALCO_TYP               /* 매입유형 */
                           ,A.CNSL_CNT                        /* 접수건수 */
                           ,A.CLCT_CNT                        /* 회수건수 */
                           ,A.TLY_CNT                         /* 감정건수 */
                           ,A.JDG_AMT_SUM                     /* 감정금액 (매입금액 - 조정금액)*/
                           ,NVL(A.CNSL_CNT/DECODE((SUM(A.CNSL_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CNSL_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0)  AS  CNSL_RT /* 접수점유비 (전체접수건수/매입유형접수건수) */
                           ,NVL(A.CLCT_CNT/DECODE((SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0)  AS  CLCT_RT /* 회수점유비 (전체매입건수/매입유형회수건수) */
                           ,NVL(A.JDG_AMT_SUM/DECODE(A.TLY_CNT,0,NULL,A.TLY_CNT),0)  AS  JDG_UPRC /* 감정단가 (감정금액/감정건수)*/
                      FROM(
                            SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                   ,DECODE(IB.DEALCO_CD,'11050','01','85000','02','11000','03','06') AS DEALCO_TYP
                                   ,COUNT(IA.CNSL_MGMT_NO)  AS  CNSL_CNT
                                   ,SUM(DECODE(IA.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                                   ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                   ,SUM(PRCH_AMT-ADJ_AMT)  AS  JDG_AMT_SUM
                              FROM  TB_EP_CST_PRCHS_MGMT  IA
                                   ,TB_DEALCO  IB 
                             WHERE  IA.CNSL_DEALCO_CD = IB.DEALCO_CD
                               AND  IB.EFF_STA_DT      <= IA.CNSL_DT
                               AND  IB.EFF_END_DT      >= IA.CNSL_DT
                               AND  IA.DEL_YN   = 'N'
                               AND  IA.PRCH_CL IN ('Y','N')
                               AND  IB.DEL_YN   = 'N'
                               AND  IA.SKN_CL   = 'N'
                               AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                             GROUP  BY  SUBSTR(IA.CNSL_DT,0,6),DECODE(IB.DEALCO_CD,'11050','01','85000','02','11000','03','06')
                       ) A 
                       ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=6 ) B
                     WHERE  A.DEALCO_TYP(+)= B.NUM
)
SELECT  C.*
  FROM(
        SELECT  #CNSL_YR#  AS  CNSL_YR
               ,'01'  AS  DATA_GB /* 접수(건) */
               ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
               ,TMP_A.DEALCO_TYP
               ,NVL(SUM(TMP_A.CNSL_CNT),0)  AS  RSLT_SUM
               ,NVL(ROUND(SUM(TMP_A.CNSL_CNT)/#MTH_CNT#),0)  AS  MTH_AVG
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  IA.CNSL_YR
              ,IA.DATA_GB 
              ,0  AS  G_ID
              ,IA.DEALCO_TYP
              ,NVL(ROUND((IA.CNSL_SUM)/DECODE((SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR))),3)*100,0)  AS  RSLT_SUM
              ,NVL(ROUND((IA.CNSL_SUM)/DECODE((SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR))),3)*100,0)  AS  MTH_AVG
              ,ROUND(IA.MTH_1,3)*100 AS  MTH_1
              ,ROUND(IA.MTH_2,3)*100 AS  MTH_2
              ,ROUND(IA.MTH_3,3)*100 AS  MTH_3
              ,ROUND(IA.MTH_4,3)*100 AS  MTH_4
              ,ROUND(IA.MTH_5,3)*100 AS  MTH_5
              ,ROUND(IA.MTH_6,3)*100 AS  MTH_6
              ,ROUND(IA.MTH_7,3)*100 AS  MTH_7
              ,ROUND(IA.MTH_8,3)*100 AS  MTH_8
              ,ROUND(IA.MTH_9,3)*100 AS  MTH_9
              ,ROUND(IA.MTH_10,3)*100 AS  MTH_10
              ,ROUND(IA.MTH_11,3)*100 AS  MTH_11
              ,ROUND(IA.MTH_12,3)*100 AS  MTH_12
         FROM(
                SELECT  #CNSL_YR#  AS  CNSL_YR
                        ,'02'  AS  DATA_GB /* 접수점유비(%) */
                        ,TMP_A.DEALCO_TYP
                        ,NVL(SUM(TMP_A.CNSL_CNT),0)  AS  CNSL_SUM
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CNSL_RT )),0)  AS  MTH_1
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CNSL_RT )),0)  AS  MTH_2
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CNSL_RT )),0)  AS  MTH_3
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CNSL_RT )),0)  AS  MTH_4
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CNSL_RT )),0)  AS  MTH_5
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CNSL_RT )),0)  AS  MTH_6
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CNSL_RT )),0)  AS  MTH_7
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CNSL_RT )),0)  AS  MTH_8
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CNSL_RT )),0)  AS  MTH_9
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CNSL_RT )),0)  AS  MTH_10
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CNSL_RT )),0)  AS  MTH_11
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CNSL_RT )),0)  AS  MTH_12
                   FROM  TMP_A  
                  GROUP  BY #CNSL_YR#,TMP_A.DEALCO_TYP 
         )  IA
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'03'  AS  DATA_GB /* 회수(건) */
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,NVL(SUM(TMP_A.CLCT_CNT),0)  AS  RSLT_SUM
              ,NVL(ROUND(SUM(TMP_A.CLCT_CNT)/#MTH_CNT#),0)  AS  MTH_AVG
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CLCT_CNT )),0)  AS  MTH_1
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CLCT_CNT )),0)  AS  MTH_2
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CLCT_CNT )),0)  AS  MTH_3
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CLCT_CNT )),0)  AS  MTH_4
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CLCT_CNT )),0)  AS  MTH_5
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CLCT_CNT )),0)  AS  MTH_6
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CLCT_CNT )),0)  AS  MTH_7
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CLCT_CNT )),0)  AS  MTH_8
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CLCT_CNT )),0)  AS  MTH_9
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CLCT_CNT )),0)  AS  MTH_10
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CLCT_CNT )),0)  AS  MTH_11
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CLCT_CNT )),0)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  IA.CNSL_YR
              ,IA.DATA_GB
              ,0  AS  G_ID
              ,IA.DEALCO_TYP 
              ,NVL(ROUND((IA.CLCT_SUM)/( DECODE((SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR))) ),3)*100,0)  AS  RSLT_SUM
              ,NVL(ROUND((IA.CLCT_SUM)/( DECODE((SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR))) ),3)*100,0)  AS  MTH_AVG
              ,ROUND(IA.MTH_1,3)*100 AS  MTH_1
              ,ROUND(IA.MTH_2,3)*100 AS  MTH_2
              ,ROUND(IA.MTH_3,3)*100 AS  MTH_3
              ,ROUND(IA.MTH_4,3)*100 AS  MTH_4
              ,ROUND(IA.MTH_5,3)*100 AS  MTH_5
              ,ROUND(IA.MTH_6,3)*100 AS  MTH_6
              ,ROUND(IA.MTH_7,3)*100 AS  MTH_7
              ,ROUND(IA.MTH_8,3)*100 AS  MTH_8
              ,ROUND(IA.MTH_9,3)*100 AS  MTH_9
              ,ROUND(IA.MTH_10,3)*100 AS  MTH_10
              ,ROUND(IA.MTH_11,3)*100 AS  MTH_11
              ,ROUND(IA.MTH_12,3)*100 AS  MTH_12
         FROM(
                SELECT  #CNSL_YR#  AS  CNSL_YR
                        ,'04'  AS  DATA_GB
                        ,TMP_A.DEALCO_TYP /* 회수점유비(%) */
                        ,NVL(SUM(TMP_A.CLCT_CNT),0)  AS  CLCT_SUM
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CLCT_RT )),0)  AS  MTH_1
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CLCT_RT )),0)  AS  MTH_2
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CLCT_RT )),0)  AS  MTH_3
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CLCT_RT )),0)  AS  MTH_4
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CLCT_RT )),0)  AS  MTH_5
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CLCT_RT )),0)  AS  MTH_6
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CLCT_RT )),0)  AS  MTH_7
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CLCT_RT )),0)  AS  MTH_8
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CLCT_RT )),0)  AS  MTH_9
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CLCT_RT )),0)  AS  MTH_10
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CLCT_RT )),0)  AS  MTH_11
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CLCT_RT )),0)  AS  MTH_12
                   FROM  TMP_A  
                  GROUP  BY #CNSL_YR#,TMP_A.DEALCO_TYP 
         )  IA
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'05'  AS  DATA_GB /* 감정(건) */
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,NVL(SUM(TMP_A.TLY_CNT),0)  AS  RSLT_SUM
              ,NVL(ROUND(SUM(TMP_A.TLY_CNT)/#MTH_CNT#),0)  AS  MTH_AVG
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',TLY_CNT )),0)  AS  MTH_1
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',TLY_CNT )),0)  AS  MTH_2
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',TLY_CNT )),0)  AS  MTH_3
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',TLY_CNT )),0)  AS  MTH_4
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',TLY_CNT )),0)  AS  MTH_5
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',TLY_CNT )),0)  AS  MTH_6
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',TLY_CNT )),0)  AS  MTH_7
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',TLY_CNT )),0)  AS  MTH_8
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',TLY_CNT )),0)  AS  MTH_9
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',TLY_CNT )),0)  AS  MTH_10
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',TLY_CNT )),0)  AS  MTH_11
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',TLY_CNT )),0)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'06'  AS  DATA_GB /* 감정금액(천원) */
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,ROUND(NVL(SUM(TMP_A.JDG_AMT_SUM)/1000,0))  AS  RSLT_SUM
              ,NVL(ROUND((SUM(TMP_A.JDG_AMT_SUM)/#MTH_CNT#)/1000),0)  AS  MTH_AVG
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',JDG_AMT_SUM )),0)/1000)  AS  MTH_1
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',JDG_AMT_SUM )),0)/1000)  AS  MTH_2
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',JDG_AMT_SUM )),0)/1000)  AS  MTH_3
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',JDG_AMT_SUM )),0)/1000)  AS  MTH_4
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',JDG_AMT_SUM )),0)/1000)  AS  MTH_5
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',JDG_AMT_SUM )),0)/1000)  AS  MTH_6
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',JDG_AMT_SUM )),0)/1000)  AS  MTH_7
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',JDG_AMT_SUM )),0)/1000)  AS  MTH_8
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',JDG_AMT_SUM )),0)/1000)  AS  MTH_9
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',JDG_AMT_SUM )),0)/1000)  AS  MTH_10
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',JDG_AMT_SUM )),0)/1000)  AS  MTH_11
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',JDG_AMT_SUM )),0)/1000)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'07'  AS  DATA_GB /* 감정단가(원)	*/
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,ROUND(NVL(SUM(TMP_A.JDG_AMT_SUM)/DECODE(SUM(TMP_A.TLY_CNT),0,NULL,SUM(TMP_A.TLY_CNT)),0),0)  AS  RSLT_SUM
              ,ROUND(NVL(SUM(TMP_A.JDG_AMT_SUM)/DECODE(SUM(TMP_A.TLY_CNT),0,NULL,SUM(TMP_A.TLY_CNT)),0),0)  AS  MTH_AVG
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',TMP_A.TLY_CNT)),0))  AS  MTH_1
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',TMP_A.TLY_CNT)),0))  AS  MTH_2
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',TMP_A.TLY_CNT)),0))	AS  MTH_3
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',TMP_A.TLY_CNT)),0))	AS  MTH_4
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',TMP_A.TLY_CNT)),0))	AS  MTH_5
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',TMP_A.TLY_CNT)),0))	AS  MTH_6
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',TMP_A.TLY_CNT)),0))	AS  MTH_7
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',TMP_A.TLY_CNT)),0))	AS  MTH_8
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',TMP_A.TLY_CNT)),0))	AS  MTH_9
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',TMP_A.TLY_CNT)),0))	AS  MTH_10
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',TMP_A.TLY_CNT)),0))	AS  MTH_11
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',TMP_A.TLY_CNT)),0))	AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
   )  C
 ORDER  BY C.DATA_GB,C.G_ID DESC ,C.DEALCO_TYP]]>
	</select>
	<select id="SInqNewCmpChgSaleList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SInqNewCmpChgSaleList NEW보상기변실적현황조회 */
/* IO: 박민정,2015-10-14T17:59:11(박민정,2015-10-14T14:35:09) */
/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SInqNewCmpChgSaleList NEW보상기변실적현황조회 */
/* IO: 박민정,2015-10-14T15:06:12(박민정,2015-10-14T14:35:09) */
WITH  TMP_A  AS  (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                         ,DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03') AS DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/
                         ,COUNT(IA.CNSL_MGMT_NO)  AS  CNSL_CNT
                         ,SUM(DECODE(IA.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                         ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                         ,SUM(PRCH_AMT-(ADJ_AMT*SIGN(ADJ_AMT)))  AS  JDG_AMT_SUM
                    FROM  TB_EP_CST_PRCHS_MGMT  IA
                         ,TB_EP_CST_CONSULT_MGMT IC
                         ,TB_DEALCO  IB 
                         ,TB_EQP_MDL IE
                   WHERE  IC.CNSL_MGMT_NO = IA.CNSL_MGMT_NO(+) 
                     AND  IA.CNSL_DEALCO_CD = IB.DEALCO_CD
                     AND  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                     AND  IB.EFF_STA_DT <= IA.CNSL_DT
                     AND  IB.EFF_END_DT >= IA.CNSL_DT
                     AND  IA.DEL_YN   = 'N'
                     AND  IA.PRCH_CL IN ('Y','N')
                     AND  IB.DEL_YN   = 'N'
                     AND  IA.SKN_CL   = 'N'
                     AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                   GROUP  BY  SUBSTR(IA.CNSL_DT,0,6),DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03')            
                   )
    ,TMP_B  AS  (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                         ,DECODE(NVL2(IC.PRE_DC_CL,'Y','N'),'Y','A',
                          DECODE(NVL2(IC.PPAY_YN,'Y','N'),'Y','B',
                          DECODE(NVL2(IC.RMT_DT,'Y','N'),'Y','C',
                          DECODE(NVL2(IC.ASIANA_CARD_NO,'Y','N'),'Y','D','N')))) as DATA_SECTION /*A선할인, B요금선납, C계좌송금, D아시아나*/
                         ,COUNT(IA.CNSL_MGMT_NO)  AS  CNSL_CNT
                         ,SUM(DECODE(IA.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                         ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                         ,SUM(PRCH_AMT-(ADJ_AMT*SIGN(ADJ_AMT)))  AS  JDG_AMT_SUM
                    FROM  TB_EP_CST_PRCHS_MGMT  IA
                         ,TB_EP_CST_CONSULT_MGMT IC
                         ,TB_DEALCO  IB 
                         ,TB_EQP_MDL IE
                   WHERE  IC.CNSL_MGMT_NO = IA.CNSL_MGMT_NO(+) 
                     AND  IA.CNSL_DEALCO_CD = IB.DEALCO_CD
                     AND  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                     AND  IB.EFF_STA_DT <= IA.CNSL_DT
                     AND  IB.EFF_END_DT >= IA.CNSL_DT
                     AND  IA.DEL_YN  = 'N'
                     AND  IA.PRCH_CL IN ('Y','N')
                     AND  IB.DEL_YN  = 'N'
                     AND  IA.SKN_CL  = 'N'
                     AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                   GROUP  BY  SUBSTR(IA.CNSL_DT,0,6),DECODE(NVL2(IC.PRE_DC_CL,'Y','N'),'Y','A',
                                                     DECODE(NVL2(IC.PPAY_YN,'Y','N'),'Y','B',
                                                     DECODE(NVL2(IC.RMT_DT,'Y','N'),'Y','C',
                                                     DECODE(NVL2(IC.ASIANA_CARD_NO,'Y','N'),'Y','D','N'))))               
                 )
     ,TMP_C  AS  (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                         ,DECODE(IG.HEADQ_NM,'수도권마케팅1본부','MT1',
                                             '수도권마케팅2본부','MT2',
                                             '부산마케팅본부','MT3',
                                             '대구마케팅본부','MT4',
                                             '서부마케팅본부','MT5',
                                             '중부마케팅본부','MT6',
                                             '유통사업부','MT7',
                                             '특수마케팅본부','MT8','없음') AS DATA_SECTION  /*마케팅본부분류*/
                         ,COUNT(IA.CNSL_MGMT_NO)  AS  CNSL_CNT
                         ,SUM(DECODE(IA.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                         ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                         ,SUM(PRCH_AMT-(ADJ_AMT*SIGN(ADJ_AMT)))  AS  JDG_AMT_SUM
                    FROM  TB_EP_CST_PRCHS_MGMT  IA
                         ,TB_EP_CST_CONSULT_MGMT IC
                         ,(SELECT  DEALCO_CD 
                                  ,DEALCO_NM 
                                  ,AFFIL_AGN/*소속대리점*/
                                  ,EFF_STA_DT
                                  ,EFF_END_DT
                                  ,SUBSTR(AGN_ORG_CD, 0, 6) AS AGN_ORG_CD /*UKey대리점코드*/
                             FROM  TB_DEALCO
                            WHERE (DEL_YN = 'N' OR DEL_YN IS NULL ))  IB 
                         ,TB_EQP_MDL IE
                         ,(SELECT  HEADQ_NM 
                                  ,MKT_TEAM_NM 
                                  ,UKEY_AGN_CD
                             FROM  TB_EP_BAS_DEAL_CO_MARKETING
                            WHERE  AGN_SEQ =(SELECT MAX(AGN_SEQ)
                                               FROM TB_EP_BAS_DEAL_CO_MARKETING
                                              WHERE UKEY_AGN_CD = UKEY_AGN_CD)
                             AND  DEL_YN = 'N') IG
                   WHERE  IC.CNSL_MGMT_NO = IA.CNSL_MGMT_NO(+) 
                     AND  IA.CNSL_DEALCO_CD = IB.DEALCO_CD
                     AND  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                     AND  IB.AGN_ORG_CD = IG.UKEY_AGN_CD(+)
                     AND  IB.EFF_STA_DT <= IA.CNSL_DT
                     AND  IB.EFF_END_DT >= IA.CNSL_DT
                     AND  IA.DEL_YN   = 'N'
                     AND  IA.PRCH_CL IN ('Y','N')
                     AND  IG.HEADQ_NM   in ('수도권마케팅1본부','수도권마케팅2본부','부산마케팅본부','대구마케팅본부','서부마케팅본부','중부마케팅본부','유통사업부','특수마케팅본부')
                     AND  IA.SKN_CL   = 'N'
                     AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                   GROUP  BY  SUBSTR(IA.CNSL_DT,0,6),DECODE(IG.HEADQ_NM,'수도권마케팅1본부','MT1',
                                             '수도권마케팅2본부','MT2',
                                             '부산마케팅본부','MT3',
                                             '대구마케팅본부','MT4',
                                             '서부마케팅본부','MT5',
                                             '중부마케팅본부','MT6',
                                             '유통사업부','MT7',
                                             '특수마케팅본부','MT8','없음')           
                  )
       ,TMP_D  AS  (
                    SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                           ,'All' as DATA_SECTION 
                           ,COUNT(IA.CNSL_MGMT_NO)  AS  CNSL_CNT
                           ,SUM(DECODE(IA.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                           ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                           ,SUM(PRCH_AMT-(ADJ_AMT*SIGN(ADJ_AMT)))  AS  JDG_AMT_SUM
                      FROM  TB_EP_CST_PRCHS_MGMT  IA
                           ,TB_EP_CST_CONSULT_MGMT IC
                           ,TB_DEALCO  IB 
                           ,TB_EQP_MDL IE
                     WHERE IC.CNSL_MGMT_NO = IA.CNSL_MGMT_NO(+) 
                       AND IA.CNSL_DEALCO_CD = IB.DEALCO_CD
                       AND  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                       AND  IB.EFF_STA_DT      <= IA.CNSL_DT
                       AND  IB.EFF_END_DT      >= IA.CNSL_DT
                       AND  IA.DEL_YN   = 'N'
                       AND  IA.PRCH_CL IN ('Y','N')
                       AND  IB.DEL_YN   = 'N'
                       AND  IA.SKN_CL   = 'N'
                       AND  IA.CNSL_DT BETWEEN '2015'||'0101' AND '2015'||'1231'
                     GROUP  BY  SUBSTR(IA.CNSL_DT,0,6)           
                  )
SELECT  C.*
  FROM 
      (
      SELECT  #CNSL_YR#  AS  CNSL_YR
             ,'02'  AS  DATA_GB /* 접수(건) */
             ,DATA_SECTION /*구분*/
             ,NVL(SUM(TMP_D.CNSL_CNT),0)  AS  RSLT_SUM
             ,NVL(TRUNC(SUM(TMP_D.CNSL_CNT)/12),0)  AS  MTH_AVG
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
             ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
       FROM  TMP_D  
      GROUP  BY #CNSL_YR#,TMP_D.DATA_SECTION 
      ORDER  BY TMP_D.DATA_SECTION
      )  C
UNION ALL                             
SELECT  B.*
FROM 
   (
    SELECT  #CNSL_YR#  AS  CNSL_YR
           ,'02'  AS  DATA_GB /* 접수(건) */
           ,DATA_SECTION /*폰타입구분*/
           ,NVL(SUM(TMP_A.CNSL_CNT),0)  AS  RSLT_SUM
           ,NVL(TRUNC(SUM(TMP_A.CNSL_CNT)/12),0)  AS  MTH_AVG
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
           ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
     FROM  TMP_A  
    GROUP  BY #CNSL_YR#,TMP_A.DATA_SECTION 
    ORDER  BY TMP_A.DATA_SECTION
    )  B
UNION ALL
SELECT  B2.*
FROM 
   ( 
    SELECT  #CNSL_YR#  AS  CNSL_YR
           ,'02'  AS  DATA_GB /* 접수(건) */
           ,DATA_SECTION /*요금납부구분*/
           ,NVL(SUM(TMP_B.CNSL_CNT),0)  AS  RSLT_SUM
           ,NVL(TRUNC(SUM(TMP_B.CNSL_CNT)/12),0)  AS  MTH_AVG
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
           ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
     FROM  TMP_B  
    GROUP  BY #CNSL_YR#,TMP_B.DATA_SECTION
    ORDER  BY TMP_B.DATA_SECTION
      )  B2
UNION ALL
SELECT  B3.*
FROM 
    ( 
    SELECT  #CNSL_YR#  AS  CNSL_YR
           ,'02'  AS  DATA_GB /* 접수(건) */ 
           ,DATA_SECTION /*마케팅본부분류*/
           ,NVL(SUM(TMP_C.CNSL_CNT),0)  AS  RSLT_SUM
           ,NVL(TRUNC(SUM(TMP_C.CNSL_CNT)/12),0)  AS  MTH_AVG
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
           ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
     FROM  TMP_C  
    GROUP  BY #CNSL_YR#,TMP_C.DATA_SECTION 
    ORDER  BY TMP_C.DATA_SECTION
    )  B3
UNION ALL
SELECT  B4.*
FROM 
     ( 
      SELECT  #CNSL_YR#  AS  CNSL_YR
             ,'06'  AS  DATA_GB /* 회수(건) */
             ,DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/
             ,NVL(SUM(TMP_A.CLCT_CNT),0)                                    AS RSLT_SUM 
             ,NVL(ROUND(SUM(TMP_A.CLCT_CNT)/'10'),0)                        AS MTH_AVG
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CLCT_CNT )),0) AS MTH_1 
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CLCT_CNT )),0) AS MTH_2 
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CLCT_CNT )),0) AS MTH_3 
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CLCT_CNT )),0) AS MTH_4
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CLCT_CNT )),0) AS MTH_5
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CLCT_CNT )),0) AS MTH_6
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CLCT_CNT )),0) AS MTH_7 
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CLCT_CNT )),0) AS MTH_8 
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CLCT_CNT )),0) AS MTH_9 
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CLCT_CNT )),0) AS MTH_10 
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CLCT_CNT )),0) AS MTH_11 
             ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CLCT_CNT )),0) AS MTH_12
       FROM  TMP_A  
      GROUP  BY #CNSL_YR#,TMP_A.DATA_SECTION 
      ORDER  BY TMP_A.DATA_SECTION
      )  B4     
UNION ALL
SELECT  B5.*
FROM 
     ( 
      SELECT  #CNSL_YR#  AS  CNSL_YR
             ,'06'  AS  DATA_GB /* 회수(건) */
             ,DATA_SECTION /*마케팅본부분류*/
             ,NVL(SUM(TMP_C.CLCT_CNT),0)                                    AS RSLT_SUM 
             ,NVL(ROUND(SUM(TMP_C.CLCT_CNT)/'10'),0)                        AS MTH_AVG
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CLCT_CNT )),0) AS MTH_1 
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CLCT_CNT )),0) AS MTH_2 
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CLCT_CNT )),0) AS MTH_3 
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CLCT_CNT )),0) AS MTH_4
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CLCT_CNT )),0) AS MTH_5
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CLCT_CNT )),0) AS MTH_6
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CLCT_CNT )),0) AS MTH_7 
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CLCT_CNT )),0) AS MTH_8 
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CLCT_CNT )),0) AS MTH_9 
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CLCT_CNT )),0) AS MTH_10 
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CLCT_CNT )),0) AS MTH_11 
             ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CLCT_CNT )),0) AS MTH_12
       FROM  TMP_C  
      GROUP  BY #CNSL_YR#,TMP_C.DATA_SECTION 
      ORDER  BY TMP_C.DATA_SECTION
    )  B5]]>
	</select>
</sqlMap>