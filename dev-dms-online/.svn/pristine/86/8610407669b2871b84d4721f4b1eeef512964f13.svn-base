<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="DEPReportMgmt">
	<select id="SMthSaleList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SMthSaleList 월별판매현황조회 */
/* IO: 정동현,2015-11-16T17:15:48(정동현,2015-10-19T10:45:00) */
SELECT * 
  FROM (
        SELECT  SELL_YR
               ,DATA_GB
               ,SELL_TYP
               ,SELL_DTM
               ,G_ID
               ,CNT
               ,CASE  WHEN DATA_GB = '01' THEN SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, SELL_TYP)
                      WHEN DATA_GB = '02' THEN ROUND((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, SELL_TYP))/1000000)
                      WHEN DATA_GB = '03' THEN ROUND(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, SELL_TYP) / SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, SELL_TYP))
                      WHEN DATA_GB = '04' THEN ROUND((SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, SELL_TYP))/1000000)
                      WHEN DATA_GB = '05' THEN ROUND(SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, SELL_TYP) / SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, SELL_TYP))
                      WHEN DATA_GB = '06' THEN ROUND((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, SELL_TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, SELL_TYP))/1000000)
                      WHEN DATA_GB = '07' THEN ROUND((NVL((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, SELL_TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, SELL_TYP)) / SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, SELL_TYP),0))*100,1)
                 END  AS  RSLT_SUM
               ,CASE  WHEN DATA_GB = '01' THEN ROUND(SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, SELL_TYP)/#MTH_CNT#)
                      WHEN DATA_GB = '02' THEN ROUND(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, SELL_TYP)/#MTH_CNT#/1000000)
                      WHEN DATA_GB = '03' THEN ROUND((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, SELL_TYP)/#MTH_CNT#) / (SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, SELL_TYP)/#MTH_CNT#) )
                      WHEN DATA_GB = '04' THEN ROUND(SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, SELL_TYP)/#MTH_CNT#/1000000)
                      WHEN DATA_GB = '05' THEN ROUND((SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, SELL_TYP)/#MTH_CNT#) / (SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, SELL_TYP)/#MTH_CNT#) )
                      WHEN DATA_GB = '06' THEN ROUND((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, SELL_TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, SELL_TYP))/#MTH_CNT#/1000000 )
                      WHEN DATA_GB = '07' THEN ROUND((NVL((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, SELL_TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, SELL_TYP))/#MTH_CNT# / (SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, SELL_TYP)/#MTH_CNT#),0))*100,1)
                 END  AS  MTH_AVG
         FROM  (
                SELECT  /*+ ORDERED */
                		A.SELL_YR
                       ,B.NUM AS DATA_GB /* 구분 ( 01: 판매(건), 02: 판매금액(백만원), 03: 판매단가(원), 04: 매입금액(백만원), 05: 매입단가(원), 06: 매출이익(백만원), 07: 매출이익률) */
                       ,A.SELL_TYP                                                                                               /* 판매유형 (01: b2b, 02: b2c ) */
                       ,A.SELL_DTM                                                                                               /* 판매일자 */
                       ,GROUPING_ID(B.NUM, A.SELL_TYP)  AS  G_ID
                       ,SUM(A.SELL_QTY)  AS  SUM_QTY                                                                             /* 판매건수 */
                       ,SUM(A.SELL_PRC)  AS  SUM_PRC                                                                             /* 판매금액 */
                       ,SUM(A.SELL_PCOST)  AS  SUM_PCOST                                                                         /* 매입금액 */
                       ,CASE  WHEN B.NUM = '01' THEN SUM(A.SELL_QTY)                                                             /* 판매 (건) */
                              WHEN B.NUM = '02' THEN ROUND(SUM(A.SELL_PRC)/1000000)                                              /* 판매금액 (백만원) */
                              WHEN B.NUM = '03' THEN ROUND(SUM(A.SELL_PRC) / SUM(A.SELL_QTY))                                    /* 판매단가 (원) : 판매금액/판매건수 */
                              WHEN B.NUM = '04' THEN ROUND(SUM(A.SELL_PCOST)/1000000)                                            /* 매입금액 (백만원) */
                              WHEN B.NUM = '05' THEN ROUND(SUM(A.SELL_PCOST) / SUM(A.SELL_QTY))                                  /* 매입단가 (원) : 매입금액/판매건수 */
                              WHEN B.NUM = '06' THEN ROUND((SUM(A.SELL_PRC) - SUM(A.SELL_PCOST))/1000000)                        /* 매출이익 (백만원) : 판매금액-매입금액 */
                              WHEN B.NUM = '07' THEN ROUND(NVL((SUM(A.SELL_PRC) - SUM(A.SELL_PCOST)) / SUM(A.SELL_PRC),0)*100,1) /* 매출이익률(%) : 매출이익/판매금액 */
                         END  AS  CNT
                  FROM  (
                          SELECT  SUBSTR(IA.SELL_DTM,0,4) AS SELL_YR
                                  ,SUBSTR(IA.SELL_DTM,5,2) AS SELL_DTM
                                  ,DECODE(IA.SELL_TYP,'03','02',IA.SELL_TYP) AS SELL_TYP                                         /* 판매유형 (01: b2b, 02: b2c, 03: b2c온라인 ) */
                                  ,1  AS SELL_QTY
                                  ,NVL(IB.SELL_PRC,0)   AS SELL_PRC
                                  ,NVL(IB.SELL_PCOST,0) AS SELL_PCOST
                            FROM  TB_EP_SAL_GNRL_SALE IA
                                 ,TB_EP_SAL_EQUIPMENT_SALE IB
                           WHERE  IA.SELL_DTM >= #SELL_YR# || '0101000000'
                             AND  IA.SELL_DTM <= #SELL_YR# || '1231240000'
                             AND  IA.SELL_CNCL_YN  <> 'Y'                                                                        /* 판매취소여부 */
                             AND  IA.SELL_TYP  IN ('01','02','03')
                             AND  IA.GNRL_SELL_NO = IB.GNRL_SELL_NO
                             AND  IA.GNRL_SELL_CHG_SEQ = IB.GNRL_SELL_CHG_SEQ
                             AND  IB.EQP_MDL_CD IS NOT NULL
                             AND  IA.GNRL_SELL_CHG_SEQ = (SELECT  MAX(GNRL_SELL_CHG_SEQ)
                                                            FROM  TB_EP_SAL_GNRL_SALE
		  					                               WHERE  GNRL_SELL_NO = IA.GNRL_SELL_NO)
                             AND  IA.DEL_YN = 'N'
                             AND  IB.DEL_YN = 'N'
                         )  A
                       ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=7) B
                 GROUP  BY A.SELL_YR,A.SELL_DTM, ROLLUP( B.NUM ,A.SELL_TYP ) HAVING GROUPING_ID(B.NUM, A.SELL_TYP) IN (0,1)
         ) 
)
 PIVOT (
        MIN(CNT)
        FOR SELL_DTM IN ( '01' AS MTH_1 ,'02' AS MTH_2 ,'03' AS MTH_3 ,'04' AS MTH_4 ,'05' AS MTH_5 ,'06' AS MTH_6
                           ,'07' AS MTH_7 ,'08' AS MTH_8 ,'09' AS MTH_9 ,'10' AS MTH_10 ,'11' AS MTH_11 ,'12' AS MTH_12 )
        )
 ORDER  BY DATA_GB, G_ID DESC, SELL_TYP]]>
	</select>
	<select id="SB2BSaleList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SB2BSaleList B2B판매실적현황조회 */
/* IO: 정동현,2015-11-19T16:12:04(정동현,2015-10-19T16:37:43) */
SELECT  * 
  FROM  (
         SELECT  G_ID
                ,SELL_YR 
                ,DATA_GB
                ,PHONE_TYP
                ,MFACT_TYP
                ,SELL_DTM
                ,CNT
                ,CASE WHEN DATA_GB = '01' THEN SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP)
                      WHEN DATA_GB = '02' THEN ROUND(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP)/1000000)
                      WHEN DATA_GB = '03' THEN ROUND(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP) / SUM(SUM_QTY) OVER(PARTITION BY DATA_GB,PHONE_TYP ,MFACT_TYP))
                      WHEN DATA_GB = '04' THEN ROUND(SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP)/1000000)
                      WHEN DATA_GB = '05' THEN ROUND(SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP) / SUM(SUM_QTY) OVER(PARTITION BY DATA_GB,PHONE_TYP ,MFACT_TYP))
                      WHEN DATA_GB = '06' THEN ROUND((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB,PHONE_TYP ,MFACT_TYP))/1000000)
                      WHEN DATA_GB = '07' THEN ROUND((NVL((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB,PHONE_TYP ,MFACT_TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB,PHONE_TYP ,MFACT_TYP)) / SUM(SUM_PRC) OVER(PARTITION BY DATA_GB,PHONE_TYP ,MFACT_TYP),0))*100,1)
                 END AS RSLT_SUM
                ,CASE WHEN DATA_GB = '01' THEN ROUND(SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP)/#MTH_CNT#)
                      WHEN DATA_GB = '02' THEN ROUND(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP)/1000000/#MTH_CNT#)
                      WHEN DATA_GB = '03' THEN ROUND(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP)/#MTH_CNT# / SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP)/#MTH_CNT#)
                      WHEN DATA_GB = '04' THEN ROUND(SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP)/1000000/#MTH_CNT#)
                      WHEN DATA_GB = '05' THEN ROUND(SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP)/#MTH_CNT# / SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP)/#MTH_CNT# )
                      WHEN DATA_GB = '06' THEN ROUND((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP))/1000000/#MTH_CNT#)
                      WHEN DATA_GB = '07' THEN ROUND(NVL(((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP))/#MTH_CNT#) / (SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, PHONE_TYP ,MFACT_TYP)/#MTH_CNT#),0)*100,1)
                 END AS MTH_AVG
           FROM  (
                  SELECT /*+ ORDERED */
                  		  GROUPING_ID(A.PHONE_TYP,A.MFACT_TYP) AS G_ID 
                         ,A.SELL_YR                                                                                                 /* 판매년도 */
                         ,B.NUM AS DATA_GB /* 구분 ( 01: 판매(건), 02: 판매금액(백만원), 03: 판매단가(원), 04: 매입금액(백만원), 05: 매입단가(원), 06: 매출이익(백만원), 07: 매출이익률) */
                         ,A.PHONE_TYP                                                                                               /* 상품유형 */
                         ,A.MFACT_TYP                                                                                               /* 제조사 */
                         ,A.SELL_DTM                                                                                                /* 판매일자 */
                         ,SUM(A.SELL_QTY) AS SUM_QTY                                                                                /* 판매건수 */
                         ,SUM(A.SELL_PRC) AS SUM_PRC                                                                                /* 판매금액 */
                         ,SUM(A.SELL_PCOST) AS SUM_PCOST                                                                            /* 매입금액 */
                         ,CASE WHEN B.NUM = '01' THEN SUM(A.SELL_QTY)                                                               /* 판매 (건) */
                               WHEN B.NUM = '02' THEN ROUND(SUM(A.SELL_PRC)/1000000)                                                /* 판매금액 (백만원) */
                               WHEN B.NUM = '03' THEN ROUND(SUM(A.SELL_PRC) / SUM(A.SELL_QTY))                                      /* 판매단가 (원) : 판매금액/판매건수 */
                               WHEN B.NUM = '04' THEN ROUND(SUM(A.SELL_PCOST)/1000000)                                              /* 매입금액 (백만원) */
                               WHEN B.NUM = '05' THEN ROUND(SUM(A.SELL_PCOST) / SUM(A.SELL_QTY))                                    /* 매입단가 (원) : 매입금액/판매건수 */
                               WHEN B.NUM = '06' THEN ROUND((SUM(A.SELL_PRC) - SUM(A.SELL_PCOST))/1000000)                          /* 매출이익 (백만원) : 판매금액-매입금액 */
                               WHEN B.NUM = '07' THEN ROUND((NVL((SUM(A.SELL_PRC) - SUM(A.SELL_PCOST)) / SUM(A.SELL_PRC),0))*100,1) /* 매출이익률(%) : 매출이익/판매금액 */
                          END AS CNT
                    FROM  (
                           SELECT  SUBSTR(IA.SELL_DTM,0,4) AS SELL_YR
                                  ,SUBSTR(IA.SELL_DTM,5,2) AS SELL_DTM
                                  ,DECODE(IC.PROD_CHRTIC_1,'S','2','P','1','2') AS PHONE_TYP                                         /* 상품특성 (S:스마트폰, P:피처폰) */
                                  ,(CASE WHEN IC.PROD_CHRTIC_1 IN ('S','T') OR IC.PROD_CHRTIC_1   IS NULL
                                         THEN (CASE WHEN IC.MFACT_CD IN ('CG','KG','KX','LA') THEN 'A'
              										WHEN IC.MFACT_CD IN ('KS','LS','OS','SS') THEN 'B'
              										WHEN IC.MFACT_CD IN ('KL','LG','LL') THEN 'C'
              										ELSE 'D'
         										END)      /* 제조사 - 애플(CG,KG,KX,LA), 삼성(KS,LS,OS,SS), LG(KL,LG,LL) */
                                         ELSE 'P'
                                   END) AS MFACT_TYP
                                  ,1  AS SELL_QTY
                                  ,NVL(IB.SELL_PRC,0)   AS SELL_PRC
                                  ,NVL(IB.SELL_PCOST,0) AS SELL_PCOST
                             FROM  TB_EP_SAL_GNRL_SALE  IA
                                  ,TB_EP_SAL_EQUIPMENT_SALE  IB
                                  ,TB_EQP_MDL IC
                            WHERE  IA.GNRL_SELL_NO = IB.GNRL_SELL_NO
                              AND  IA.GNRL_SELL_CHG_SEQ = IB.GNRL_SELL_CHG_SEQ
                              AND  IB.EQP_MDL_CD = IC.EQP_MDL_CD
                              AND  IA.SELL_DTM >= #SELL_YR# || '0101000000'
                              AND  IA.SELL_DTM <= #SELL_YR# || '1231240000'
                              AND  IA.SELL_CNCL_YN <> 'Y'                                                                          /* 판매 취소 여부 */
                              AND  IA.SELL_TYP IN ('01')                                                                           /* 판매 유형 (01:B2B, 02:B2C, 03:B2C온라인) */
                              AND  IB.EQP_MDL_CD IS NOT NULL
                              AND  IA.GNRL_SELL_CHG_SEQ = (SELECT  MAX(GNRL_SELL_CHG_SEQ)
                                                             FROM  TB_EP_SAL_GNRL_SALE
		  					                                WHERE  GNRL_SELL_NO = IA.GNRL_SELL_NO)
                              AND  IA.DEL_YN = 'N'
                              AND  IB.DEL_YN = 'N'
                          ) A
                         ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=7) B
                   GROUP  BY  A.SELL_YR ,A.SELL_DTM ,B.NUM ,ROLLUP( A.PHONE_TYP , A.MFACT_TYP )
                   HAVING (GROUPING_ID(A.PHONE_TYP,A.MFACT_TYP) != 1 OR A.PHONE_TYP != 1)
                 )
        )
PIVOT  (
        MIN(CNT)
        FOR SELL_DTM IN ( '01' AS MTH_1 ,'02' AS MTH_2 ,'03' AS MTH_3 ,'04' AS MTH_4 ,'05' AS MTH_5 ,'06' AS MTH_6
                         ,'07' AS MTH_7 ,'08' AS MTH_8 ,'09' AS MTH_9 ,'10' AS MTH_10 ,'11' AS MTH_11 ,'12' AS MTH_12 )
        )
ORDER  BY  DATA_GB ,G_ID DESC, PHONE_TYP DESC, MFACT_TYP]]>
	</select>
	<select id="SDirPrchList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SDirPrchList 직매입현황조회 */
/* IO: 정동현,2015-11-16T17:14:51(정동현,2015-10-05T19:32:21) */
WITH  TMP_A  AS (
                 SELECT  A.CNSL_YM                         /* 조회년도 */
					    ,B.NUM AS DEALCO_TYP               /* 매입유형 (01:ecophone4u, 02:11번가, 03:행복한에코폰, 04:kt입찰, 05:해외, 06:기타)*/
					    ,A.CNSL_CNT                        /* 접수건수 */
					    ,A.CLCT_CNT                        /* 회수건수 */
					    ,A.TLY_CNT                         /* 감정건수 */
					    ,A.JDG_AMT_SUM                     /* 감정금액 (매입금액 - 조정금액)*/
					    ,NVL(A.CNSL_CNT/DECODE((SUM(A.CNSL_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CNSL_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0)  AS  CNSL_RT /* 접수점유비 (전체접수건수/매입유형접수건수) */
					    ,NVL(A.CLCT_CNT/DECODE((SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0)  AS  CLCT_RT /* 회수점유비 (전체매입건수/매입유형회수건수) */
				   FROM  (
					 	  SELECT  IA.CNSL_YM
							 	 ,IA.DEALCO_TYP
								 ,SUM(IA.CNSL_CNT)  AS CNSL_CNT 
								 ,SUM(IA.CLCT_CNT)  AS CLCT_CNT
								 ,SUM(IA.TLY_CNT)     AS TLY_CNT
								 ,SUM(IA.JDG_AMT_SUM) AS JDG_AMT_SUM
						    FROM  (
								   SELECT SUBSTR(IIA.CNSL_DT,0,6)                                           AS CNSL_YM     /* 조회년도 */
								 		 ,DECODE(IIB.DEALCO_CD,'11050','01','85000','02','11000','03','06') AS DEALCO_TYP  /* 매입유형 (01:ecophone4u, 02:11번가, 03:행복한에코폰, 04:kt입찰, 05:해외, 06:기타)*/
										 ,0                                                                 AS CNSL_CNT    /* 접수건수 */
										 ,0                                                                 AS CLCT_CNT    /* 회수건수 */
										 ,DECODE(IIA.TLY_DT,NULL,0,1)                                       AS TLY_CNT     /* 감정건수 */
										 ,PRCH_AMT-ADJ_AMT                                                  AS JDG_AMT_SUM /* 감정금액 (매입금액 - 조정금액)*/
								    FROM  TB_EP_CST_PRCHS_MGMT IIA
										 ,TB_DEALCO IIB
								   WHERE  IIA.CNSL_DEALCO_CD         = IIB.DEALCO_CD
									 AND  IIB.EFF_STA_DT              <= IIA.CNSL_DT
									 AND  IIB.EFF_END_DT              >= IIA.CNSL_DT
									 AND  IIA.DEL_YN                   = 'N'
									 AND  SUBSTR(IIA.CNSL_MGMT_NO,1,3) = 'CON'                                             /* 직매입 */
									 AND  IIB.DEL_YN                   = 'N'
									 AND  IIA.SKN_CL                   = 'N'                                               /* SKN 구분 */
									 AND  IIA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'                      /* 상담일자 */
								   UNION ALL
								  SELECT  SUBSTR(IIA.CNSL_DT,0,6)                                           AS CNSL_YM     /* 조회년도 */
										 ,DECODE(IIB.DEALCO_CD,'11050','01','85000','02','11000','03','06') AS DEALCO_TYP  /* 매입유형 (01:ecophone4u, 02:11번가, 03:행복한에코폰, 04:kt입찰, 05:해외, 06:기타)*/
										 ,DECODE(IIA.CNSL_MGMT_NO,NULL,0,1)                                 AS CNSL_CNT    /* 접수건수 */
										 ,DECODE(IIA.CLCT_YN,'Y',1,0)                                       AS CLCT_CNT    /* 회수건수 */
										 ,0                                                                 AS TLY_CNT     /* 감정건수 */
										 ,0                                                                 AS JDG_AMT_SUM /* 감정금액 (매입금액 - 조정금액)*/
								    FROM  TB_EP_CST_CONSULT_MGMT IIA
										 ,TB_DEALCO IIB
								   WHERE  IIA.CNSL_DEALCO_CD         = IIB.DEALCO_CD
									 AND  IIB.EFF_STA_DT              <= IIA.CNSL_DT
									 AND  IIB.EFF_END_DT              >= IIA.CNSL_DT
									 AND  IIA.DEL_YN                   = 'N'
									 AND  SUBSTR(IIA.CNSL_MGMT_NO,1,3) = 'CON'                                             /* 직매입 */
									 AND  IIB.DEL_YN                   = 'N'
									 AND  IIA.SKN_CL                   = 'N'                                               /* SKN 구분 */
									 AND  IIA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'                      /* 상담일자 */
								  ) IA
						   GROUP BY IA.CNSL_YM, IA.DEALCO_TYP
					    )  A
					   ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=6) B
				  WHERE  A.DEALCO_TYP(+)= B.NUM
)
SELECT  C.*
  FROM(
        SELECT  #CNSL_YR#  AS  CNSL_YR
               ,'01'  AS  DATA_GB /* 접수(건) */
               ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
               ,TMP_A.DEALCO_TYP
               ,NVL(SUM(TMP_A.CNSL_CNT),0)  AS  RSLT_SUM
               ,NVL(ROUND(SUM(TMP_A.CNSL_CNT)/#MTH_CNT#),0)  AS  MTH_AVG
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  IA.CNSL_YR
              ,IA.DATA_GB 
              ,0  AS  G_ID
              ,IA.DEALCO_TYP
              ,NVL(ROUND((IA.CNSL_SUM)/DECODE((SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR))),3)*100,0)  AS  RSLT_SUM
              ,NVL(ROUND((IA.CNSL_SUM)/DECODE((SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR))),3)*100,0)  AS  MTH_AVG
              ,ROUND(IA.MTH_1,3)*100 AS  MTH_1
              ,ROUND(IA.MTH_2,3)*100 AS  MTH_2
              ,ROUND(IA.MTH_3,3)*100 AS  MTH_3
              ,ROUND(IA.MTH_4,3)*100 AS  MTH_4
              ,ROUND(IA.MTH_5,3)*100 AS  MTH_5
              ,ROUND(IA.MTH_6,3)*100 AS  MTH_6
              ,ROUND(IA.MTH_7,3)*100 AS  MTH_7
              ,ROUND(IA.MTH_8,3)*100 AS  MTH_8
              ,ROUND(IA.MTH_9,3)*100 AS  MTH_9
              ,ROUND(IA.MTH_10,3)*100 AS  MTH_10
              ,ROUND(IA.MTH_11,3)*100 AS  MTH_11
              ,ROUND(IA.MTH_12,3)*100 AS  MTH_12
         FROM(
                SELECT  #CNSL_YR#  AS  CNSL_YR
                        ,'02'  AS  DATA_GB /* 접수점유비(%) */
                        ,TMP_A.DEALCO_TYP
                        ,NVL(SUM(TMP_A.CNSL_CNT),0)  AS  CNSL_SUM
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CNSL_RT )),0)  AS  MTH_1
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CNSL_RT )),0)  AS  MTH_2
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CNSL_RT )),0)  AS  MTH_3
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CNSL_RT )),0)  AS  MTH_4
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CNSL_RT )),0)  AS  MTH_5
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CNSL_RT )),0)  AS  MTH_6
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CNSL_RT )),0)  AS  MTH_7
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CNSL_RT )),0)  AS  MTH_8
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CNSL_RT )),0)  AS  MTH_9
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CNSL_RT )),0)  AS  MTH_10
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CNSL_RT )),0)  AS  MTH_11
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CNSL_RT )),0)  AS  MTH_12
                   FROM  TMP_A  
                  GROUP  BY #CNSL_YR#,TMP_A.DEALCO_TYP 
         )  IA
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'03'  AS  DATA_GB /* 회수(건) */
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,NVL(SUM(TMP_A.CLCT_CNT),0)  AS  RSLT_SUM
              ,NVL(ROUND(SUM(TMP_A.CLCT_CNT)/#MTH_CNT#),0)  AS  MTH_AVG
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CLCT_CNT )),0)  AS  MTH_1
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CLCT_CNT )),0)  AS  MTH_2
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CLCT_CNT )),0)  AS  MTH_3
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CLCT_CNT )),0)  AS  MTH_4
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CLCT_CNT )),0)  AS  MTH_5
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CLCT_CNT )),0)  AS  MTH_6
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CLCT_CNT )),0)  AS  MTH_7
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CLCT_CNT )),0)  AS  MTH_8
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CLCT_CNT )),0)  AS  MTH_9
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CLCT_CNT )),0)  AS  MTH_10
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CLCT_CNT )),0)  AS  MTH_11
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CLCT_CNT )),0)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  IA.CNSL_YR
              ,IA.DATA_GB
              ,0  AS  G_ID
              ,IA.DEALCO_TYP 
              ,NVL(ROUND((IA.CLCT_SUM)/( DECODE((SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR))) ),3)*100,0)  AS  RSLT_SUM
              ,NVL(ROUND((IA.CLCT_SUM)/( DECODE((SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR))) ),3)*100,0)  AS  MTH_AVG
              ,ROUND(IA.MTH_1,3)*100 AS  MTH_1
              ,ROUND(IA.MTH_2,3)*100 AS  MTH_2
              ,ROUND(IA.MTH_3,3)*100 AS  MTH_3
              ,ROUND(IA.MTH_4,3)*100 AS  MTH_4
              ,ROUND(IA.MTH_5,3)*100 AS  MTH_5
              ,ROUND(IA.MTH_6,3)*100 AS  MTH_6
              ,ROUND(IA.MTH_7,3)*100 AS  MTH_7
              ,ROUND(IA.MTH_8,3)*100 AS  MTH_8
              ,ROUND(IA.MTH_9,3)*100 AS  MTH_9
              ,ROUND(IA.MTH_10,3)*100 AS  MTH_10
              ,ROUND(IA.MTH_11,3)*100 AS  MTH_11
              ,ROUND(IA.MTH_12,3)*100 AS  MTH_12
         FROM(
                SELECT  #CNSL_YR#  AS  CNSL_YR
                        ,'04'  AS  DATA_GB
                        ,TMP_A.DEALCO_TYP /* 회수점유비(%) */
                        ,NVL(SUM(TMP_A.CLCT_CNT),0)  AS  CLCT_SUM
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CLCT_RT )),0)  AS  MTH_1
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CLCT_RT )),0)  AS  MTH_2
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CLCT_RT )),0)  AS  MTH_3
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CLCT_RT )),0)  AS  MTH_4
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CLCT_RT )),0)  AS  MTH_5
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CLCT_RT )),0)  AS  MTH_6
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CLCT_RT )),0)  AS  MTH_7
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CLCT_RT )),0)  AS  MTH_8
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CLCT_RT )),0)  AS  MTH_9
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CLCT_RT )),0)  AS  MTH_10
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CLCT_RT )),0)  AS  MTH_11
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CLCT_RT )),0)  AS  MTH_12
                   FROM  TMP_A  
                  GROUP  BY #CNSL_YR#,TMP_A.DEALCO_TYP 
         )  IA
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'05'  AS  DATA_GB /* 감정(건) */
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,NVL(SUM(TMP_A.TLY_CNT),0)  AS  RSLT_SUM
              ,NVL(ROUND(SUM(TMP_A.TLY_CNT)/#MTH_CNT#),0)  AS  MTH_AVG
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',TLY_CNT )),0)  AS  MTH_1
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',TLY_CNT )),0)  AS  MTH_2
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',TLY_CNT )),0)  AS  MTH_3
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',TLY_CNT )),0)  AS  MTH_4
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',TLY_CNT )),0)  AS  MTH_5
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',TLY_CNT )),0)  AS  MTH_6
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',TLY_CNT )),0)  AS  MTH_7
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',TLY_CNT )),0)  AS  MTH_8
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',TLY_CNT )),0)  AS  MTH_9
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',TLY_CNT )),0)  AS  MTH_10
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',TLY_CNT )),0)  AS  MTH_11
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',TLY_CNT )),0)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'06'  AS  DATA_GB /* 감정금액(천원) */
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,ROUND(NVL(SUM(TMP_A.JDG_AMT_SUM)/1000,0))  AS  RSLT_SUM
              ,NVL(ROUND((SUM(TMP_A.JDG_AMT_SUM)/#MTH_CNT#)/1000),0)  AS  MTH_AVG
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',JDG_AMT_SUM )),0)/1000)  AS  MTH_1
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',JDG_AMT_SUM )),0)/1000)  AS  MTH_2
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',JDG_AMT_SUM )),0)/1000)  AS  MTH_3
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',JDG_AMT_SUM )),0)/1000)  AS  MTH_4
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',JDG_AMT_SUM )),0)/1000)  AS  MTH_5
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',JDG_AMT_SUM )),0)/1000)  AS  MTH_6
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',JDG_AMT_SUM )),0)/1000)  AS  MTH_7
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',JDG_AMT_SUM )),0)/1000)  AS  MTH_8
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',JDG_AMT_SUM )),0)/1000)  AS  MTH_9
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',JDG_AMT_SUM )),0)/1000)  AS  MTH_10
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',JDG_AMT_SUM )),0)/1000)  AS  MTH_11
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',JDG_AMT_SUM )),0)/1000)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'07'  AS  DATA_GB /* 감정단가(원)	*/
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,ROUND(NVL(SUM(TMP_A.JDG_AMT_SUM)/DECODE(SUM(TMP_A.TLY_CNT),0,NULL,SUM(TMP_A.TLY_CNT)),0),0)  AS  RSLT_SUM
              ,ROUND(NVL(SUM(TMP_A.JDG_AMT_SUM)/DECODE(SUM(TMP_A.TLY_CNT),0,NULL,SUM(TMP_A.TLY_CNT)),0),0)  AS  MTH_AVG
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))  AS  MTH_1
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))  AS  MTH_2
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))	AS  MTH_3
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))	AS  MTH_4
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))	AS  MTH_5
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))	AS  MTH_6
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))	AS  MTH_7
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))	AS  MTH_8
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))	AS  MTH_9
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))	AS  MTH_10
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))	AS  MTH_11
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',DECODE(TMP_A.TLY_CNT,0,NULL,TMP_A.TLY_CNT))),0))	AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
   )  C
 ORDER  BY C.DATA_GB,C.G_ID DESC ,C.DEALCO_TYP]]>
	</select>
	<select id="SInqNewCmpChgSaleList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SInqNewCmpChgSaleList NEW보상기변실적현황조회 */
/* IO: 박민정,2015-11-18T11:05:13(박민정,2015-10-14T14:35:09) */
SELECT T.* 
  FROM (WITH  TMP_A  AS  ( SELECT A.CNSL_YM        /* 조회년도 */
                                 ,AA.NUM AS DATA_SECTION
                                 ,A.CNSL_CNT       /* 접수건수 */
                                 ,A.CLCT_CNT       /* 회수건수 */
                                 ,A.CNSL_AMT_SUM      /* 접수금액*/
                                 ,NVL(A.CNSL_AMT_SUM/DECODE(A.CNSL_CNT,0,NULL,A.CNSL_CNT),0) AS CNSL_UPRC  /* 접수단가 (접수금액/접수건수)*/
                                 ,NVL(A.CLCT_CNT/DECODE((SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0) AS CLCT_RT  /* 회수율 (매입유형회수(건)/전체회수(건)) */
                            FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                         ,DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03') AS DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/
                                         ,COUNT(IC.CNSL_MGMT_NO)  AS  CNSL_CNT
                                         ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                                         ,SUM(IC.CNSL_AMT)  AS CNSL_AMT_SUM    /*접수금액(상담금액)*/
                                    FROM  TB_EP_CST_CONSULT_MGMT IC
                                         ,TB_EQP_MDL IE
                                   WHERE  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                     AND  IC.DEL_YN   = 'N'
                                     AND  IE.DEL_YN   = 'N'
                                     AND  IC.SCRB_MTHD ='C'            /*가입 방법:기변 */
                                     AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                   GROUP  BY  SUBSTR(IC.CNSL_DT,0,6),DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03'))A
                                  ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=3 ) AA
                                  WHERE  A.DATA_SECTION(+)= AA.NUM)
            ,TMP_B  AS  (SELECT B.CNSL_YM       /* 조회년도 */
                                 ,BB.NUM AS DATA_SECTION
                                 ,B.CNSL_CNT      /* 접수건수 */
                                 ,B.CLCT_CNT      /* 회수건수 */
                                 ,B.CNSL_AMT_SUM      /* 접수금액*/
                            FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                         ,NVL(ID.DATA_SECTION,'15') DATA_SECTION
                                         ,COUNT(IC.CNSL_MGMT_NO)  AS  CNSL_CNT
                                         ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                                         ,SUM(IC.CNSL_AMT)  AS CNSL_AMT_SUM    /*접수금액(상담금액)*/
                                    FROM  TB_EP_CST_CONSULT_MGMT IC
                                          ,(SELECT A.CNSL_MGMT_NO
                                                  ,NVL(DECODE(NVL(A.SKN_CL,'N'),'Y'
                                                      ,DECODE(NVL(A.PRE_DC_CL,'N'),'Y','11'   
                                                      ,DECODE(NVL(A.ASIANA_CARD_NO,'N'),'N'   
                                                      ,DECODE(A.PAY_MTHD,'02','12'             /*11선할인, 12요금선납, 13계좌송금, 14아시아나 15해당없음*/
                                                      ,DECODE(A.PAY_MTHD,'01','13','15')),'14'))
                                                      ,DECODE(NVL(B.FEE_DEDC_YN,'0'),'1','12','13')),'15') AS DATA_SECTION
                                              FROM TB_EP_CST_CONSULT_MGMT A
                                                   , (SELECT CNSL_MGMT_NO, MAX(FEE_DEDC_YN) FEE_DEDC_YN FROM TB_EP_CST_PRCHS_MGMT WHERE DEL_YN = 'N' GROUP BY CNSL_MGMT_NO) B
                                             WHERE A.DEL_YN = 'N'
                                               AND A.CNSL_MGMT_NO = B.CNSL_MGMT_NO(+)
                                         ) ID
                                         ,TB_EQP_MDL IE
                                   WHERE  IC.CNSL_MGMT_NO = ID.CNSL_MGMT_NO(+)
                                     AND  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                     AND  IC.DEL_YN   = 'N'
                                     AND  IE.DEL_YN   = 'N'
                                     AND  IC.SCRB_MTHD ='C'            /*가입 방법:기변 */
                                     AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                   GROUP BY SUBSTR(IC.CNSL_DT,0,6), NVL(ID.DATA_SECTION,'15'))B
                                 ,(SELECT LPAD(LEVEL,2,'1') AS NUM FROM DUAL CONNECT BY LEVEL <=5 ) BB
                                   WHERE  B.DATA_SECTION(+)= BB.NUM)                      
             ,TMP_C  AS  (SELECT C.CNSL_YM        /* 조회년도 */
                                ,CC.NUM AS DATA_SECTION
                                ,C.CNSL_CNT       /* 접수건수 */
                                ,C.CLCT_CNT       /* 회수건수 */
                                ,C.CNSL_AMT_SUM      /* 접수금액*/
                                ,NVL(C.CNSL_AMT_SUM/DECODE(C.CNSL_CNT,0,NULL,C.CNSL_CNT),0) AS CNSL_UPRC  /* 접수단가 (접수금액/접수건수)*/
                                ,NVL(C.CLCT_CNT/DECODE((SUM(C.CLCT_CNT) OVER (PARTITION BY C.CNSL_YM)),0,NULL,(SUM(C.CLCT_CNT) OVER (PARTITION BY C.CNSL_YM))) ,0) AS CLCT_RT  /* 회수율 (매입유형회수(건)/전체회수(건)) */
                           FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                        ,DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                            '수도권마케팅2본부','22',
                                                            '부산마케팅본부','23',
                                                            '대구마케팅본부','24',
                                                            '서부마케팅본부','25',
                                                            '중부마케팅본부','26',
                                                            '유통사업부','27',
                                                            '특수마케팅본부','28','29') AS DATA_SECTION  /*마케팅본부분류*/
                                        ,COUNT(IC.CNSL_MGMT_NO)  AS  CNSL_CNT
                                        ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                                        ,SUM(IC.CNSL_AMT)  AS CNSL_AMT_SUM    /*접수금액(상담금액)*/
                                  FROM TB_EP_CST_CONSULT_MGMT IC
                                       ,TB_DEALCO IB 
                                       ,TB_EQP_MDL IE
                                       ,(SELECT A.HEADQ_NM 
                                               ,A.MKT_TEAM_NM 
                                               ,A.UKEY_AGN_CD
                                           FROM  TB_EP_BAS_DEAL_CO_MARKETING A
                                               ,(SELECT UKEY_AGN_CD
                                                       ,MAX(AGN_SEQ) AS AGN_SEQ
                                                   FROM TB_EP_BAS_DEAL_CO_MARKETING 
                                                  GROUP BY UKEY_AGN_CD ) B
                                         WHERE A.UKEY_AGN_CD = B.UKEY_AGN_CD
                                           AND A.AGN_SEQ = B.AGN_SEQ 
                                           AND A.DEL_YN ='N'
                                           ) IG
                                 WHERE  IC.CNSL_DEALCO_CD = IB.DEALCO_CD
                                   AND  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                   AND  IB.UKEY_AGN_CD = IG.UKEY_AGN_CD(+)
                                   AND  IB.EFF_STA_DT <= IC.CNSL_DT
                                   AND  IB.EFF_END_DT >= IC.CNSL_DT
                                   AND  IC.DEL_YN   = 'N'
                                   AND  IB.DEL_YN   = 'N'
                                   AND  IC.SCRB_MTHD ='C'            /*가입 방법:기변 */
                                   AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                 GROUP  BY  SUBSTR(IC.CNSL_DT,0,6),DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                                                      '수도권마케팅2본부','22',
                                                                                      '부산마케팅본부','23',
                                                                                      '대구마케팅본부','24',
                                                                                      '서부마케팅본부','25',
                                                                                      '중부마케팅본부','26',
                                                                                      '유통사업부','27',
                                                                                      '특수마케팅본부','28','29'))C
                               ,(SELECT LPAD(LEVEL,2,'2') AS NUM FROM DUAL CONNECT BY LEVEL <=9 ) CC
                         WHERE  C.DATA_SECTION(+)= CC.NUM)
            ,TMP_D  AS (SELECT T1.CNSL_YM
                              ,T1.DATA_SECTION
                              ,T1.CLCT_CNT /* 회수건수 */
                              ,T2.TLY_CNT  /* 감정건수 */
                              ,NVL(DECODE((SUM(T2.TLY_CNT) OVER (PARTITION BY T2.CNSL_YM)),0,NULL,(SUM(T2.TLY_CNT) OVER (PARTITION BY T2.CNSL_YM)))/DECODE((SUM(T1.CLCT_CNT) OVER (PARTITION BY T1.CNSL_YM)),0,NULL,(SUM(T1.CLCT_CNT) OVER (PARTITION BY T1.CNSL_YM))) ,0) AS TLY_RT /*감정율 (감정(건)/회수(건))*/
                         FROM (SELECT A.CNSL_YM        /* 조회년도 */
                                     ,A.DATA_SECTION
                                     ,A.CLCT_CNT       /* 회수건수 */
                              FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                           ,'All' as DATA_SECTION  
                                           ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT  
                                      FROM  TB_EP_CST_CONSULT_MGMT IC
                                           ,TB_EQP_MDL IE
                                      WHERE  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                        AND  IC.DEL_YN   = 'N'
                                        AND  IE.DEL_YN   = 'N'
                                        AND  IC.SCRB_MTHD ='C'            /*가입 방법:기변 */
                                        AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                     GROUP  BY  SUBSTR(IC.CNSL_DT,0,6))A )T1
                          ,(SELECT E.CNSL_YM        /* 조회년도 */
                                  ,E.DATA_SECTION
                                  ,E.TLY_CNT        /* 감정건수 */
                              FROM (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                           ,'All' as DATA_SECTION  
                                           ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                      FROM  TB_EP_CST_PRCHS_MGMT  IA
                                           ,TB_EQP_MDL IE
                                     WHERE  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                                       AND  IA.DEL_YN   = 'N'
                                       AND  IE.DEL_YN   = 'N'
                                       AND  IA.SCRB_MTHD ='C'            /*가입 방법:기변 */
                                       AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                     GROUP  BY  SUBSTR(IA.CNSL_DT,0,6))E) T2
                        WHERE T1.CNSL_YM =   T2.CNSL_YM )                         
              ,TMP_E AS ( SELECT E.CNSL_YM        /* 조회년도 */
                                ,EE.NUM AS DATA_SECTION
                                ,E.TLY_CNT        /* 감정건수 */
                                ,E.BAD_JDG_CNT    /* 오감정(건)*/
                                ,E.JDG_AMT_SUM    /* 감정금액 (매입금액 - 조정금액)*/                              
                                ,NVL(E.JDG_AMT_SUM/DECODE(E.TLY_CNT,0,NULL,E.TLY_CNT),0) AS JDG_UPRC     /* 감정단가 (감정금액/감정건수)*/
                                ,E.BAD_JDG_AMT_SUM   /*오감정금액(천원)*/
                            FROM (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                         ,DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03') AS DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/  
                                         ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                         ,SUM(PRCH_AMT-ADJ_AMT)  AS  JDG_AMT_SUM  /*감정금액*/                                     
                                         ,SUM(DECODE(NVL(IA.SKN_SMPL_JDG_DAMT,0),'0','1')) AS BAD_JDG_CNT /*오감정(건)*/
                                         ,SUM(IA.SKN_SMPL_JDG_DAMT) AS BAD_JDG_AMT_SUM /*오감정금액(천원)*/
                                    FROM  TB_EP_CST_PRCHS_MGMT  IA
                                         ,TB_EQP_MDL IE
                                   WHERE  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                                     AND  IA.DEL_YN   = 'N'
                                     AND  IE.DEL_YN   = 'N'
                                     AND  IA.SCRB_MTHD ='C'            /*가입 방법:기변 */
                                     AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                   GROUP  BY  SUBSTR(IA.CNSL_DT,0,6),DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03'))E
                                  ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=3 ) EE
                          WHERE  E.DATA_SECTION(+)= EE.NUM)
               ,TMP_F AS  (SELECT F.CNSL_YM        /* 조회년도 */
                                ,FF.NUM AS DATA_SECTION
                                ,F.TLY_CNT        /* 감정건수 */
                                ,F.BAD_JDG_CNT    /* 오감정(건)*/
                                ,F.JDG_AMT_SUM    /* 감정금액 (매입금액 - 조정금액)*/                           
                                ,NVL(F.JDG_AMT_SUM/DECODE(F.TLY_CNT,0,NULL,F.TLY_CNT),0) AS JDG_UPRC     /* 감정단가 (감정금액/감정건수)*/
                                ,F.BAD_JDG_AMT_SUM   /*오감정금액(천원)*/
                           FROM (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                        ,DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                            '수도권마케팅2본부','22',
                                                            '부산마케팅본부','23',
                                                            '대구마케팅본부','24',
                                                            '서부마케팅본부','25',
                                                            '중부마케팅본부','26',
                                                            '유통사업부','27',
                                                            '특수마케팅본부','28','29') AS DATA_SECTION  /*마케팅본부분류*/
                                         ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                         ,SUM(PRCH_AMT-ADJ_AMT)  AS  JDG_AMT_SUM  /*감정금액*/
                                         ,SUM(DECODE(NVL(IA.SKN_SMPL_JDG_DAMT,0),'0','1')) AS BAD_JDG_CNT /*오감정(건)*/
                                         ,SUM(IA.SKN_SMPL_JDG_DAMT) AS BAD_JDG_AMT_SUM /*오감정금액(천원)*/
                                  FROM TB_EP_CST_PRCHS_MGMT IA
                                       ,TB_DEALCO IB 
                                       ,TB_EQP_MDL IE
                                       ,(SELECT A.HEADQ_NM 
                                               ,A.MKT_TEAM_NM 
                                               ,A.UKEY_AGN_CD
                                           FROM  TB_EP_BAS_DEAL_CO_MARKETING A
                                               ,(SELECT UKEY_AGN_CD
                                                       ,MAX(AGN_SEQ) AS AGN_SEQ
                                                   FROM TB_EP_BAS_DEAL_CO_MARKETING 
                                                  GROUP BY UKEY_AGN_CD ) B
                                         WHERE A.UKEY_AGN_CD = B.UKEY_AGN_CD
                                           AND A.AGN_SEQ = B.AGN_SEQ 
                                           AND A.DEL_YN ='N'
                                           ) IG
                                 WHERE  IA.CNSL_DEALCO_CD = IB.DEALCO_CD
                                   AND  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                                   AND  IB.UKEY_AGN_CD = IG.UKEY_AGN_CD(+)
                                   AND  IB.EFF_STA_DT <= IA.CNSL_DT
                                   AND  IB.EFF_END_DT >= IA.CNSL_DT
                                   AND  IA.DEL_YN   = 'N'
                                   AND  IB.DEL_YN   = 'N'
                                   AND  IA.SCRB_MTHD ='C'            /*가입 방법:기변 */
                                   AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                 GROUP  BY  SUBSTR(IA.CNSL_DT,0,6),DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                                                      '수도권마케팅2본부','22',
                                                                                      '부산마케팅본부','23',
                                                                                      '대구마케팅본부','24',
                                                                                      '서부마케팅본부','25',
                                                                                      '중부마케팅본부','26',
                                                                                      '유통사업부','27',
                                                                                      '특수마케팅본부','28','29'))F
                               ,(SELECT LPAD(LEVEL,2,'2') AS NUM FROM DUAL CONNECT BY LEVEL <=9 ) FF
                          WHERE  F.DATA_SECTION(+)= FF.NUM)                   
        SELECT  A1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'02'  AS  DATA_GB /* 접수(건) */
                       ,GROUPING(TMP_A.DATA_SECTION) AS G_ID 
                       ,DATA_SECTION /*폰타입구분*/
                       ,NVL(SUM(TMP_A.CNSL_CNT),0)  AS  RSLT_SUM
                       ,NVL(TRUNC(SUM(TMP_A.CNSL_CNT)/12),0)  AS  MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
                 FROM  TMP_A  
                GROUP BY #CNSL_YR#, ROLLUP(TMP_A.DATA_SECTION)
                ORDER  BY TMP_A.DATA_SECTION) A1
        UNION ALL
        SELECT  A2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'02'  AS  DATA_GB /* 접수(건) */
                       , 0 AS G_ID
                       ,DATA_SECTION /*요금납부구분*/
                       ,NVL(SUM(TMP_B.CNSL_CNT),0)  AS  RSLT_SUM
                       ,NVL(TRUNC(SUM(TMP_B.CNSL_CNT)/12),0)  AS  MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
                 FROM  TMP_B  
                GROUP  BY #CNSL_YR#,TMP_B.DATA_SECTION 
                ORDER  BY TMP_B.DATA_SECTION) A2
        UNION ALL
        SELECT  A3.*
         FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'02'  AS  DATA_GB /* 접수(건) */ 
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,NVL(SUM(TMP_C.CNSL_CNT),0)  AS  RSLT_SUM
                       ,NVL(TRUNC(SUM(TMP_C.CNSL_CNT)/12),0)  AS  MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
                 FROM  TMP_C  
                GROUP  BY #CNSL_YR#,TMP_C.DATA_SECTION 
                ORDER  BY TMP_C.DATA_SECTION)  A3
        UNION ALL
        SELECT  H1.*
          FROM (SELECT #CNSL_YR# AS CNSL_YR 
                      ,'04' AS DATA_GB /* 접수금액(천원) */
                      ,GROUPING(TMP_C.DATA_SECTION) AS G_ID
                      ,DATA_SECTION /*마케팅본부분류*/
                      ,ROUND(NVL(SUM(TMP_C.CNSL_AMT_SUM)/1000,0))  AS RSLT_SUM 
                      ,NVL(ROUND((SUM(TMP_C.CNSL_AMT_SUM)/12)/1000),0) AS MTH_AVG 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CNSL_AMT_SUM )),0)/1000) AS MTH_1 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CNSL_AMT_SUM )),0)/1000) AS MTH_2 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CNSL_AMT_SUM )),0)/1000) AS MTH_3 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CNSL_AMT_SUM )),0)/1000) AS MTH_4 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CNSL_AMT_SUM )),0)/1000) AS MTH_5 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CNSL_AMT_SUM )),0)/1000) AS MTH_6 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CNSL_AMT_SUM )),0)/1000) AS MTH_7 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CNSL_AMT_SUM )),0)/1000) AS MTH_8 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CNSL_AMT_SUM )),0)/1000) AS MTH_9 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CNSL_AMT_SUM )),0)/1000) AS MTH_10
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CNSL_AMT_SUM )),0)/1000) AS MTH_11 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CNSL_AMT_SUM )),0)/1000) AS MTH_12
                 FROM  TMP_C
                GROUP  BY #CNSL_YR#,ROLLUP(TMP_C.DATA_SECTION)
                ORDER  BY TMP_C.DATA_SECTION) H1
        UNION ALL
        SELECT J1.*
          FROM (SELECT #CNSL_YR# AS CNSL_YR 
                      ,'05' AS DATA_GB  /* 접수단가(원) */
                      ,GROUPING(TMP_C.DATA_SECTION) AS G_ID 
                      ,DATA_SECTION  /*마케팅본부분류*/
                      ,ROUND(NVL(SUM(TMP_C.CNSL_AMT_SUM)/DECODE(SUM(TMP_C.CNSL_CNT),0,NULL,SUM(TMP_C.CNSL_CNT)),0),0)     AS RSLT_SUM 
                      ,ROUND(NVL(SUM(TMP_C.CNSL_AMT_SUM)/DECODE(SUM(TMP_C.CNSL_CNT),0,NULL,SUM(TMP_C.CNSL_CNT)),0),0)     AS MTH_AVG 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',TMP_C.CNSL_CNT)),0)) AS MTH_1 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',TMP_C.CNSL_CNT)),0)) AS MTH_2 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',TMP_C.CNSL_CNT)),0)) AS MTH_3 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',TMP_C.CNSL_CNT)),0)) AS MTH_4 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',TMP_C.CNSL_CNT)),0)) AS MTH_5 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',TMP_C.CNSL_CNT)),0)) AS MTH_6 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',TMP_C.CNSL_CNT)),0)) AS MTH_7 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',TMP_C.CNSL_CNT)),0)) AS MTH_8 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',TMP_C.CNSL_CNT)),0)) AS MTH_9 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',TMP_C.CNSL_CNT)),0)) AS MTH_10
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',TMP_C.CNSL_CNT)),0)) AS MTH_11 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',TMP_C.CNSL_CNT)),0)) AS MTH_12
                FROM  TMP_C
               GROUP  BY #CNSL_YR#,ROLLUP(TMP_C.DATA_SECTION)
               ORDER  BY TMP_C.DATA_SECTION) J1
        UNION ALL
        SELECT  B1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'06'  AS  DATA_GB /* 회수(건) */
                       ,GROUPING(TMP_A.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/
                       ,NVL(SUM(TMP_A.CLCT_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_A.CLCT_CNT)/12),0) AS MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CLCT_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CLCT_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CLCT_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CLCT_CNT )),0) AS MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CLCT_CNT )),0) AS MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CLCT_CNT )),0) AS MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CLCT_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CLCT_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CLCT_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CLCT_CNT )),0) AS MTH_10 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CLCT_CNT )),0) AS MTH_11 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CLCT_CNT )),0) AS MTH_12
                 FROM  TMP_A  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_A.DATA_SECTION)
                 ORDER BY TMP_A.DATA_SECTION)  B1    
        UNION ALL
        SELECT  B2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'06'  AS  DATA_GB /* 회수(건) */
                        , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,NVL(SUM(TMP_C.CLCT_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_C.CLCT_CNT)/12),0) AS MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CLCT_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CLCT_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CLCT_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CLCT_CNT )),0) AS MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CLCT_CNT )),0) AS MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CLCT_CNT )),0) AS MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CLCT_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CLCT_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CLCT_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CLCT_CNT )),0) AS MTH_10 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CLCT_CNT )),0) AS MTH_11 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CLCT_CNT )),0) AS MTH_12
                 FROM  TMP_C  
                GROUP  BY #CNSL_YR#,TMP_C.DATA_SECTION 
                ORDER  BY TMP_C.DATA_SECTION)  B2
        UNION ALL
        SELECT  C2.*
          FROM (SELECT C.CNSL_YR 
                      ,C.DATA_GB 
                      ,0 AS G_ID 
                      ,C.DATA_SECTION
                      ,NVL(ROUND((C.CLCT_SUM)/( DECODE((SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR)),0,NULL,(SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR))) ),3)*100,0) AS RSLT_SUM 
                      ,NVL(ROUND((C.CLCT_SUM)/( DECODE((SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR)),0,NULL,(SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR))) ),3)*100,0) AS MTH_AVG
                      ,ROUND(C.MTH_1,3)  *100 AS MTH_1 
                      ,ROUND(C.MTH_2,3)  *100 AS MTH_2 
                      ,ROUND(C.MTH_3,3)  *100 AS MTH_3 
                      ,ROUND(C.MTH_4,3)  *100 AS MTH_4 
                      ,ROUND(C.MTH_5,3)  *100 AS MTH_5 
                      ,ROUND(C.MTH_6,3)  *100 AS MTH_6 
                      ,ROUND(C.MTH_7,3)  *100 AS MTH_7 
                      ,ROUND(C.MTH_8,3)  *100 AS MTH_8 
                      ,ROUND(C.MTH_9,3)  *100 AS MTH_9 
                      ,ROUND(C.MTH_10,3) *100 AS MTH_10 
                      ,ROUND(C.MTH_11,3) *100 AS MTH_11 
                      ,ROUND(C.MTH_12,3) *100 AS MTH_12
                FROM 
                    (SELECT  #CNSL_YR#  AS  CNSL_YR
                              ,'07'  AS  DATA_GB /* 회수율(%)  각회수(건)/전체회수(건)*100*/ 
                              ,DATA_SECTION /*마케팅본부분류*/
                              ,NVL(SUM(TMP_C.CLCT_CNT),0) AS CLCT_SUM
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CLCT_RT )),0) AS MTH_1 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CLCT_RT )),0) AS MTH_2 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CLCT_RT )),0) AS MTH_3 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CLCT_RT )),0) AS MTH_4
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CLCT_RT )),0) AS MTH_5
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CLCT_RT )),0) AS MTH_6
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CLCT_RT )),0) AS MTH_7 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CLCT_RT )),0) AS MTH_8 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CLCT_RT )),0) AS MTH_9 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CLCT_RT )),0) AS MTH_10 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CLCT_RT )),0) AS MTH_11 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CLCT_RT )),0) AS MTH_12
                     FROM  TMP_C  
                   GROUP BY #CNSL_YR#,TMP_C.DATA_SECTION
                    ORDER  BY TMP_C.DATA_SECTION)C )C2
        UNION ALL
        SELECT  D1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'08'  AS  DATA_GB /* 감정(건) */
                       ,GROUPING(TMP_E.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/
                       ,NVL(SUM(TMP_E.TLY_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_E.TLY_CNT)/12),0) AS MTH_AVG 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',TLY_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',TLY_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',TLY_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',TLY_CNT )),0) AS MTH_4 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',TLY_CNT )),0) AS MTH_5 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',TLY_CNT )),0) AS MTH_6 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',TLY_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',TLY_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',TLY_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',TLY_CNT )),0) AS MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',TLY_CNT )),0) AS MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',TLY_CNT )),0) AS MTH_12
                 FROM  TMP_E  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_E.DATA_SECTION)
                 ORDER BY TMP_E.DATA_SECTION) D1
        UNION ALL
        SELECT  D2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'08'  AS  DATA_GB /* 감정(건) */
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,NVL(SUM(TMP_F.TLY_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_F.TLY_CNT)/12),0) AS MTH_AVG 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',TLY_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',TLY_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',TLY_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',TLY_CNT )),0) AS MTH_4 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',TLY_CNT )),0) AS MTH_5 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',TLY_CNT )),0) AS MTH_6 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',TLY_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',TLY_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',TLY_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',TLY_CNT )),0) AS MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',TLY_CNT )),0) AS MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',TLY_CNT )),0) AS MTH_12
                 FROM  TMP_F  
                GROUP  BY #CNSL_YR#,TMP_F.DATA_SECTION 
                ORDER  BY TMP_F.DATA_SECTION) D2      
        UNION ALL
        SELECT  E1.*
          FROM (SELECT E.CNSL_YR 
                      ,E.DATA_GB 
                      ,1 AS G_ID 
                      ,E.DATA_SECTION
                      ,NVL(ROUND((E.TLY_SUM)/( DECODE((SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR)),0,NULL,(SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR))) ),3)*100,0) AS RSLT_SUM 
                      ,NVL(ROUND((E.TLY_SUM)/( DECODE((SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR)),0,NULL,(SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR))) ),3)*100,0) AS MTH_AVG
                      ,ROUND(E.MTH_1,3)  *100 AS MTH_1 
                      ,ROUND(E.MTH_2,3)  *100 AS MTH_2 
                      ,ROUND(E.MTH_3,3)  *100 AS MTH_3 
                      ,ROUND(E.MTH_4,3)  *100 AS MTH_4 
                      ,ROUND(E.MTH_5,3)  *100 AS MTH_5 
                      ,ROUND(E.MTH_6,3)  *100 AS MTH_6 
                      ,ROUND(E.MTH_7,3)  *100 AS MTH_7 
                      ,ROUND(E.MTH_8,3)  *100 AS MTH_8 
                      ,ROUND(E.MTH_9,3)  *100 AS MTH_9 
                      ,ROUND(E.MTH_10,3) *100 AS MTH_10 
                      ,ROUND(E.MTH_11,3) *100 AS MTH_11 
                      ,ROUND(E.MTH_12,3) *100 AS MTH_12
                FROM 
                    (SELECT  #CNSL_YR#  AS  CNSL_YR
                            ,'09'  AS  DATA_GB /*감정율 (전체감정(건)/전체회수(건))*/
                            ,DATA_SECTION
                            ,NVL(SUM(TMP_D.TLY_CNT),0) AS TLY_SUM
                            ,NVL(SUM(TMP_D.CLCT_CNT),0) AS CLCT_SUM 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'01',TLY_RT )),0) AS MTH_1 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'02',TLY_RT )),0) AS MTH_2 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'03',TLY_RT )),0) AS MTH_3 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'04',TLY_RT )),0) AS MTH_4
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'05',TLY_RT )),0) AS MTH_5
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'06',TLY_RT )),0) AS MTH_6
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'07',TLY_RT )),0) AS MTH_7 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'08',TLY_RT )),0) AS MTH_8 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'09',TLY_RT )),0) AS MTH_9 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'10',TLY_RT )),0) AS MTH_10 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'11',TLY_RT )),0) AS MTH_11 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'12',TLY_RT )),0) AS MTH_12
                      FROM  TMP_D  
                     GROUP  BY #CNSL_YR#,TMP_D.DATA_SECTION
                     ORDER  BY TMP_D.DATA_SECTION)E )E1
        UNION ALL             
        SELECT  F1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'10'  AS  DATA_GB  /* 감정금액(천원) */
                       ,GROUPING(TMP_E.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION   /*01스마트폰 02피쳐폰 03기타*/
                       ,ROUND(NVL(SUM(TMP_E.JDG_AMT_SUM)/1000,0))  AS  RSLT_SUM
                       ,NVL(ROUND((SUM(TMP_E.JDG_AMT_SUM)/12)/1000),0)  AS  MTH_AVG
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',JDG_AMT_SUM )),0)/1000)  AS  MTH_1
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',JDG_AMT_SUM )),0)/1000)  AS  MTH_2
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',JDG_AMT_SUM )),0)/1000)  AS  MTH_3
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',JDG_AMT_SUM )),0)/1000)  AS  MTH_4
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',JDG_AMT_SUM )),0)/1000)  AS  MTH_5
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',JDG_AMT_SUM )),0)/1000)  AS  MTH_6
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',JDG_AMT_SUM )),0)/1000)  AS  MTH_7
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',JDG_AMT_SUM )),0)/1000)  AS  MTH_8
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',JDG_AMT_SUM )),0)/1000)  AS  MTH_9
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',JDG_AMT_SUM )),0)/1000)  AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',JDG_AMT_SUM )),0)/1000)  AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',JDG_AMT_SUM )),0)/1000)  AS  MTH_12
                 FROM  TMP_E  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_E.DATA_SECTION)
                 ORDER BY TMP_E.DATA_SECTION) F1
        UNION ALL
        SELECT  F2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'10'  AS  DATA_GB  /* 감정금액(천원) */
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,ROUND(NVL(SUM(TMP_F.JDG_AMT_SUM)/1000,0))  AS  RSLT_SUM
                       ,NVL(ROUND((SUM(TMP_F.JDG_AMT_SUM)/12)/1000),0)  AS  MTH_AVG
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',JDG_AMT_SUM )),0)/1000)  AS  MTH_1
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',JDG_AMT_SUM )),0)/1000)  AS  MTH_2
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',JDG_AMT_SUM )),0)/1000)  AS  MTH_3
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',JDG_AMT_SUM )),0)/1000)  AS  MTH_4
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',JDG_AMT_SUM )),0)/1000)  AS  MTH_5
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',JDG_AMT_SUM )),0)/1000)  AS  MTH_6
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',JDG_AMT_SUM )),0)/1000)  AS  MTH_7
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',JDG_AMT_SUM )),0)/1000)  AS  MTH_8
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',JDG_AMT_SUM )),0)/1000)  AS  MTH_9
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',JDG_AMT_SUM )),0)/1000)  AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',JDG_AMT_SUM )),0)/1000)  AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',JDG_AMT_SUM )),0)/1000)  AS  MTH_12
                 FROM  TMP_F  
                GROUP  BY #CNSL_YR#,TMP_F.DATA_SECTION 
                ORDER  BY TMP_F.DATA_SECTION) F2    
        UNION ALL
        SELECT  G1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'11'  AS  DATA_GB  /* 감정단가(원)	*/
                       ,GROUPING(TMP_E.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION   /*01스마트폰 02피쳐폰 03기타*/
                       ,ROUND(NVL(SUM(TMP_E.JDG_AMT_SUM)/DECODE(SUM(TMP_E.TLY_CNT),0,NULL,SUM(TMP_E.TLY_CNT)),0),0)  AS  RSLT_SUM
                       ,ROUND(NVL(SUM(TMP_E.JDG_AMT_SUM)/DECODE(SUM(TMP_E.TLY_CNT),0,NULL,SUM(TMP_E.TLY_CNT)),0),0)  AS  MTH_AVG
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',TMP_E.TLY_CNT)),0)) AS  MTH_1
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',TMP_E.TLY_CNT)),0)) AS  MTH_2
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',TMP_E.TLY_CNT)),0))	AS  MTH_3
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',TMP_E.TLY_CNT)),0))	AS  MTH_4
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',TMP_E.TLY_CNT)),0))	AS  MTH_5
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',TMP_E.TLY_CNT)),0))	AS  MTH_6
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',TMP_E.TLY_CNT)),0))	AS  MTH_7
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',TMP_E.TLY_CNT)),0))	AS  MTH_8
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',TMP_E.TLY_CNT)),0))	AS  MTH_9
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',TMP_E.TLY_CNT)),0))	AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',TMP_E.TLY_CNT)),0))	AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',TMP_E.TLY_CNT)),0))	AS  MTH_12
                 FROM  TMP_E  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_E.DATA_SECTION)
                 ORDER BY TMP_E.DATA_SECTION) G1
        UNION ALL
        SELECT  G2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'11'  AS  DATA_GB  /* 감정단가(원)	*/
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/                                                                                                                   
                       ,ROUND(NVL(SUM(TMP_F.JDG_AMT_SUM)/DECODE(SUM(TMP_F.TLY_CNT),0,NULL,SUM(TMP_F.TLY_CNT)),0),0)  AS  RSLT_SUM                                         
                       ,ROUND(NVL(SUM(TMP_F.JDG_AMT_SUM)/DECODE(SUM(TMP_F.TLY_CNT),0,NULL,SUM(TMP_F.TLY_CNT)),0),0)  AS  MTH_AVG                                          
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',TMP_F.TLY_CNT)),0)) AS  MTH_1 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',TMP_F.TLY_CNT)),0)) AS  MTH_2 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',TMP_F.TLY_CNT)),0))	AS  MTH_3 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',TMP_F.TLY_CNT)),0))	AS  MTH_4 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',TMP_F.TLY_CNT)),0))	AS  MTH_5 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',TMP_F.TLY_CNT)),0))	AS  MTH_6 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',TMP_F.TLY_CNT)),0))	AS  MTH_7 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',TMP_F.TLY_CNT)),0))	AS  MTH_8 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',TMP_F.TLY_CNT)),0))	AS  MTH_9 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',TMP_F.TLY_CNT)),0))	AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',TMP_F.TLY_CNT)),0))	AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',TMP_F.TLY_CNT)),0))	AS  MTH_12
                 FROM  TMP_F  
                GROUP  BY #CNSL_YR#,TMP_F.DATA_SECTION 
                ORDER  BY TMP_F.DATA_SECTION) G2
      UNION ALL
      SELECT K1.*
        FROM (SELECT #CNSL_YR# AS CNSL_YR 
                    ,'12' AS DATA_GB  /* 오감정(건) */
                    ,GROUPING(TMP_F.DATA_SECTION) AS G_ID 
                    ,DATA_SECTION    /*마케팅본부분류*/
                    ,NVL(SUM(TMP_F.BAD_JDG_CNT),0) AS RSLT_SUM 
                    ,NVL(TRUNC(SUM(TMP_F.BAD_JDG_CNT)/12),0) AS MTH_AVG 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',BAD_JDG_CNT )),0) AS MTH_1 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',BAD_JDG_CNT )),0) AS MTH_2 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',BAD_JDG_CNT )),0) AS MTH_3 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',BAD_JDG_CNT )),0) AS MTH_4 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',BAD_JDG_CNT )),0) AS MTH_5 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',BAD_JDG_CNT )),0) AS MTH_6 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',BAD_JDG_CNT )),0) AS MTH_7 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',BAD_JDG_CNT )),0) AS MTH_8 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',BAD_JDG_CNT )),0) AS MTH_9 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',BAD_JDG_CNT )),0) AS MTH_10
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',BAD_JDG_CNT )),0) AS MTH_11 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',BAD_JDG_CNT )),0) AS MTH_12
              FROM  TMP_F
              GROUP BY #CNSL_YR#,ROLLUP(TMP_F.DATA_SECTION)
              ORDER BY TMP_F.DATA_SECTION) K1
      UNION ALL
      SELECT K2.*
        FROM (SELECT #CNSL_YR# AS CNSL_YR
                    ,'13' AS DATA_GB /* 오감정금액(천원) */
                    ,GROUPING(TMP_F.DATA_SECTION) AS G_ID
                    ,DATA_SECTION /*마케팅본부분류*/
                    ,ROUND(NVL(SUM(TMP_F.BAD_JDG_AMT_SUM)/1000,0)) AS RSLT_SUM 
                    ,NVL(ROUND((SUM(TMP_F.BAD_JDG_AMT_SUM)/12)/1000),0) AS MTH_AVG 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_1 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_2 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_3 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_4 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_5 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_6 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_7 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_8 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_9 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_10
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_11
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_12
              FROM  TMP_F
              GROUP BY #CNSL_YR#,ROLLUP(TMP_F.DATA_SECTION)
              ORDER BY TMP_F.DATA_SECTION ) K2            
)T
ORDER BY T.DATA_GB,T.G_ID DESC ,T.DATA_SECTION]]>
	</select>
	<select id="SB2CSaleList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SB2CSaleList B2C판매실적현황조회 */
/* IO: 정동현,2015-11-12T13:49:08(정동현,2015-10-20T18:57:42) */
SELECT  * 
  FROM  (
         SELECT  SELL_YR
                ,DATA_GB
                ,TYP
                ,SELL_DTM
                ,CNT
                ,G_ID
                ,CASE WHEN DATA_GB = '01' THEN SUM(SUM_APPL) OVER(PARTITION BY DATA_GB, TYP)
                      WHEN DATA_GB = '02' THEN SUM(SUM_INVE) OVER(PARTITION BY DATA_GB, TYP)
                      WHEN DATA_GB = '03' THEN SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, TYP)
                      WHEN DATA_GB = '04' THEN ROUND(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP)/1000)
                      WHEN DATA_GB = '05' THEN ROUND(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP) / DECODE(SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, TYP),0,NULL,SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, TYP)))
                      WHEN DATA_GB = '06' THEN ROUND(SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, TYP)/1000)
                      WHEN DATA_GB = '07' THEN ROUND(SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, TYP) / DECODE(SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, TYP),0,NULL,SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, TYP)))
                      WHEN DATA_GB = '08' THEN ROUND((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, TYP))/1000)
                      WHEN DATA_GB = '09' THEN ROUND((NVL((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, TYP)) / DECODE(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP),0,NULL,SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP)),0))*100,1)
                 END AS RSLT_SUM
                ,CASE WHEN DATA_GB = '01' THEN ROUND(SUM(SUM_APPL) OVER(PARTITION BY DATA_GB, TYP)/#MTH_CNT#)
                      WHEN DATA_GB = '02' THEN ROUND(SUM(SUM_INVE) OVER(PARTITION BY DATA_GB, TYP)/#MTH_CNT#)
                      WHEN DATA_GB = '03' THEN ROUND(SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, TYP)/#MTH_CNT#)
                      WHEN DATA_GB = '04' THEN ROUND(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP)/1000/#MTH_CNT#)
                      WHEN DATA_GB = '05' THEN ROUND(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP)/#MTH_CNT# / DECODE(SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, TYP),0,NULL,SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, TYP))/#MTH_CNT#)
                      WHEN DATA_GB = '06' THEN ROUND(SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, TYP)/1000/#MTH_CNT#)
                      WHEN DATA_GB = '07' THEN ROUND(SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, TYP)/#MTH_CNT# / DECODE(SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, TYP),0,NULL,SUM(SUM_QTY) OVER(PARTITION BY DATA_GB, TYP))/#MTH_CNT# )
                      WHEN DATA_GB = '08' THEN ROUND((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, TYP))/1000/#MTH_CNT#)
                      WHEN DATA_GB = '09' THEN ROUND(NVL(((SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP) - SUM(SUM_PCOST) OVER(PARTITION BY DATA_GB, TYP))/#MTH_CNT#) / (DECODE(SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP),0,NULL,SUM(SUM_PRC) OVER(PARTITION BY DATA_GB, TYP))/#MTH_CNT#),0)*100,1)
                 END AS MTH_AVG
           FROM  (
                    SELECT  /*+ ORDERED */
                    	    A.SELL_YR                       /* 판매년도 */
                           ,B.NUM AS DATA_GB                /* 구분 ( 01: 구매신청(건), 02: 재고(건), 03: 판매(건), 04: 판매금액(천원), 05: 판매단가(원), 06: 매입금액(천원), 07: 매입단가(원), 08: 매출이익(원), 09: 매출이익률(%) )*/
                           ,A.TYP                           /* 핸드폰유형 */
                           ,A.SELL_DTM                      /* 판매일자 */
                           ,GROUPING_ID(A.TYP)  AS  G_ID
                           ,SUM(A.APPL_CNT) AS SUM_APPL
                           ,SUM(A.INVE_CNT)  AS  SUM_INVE
                           ,SUM(A.SELL_QTY) AS SUM_QTY
                           ,SUM(A.SELL_PRC) AS SUM_PRC
                           ,SUM(A.SELL_PCOST) AS SUM_PCOST
                           ,CASE WHEN B.NUM = '01' THEN SUM(A.APPL_CNT)                                                                                              /* 01 : 구매신청(건)*/
                                 WHEN B.NUM = '02' THEN SUM(A.INVE_CNT)                                                                                              /* 02 : 재고(건) */
                                 WHEN B.NUM = '03' THEN SUM(A.SELL_QTY)                                                                                              /* 03 : 판매(건) */
                                 WHEN B.NUM = '04' THEN ROUND(SUM(A.SELL_PRC)/1000)                                                                                  /* 04 : 판매금액(천원) */
                                 WHEN B.NUM = '05' THEN ROUND(SUM(A.SELL_PRC) / DECODE(SUM(A.SELL_QTY),0,NULL,SUM(A.SELL_QTY)))                                      /* 05 : 판매단가(원) : 판매금액/판매건수 */                                    
                                 WHEN B.NUM = '06' THEN ROUND(SUM(A.SELL_PCOST)/1000)                                                                                /* 06 : 매입금액(천원) */
                                 WHEN B.NUM = '07' THEN ROUND(SUM(A.SELL_PCOST) / DECODE(SUM(A.SELL_QTY),0,NULL,SUM(A.SELL_QTY)))                                    /* 07 : 매입단가(원) : 매입금액/판매건수 */
                                 WHEN B.NUM = '08' THEN ROUND((SUM(A.SELL_PRC) - SUM(A.SELL_PCOST))/1000)                                                            /* 08 : 매출이익(원) : 판매금액-매입금액 */
                                 WHEN B.NUM = '09' THEN ROUND((NVL((SUM(A.SELL_PRC) - SUM(A.SELL_PCOST)) / DECODE(SUM(A.SELL_PRC),0,NULL,SUM(A.SELL_PRC)),0))*100,1) /* 09 : 매출이익률(%) : 매출이익/판매금액 */
                            END AS CNT
                      FROM  (
                             SELECT  SUBSTR(IA.SELL_DTM,0,4) AS SELL_YR
                                    ,SUBSTR(IA.SELL_DTM,5,2) AS SELL_DTM
                                    ,CASE  WHEN SUBSTR(IC.EQP_MDL_NM,0,8) = 'SHV-E210' THEN '01'   /* 01 : 갤럭시S3 */
                                           WHEN SUBSTR(IC.EQP_MDL_NM,0,8) = 'SHV-E300' THEN '02'   /* 02 : 갤럭시S4 */
                                           WHEN SUBSTR(IC.EQP_MDL_NM,0,8) = 'SM-G900S' THEN '03'   /* 03 : 갤럭스S5 */
                                           WHEN SUBSTR(IC.EQP_MDL_NM,0,8) = 'SHV-E250' THEN '04'   /* 04 : 갤럭시노트2 */
                                           WHEN SUBSTR(IC.EQP_MDL_NM,0,8) = 'SM-N900S' THEN '05'   /* 05 : 갤럭시노트3 */
                                           WHEN SUBSTR(IC.EQP_MDL_NM,0,8) = 'IPHONE4_' THEN '06'   /* 06 : iPhone4 */
                                           WHEN SUBSTR(IC.EQP_MDL_NM,0,8) = 'IPHONE4S' THEN '07'   /* 07 : iPhone4S */
                                           WHEN SUBSTR(IC.EQP_MDL_NM,0,8) = 'IPHONE5_' THEN '08'   /* 08 : iPhone5 */
                                           WHEN SUBSTR(IC.EQP_MDL_NM,0,8) = 'IPHONE5S' THEN '09'   /* 09 : iPhone5S */
                                           WHEN SUBSTR(IC.EQP_MDL_NM,0,8) = 'LG-F320S' THEN '10'   /* 10 : LG G2 */ 
                                           WHEN SUBSTR(IC.EQP_MDL_NM,0,8) = 'LG-F400S' THEN '11'   /* 11 : LG G3 */
                                           ELSE '12'                                               /* 12 : 기타 */
                                     END   AS TYP                                                  /* 핸드폰 유형 */
                                  ,DECODE(IA.GNRL_SELL_NO,NULL,0,1) AS SELL_QTY
                                  ,DECODE(ID.EQP_MDL_CD,NULL,0,1) AS INVE_CNT
                                  ,(SELECT COUNT(*) FROM TB_EP_CST_CONSULT_DTL WHERE IE.CNSL_MGMT_NO = CNSL_MGMT_NO) AS APPL_CNT
                                  ,NVL(IB.SELL_PRC,0)   AS SELL_PRC
                                  ,NVL(IB.SELL_PCOST,0) AS SELL_PCOST
                             FROM  TB_EP_SAL_GNRL_SALE  IA
                                  ,TB_EP_SAL_EQUIPMENT_SALE  IB
                                  ,TB_EQP_MDL IC
                                  ,TB_EP_DIS_PROD_DIS ID
                                  ,TB_EP_CST_CONSULT_MGMT IE
                            WHERE  IA.GNRL_SELL_NO = IB.GNRL_SELL_NO
                              AND  IA.GNRL_SELL_CHG_SEQ = IB.GNRL_SELL_CHG_SEQ
                              AND  IB.EQP_MDL_CD = IC.EQP_MDL_CD(+) 
                              AND  IB.PROD_SER_NO = ID.EQP_SER_NO(+)
                              AND  IB.EQP_SER_NO = IE.EQP_SER_NO(+)
                              AND  IB.EQP_MDL_CD = IE.EQP_MDL_CD(+) 
                              AND  IB.EQP_COLOR_CD = IE.EQP_COLOR_CD(+)
                              AND  IA.SELL_DTM >= #SELL_YR# || '0101000000'
                              AND  IA.SELL_DTM <= #SELL_YR# || '1231240000'
                              AND  IA.SELL_CNCL_YN <> 'Y'                                           /* 판매취소여부*/
                              AND  IA.SELL_TYP IN ('02','03')                                       /* 판매 유형 (01:B2B, 02:B2C, 03:B2C온라인) */            
                              AND  ID.IN_OUT_CL(+) = '100'                                          /* 입고 출고 구분 ( 100: 입고 )*/
                          ) A
                         ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=9 ) B
                   GROUP  BY A.SELL_YR ,A.SELL_DTM ,B.NUM,ROLLUP(A.TYP)
                 )
           
        )
PIVOT  (
        MIN(CNT)
        FOR SELL_DTM IN ( '01' AS MTH_1 ,'02' AS MTH_2 ,'03' AS MTH_3 ,'04' AS MTH_4 ,'05' AS MTH_5 ,'06' AS MTH_6
                         ,'07' AS MTH_7 ,'08' AS MTH_8 ,'09' AS MTH_9 ,'10' AS MTH_10 ,'11' AS MTH_11 ,'12' AS MTH_12 )
        )
ORDER  BY DATA_GB, G_ID DESC,TYP]]>
	</select>
	<select id="SInqTEchoSaleList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SInqTEchoSaleList T에코실적현황조회 */
/* IO: 박민정,2015-11-18T14:05:09(박민정,2015-10-21T17:05:53) */
SELECT T.* 
  FROM (WITH  TMP_A  AS  (SELECT A.CNSL_YM        /* 조회년도 */
                                 ,AA.NUM AS DATA_SECTION
                                 ,A.CNSL_CNT       /* 접수건수 */
                                 ,A.CLCT_CNT       /* 회수건수 */
                                 ,A.CNSL_AMT_SUM      /* 접수금액*/
                                 ,NVL(A.CNSL_AMT_SUM/DECODE(A.CNSL_CNT,0,NULL,A.CNSL_CNT),0) AS CNSL_UPRC  /* 접수단가 (접수금액/접수건수)*/
                                 ,NVL(A.CLCT_CNT/DECODE((SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0) AS CLCT_RT  /* 회수율 (매입유형회수(건)/전체회수(건)) */
                            FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                         ,DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03') AS DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/
                                         ,COUNT(IC.CNSL_MGMT_NO)  AS  CNSL_CNT
                                         ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                                         ,SUM(IC.CNSL_AMT)  AS CNSL_AMT_SUM    /*접수금액(상담금액)*/
                                    FROM  TB_EP_CST_CONSULT_MGMT IC
                                         ,TB_EQP_MDL IE
                                   WHERE  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                     AND  IC.DEL_YN   = 'N'
                                     AND  IE.DEL_YN   = 'N'                                   
                                     AND  SUBSTR(IC.CNSL_MGMT_NO,0,1)='C'   /* T에코 실적  CNSL_MGMT_NO C로 시작되고 2015년3월이전, 2015년4월이후  AND 기변이아니고 클럽T가 아님*/
                                     AND  (SUBSTR(IC.CNSL_DT,0,6) <='201503' OR (SUBSTR(IC.CNSL_DT,0,6) >'201503' AND IC.SCRB_MTHD != 'C' AND  IC.SCRB_MTHD != 'T' ))
                                     AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                   GROUP  BY  SUBSTR(IC.CNSL_DT,0,6),DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03'))A
                                  ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=3 ) AA
                                   WHERE  A.DATA_SECTION(+)= AA.NUM)              
             ,TMP_B  AS  (SELECT B.CNSL_YM       /* 조회년도 */
                                 ,BB.NUM AS DATA_SECTION
                                 ,B.CNSL_CNT      /* 접수건수 */
                                 ,B.CLCT_CNT      /* 회수건수 */
                                 ,B.CNSL_AMT_SUM      /* 접수금액*/
                            FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                         ,NVL(ID.DATA_SECTION,'15') DATA_SECTION
                                         ,COUNT(IC.CNSL_MGMT_NO)  AS  CNSL_CNT /*접수건*/
                                         ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                                         ,SUM(IC.CNSL_AMT)  AS CNSL_AMT_SUM    /*접수금액(상담금액)*/
                                    FROM  TB_EP_CST_CONSULT_MGMT IC
                                          ,(SELECT A.CNSL_MGMT_NO
                                                  ,NVL(DECODE(NVL(A.SKN_CL,'N'),'Y'
                                                      ,DECODE(NVL(A.PRE_DC_CL,'N'),'Y','11'   
                                                      ,DECODE(NVL(A.ASIANA_CARD_NO,'N'),'N'  
                                                      ,DECODE(A.PAY_MTHD,'02','12'             
                                                      ,DECODE(A.PAY_MTHD,'01','13','15')),'14')) /*11선할인, 12요금선납, 13계좌송금, 14아시아나 15해당없음*/
                                                      ,DECODE(NVL(B.FEE_DEDC_YN,'0'),'1','12','13')),'15') AS DATA_SECTION
                                              FROM TB_EP_CST_CONSULT_MGMT A
                                                   , (SELECT CNSL_MGMT_NO, MAX(FEE_DEDC_YN) FEE_DEDC_YN FROM TB_EP_CST_PRCHS_MGMT WHERE DEL_YN = 'N' GROUP BY CNSL_MGMT_NO) B
                                             WHERE A.DEL_YN = 'N'
                                               AND A.CNSL_MGMT_NO = B.CNSL_MGMT_NO(+)
                                         ) ID                                       
                                         ,TB_EQP_MDL IE
                                   WHERE  IC.CNSL_MGMT_NO = ID.CNSL_MGMT_NO(+)
                                     AND  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                     AND  IC.DEL_YN   = 'N'
                                     AND  IE.DEL_YN   = 'N'
                                     AND  SUBSTR(IC.CNSL_MGMT_NO,0,1)='C'   /* T에코 실적  CNSL_MGMT_NO C로 시작되고 2015년3월이전, 2015년4월이후  AND 기변이아니고 클럽T가 아님*/
                                     AND  (SUBSTR(IC.CNSL_DT,0,6) <='201503' OR (SUBSTR(IC.CNSL_DT,0,6) >'201503' AND IC.SCRB_MTHD != 'C' AND  IC.SCRB_MTHD != 'T' ))
                                     AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                   GROUP BY SUBSTR(IC.CNSL_DT,0,6), NVL(ID.DATA_SECTION,'15'))B
                                 ,(SELECT LPAD(LEVEL,2,'1') AS NUM FROM DUAL CONNECT BY LEVEL <=5 ) BB
                                   WHERE  B.DATA_SECTION(+)= BB.NUM)  
             ,TMP_C  AS  (SELECT C.CNSL_YM        /* 조회년도 */
                                ,CC.NUM AS DATA_SECTION
                                ,C.CNSL_CNT       /* 접수건수 */
                                ,C.CLCT_CNT       /* 회수건수 */
                                ,C.CNSL_AMT_SUM      /* 접수금액*/
                                ,NVL(C.CNSL_AMT_SUM/DECODE(C.CNSL_CNT,0,NULL,C.CNSL_CNT),0) AS CNSL_UPRC  /* 접수단가 (접수금액/접수건수)*/
                                ,NVL(C.CLCT_CNT/DECODE((SUM(C.CLCT_CNT) OVER (PARTITION BY C.CNSL_YM)),0,NULL,(SUM(C.CLCT_CNT) OVER (PARTITION BY C.CNSL_YM))) ,0) AS CLCT_RT  /* 회수율 (매입유형회수(건)/전체회수(건)) */
                           FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                        ,DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                            '수도권마케팅2본부','22',
                                                            '부산마케팅본부','23',
                                                            '대구마케팅본부','24',
                                                            '서부마케팅본부','25',
                                                            '중부마케팅본부','26',
                                                            '유통사업부','27',
                                                            '특수마케팅본부','28','29') AS DATA_SECTION  /*마케팅본부분류*/
                                        ,COUNT(IC.CNSL_MGMT_NO)  AS  CNSL_CNT
                                        ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                                        ,SUM(IC.CNSL_AMT)  AS CNSL_AMT_SUM    /*접수금액(상담금액)*/
                                  FROM  TB_EP_CST_CONSULT_MGMT IC
                                       ,TB_DEALCO IB 
                                       ,TB_EQP_MDL IE
                                       ,(SELECT A.HEADQ_NM 
                                               ,A.MKT_TEAM_NM 
                                               ,A.UKEY_AGN_CD
                                           FROM  TB_EP_BAS_DEAL_CO_MARKETING A
                                               ,(SELECT UKEY_AGN_CD
                                                       ,MAX(AGN_SEQ) AS AGN_SEQ
                                                   FROM TB_EP_BAS_DEAL_CO_MARKETING 
                                                  GROUP BY UKEY_AGN_CD ) B
                                         WHERE A.UKEY_AGN_CD = B.UKEY_AGN_CD
                                           AND A.AGN_SEQ = B.AGN_SEQ 
                                           AND A.DEL_YN ='N'
                                           ) IG
                                 WHERE  IC.CNSL_DEALCO_CD = IB.DEALCO_CD
                                   AND  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                   AND  IB.UKEY_AGN_CD = IG.UKEY_AGN_CD(+)
                                   AND  IB.EFF_STA_DT <= IC.CNSL_DT
                                   AND  IB.EFF_END_DT >= IC.CNSL_DT
                                   AND  IC.DEL_YN   = 'N'
                                   AND  IB.DEL_YN   = 'N'
                                   AND  SUBSTR(IC.CNSL_MGMT_NO,0,1)='C'   /* T에코 실적  CNSL_MGMT_NO C로 시작되고 2015년3월이전, 2015년4월이후  AND 기변이아니고 클럽T가 아님*/
                                   AND  (SUBSTR(IC.CNSL_DT,0,6) <='201503' OR (SUBSTR(IC.CNSL_DT,0,6) >'201503' AND IC.SCRB_MTHD != 'C' AND  IC.SCRB_MTHD != 'T' ))
                                   AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                 GROUP  BY  SUBSTR(IC.CNSL_DT,0,6),DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                                                      '수도권마케팅2본부','22',
                                                                                      '부산마케팅본부','23',
                                                                                      '대구마케팅본부','24',
                                                                                      '서부마케팅본부','25',
                                                                                      '중부마케팅본부','26',
                                                                                      '유통사업부','27',
                                                                                      '특수마케팅본부','28','29'))C
                               ,(SELECT LPAD(LEVEL,2,'2') AS NUM FROM DUAL CONNECT BY LEVEL <=9 ) CC
                               WHERE  C.DATA_SECTION(+)= CC.NUM)
             ,TMP_D  AS (SELECT T1.CNSL_YM
                               ,T1.DATA_SECTION
                               ,T1.CLCT_CNT /* 회수건수 */
                               ,T2.TLY_CNT  /* 감정건수 */
                               ,NVL(DECODE((SUM(T2.TLY_CNT) OVER (PARTITION BY T2.CNSL_YM)),0,NULL,(SUM(T2.TLY_CNT) OVER (PARTITION BY T2.CNSL_YM)))/DECODE((SUM(T1.CLCT_CNT) OVER (PARTITION BY T1.CNSL_YM)),0,NULL,(SUM(T1.CLCT_CNT) OVER (PARTITION BY T1.CNSL_YM))) ,0) AS TLY_RT /*감정율 (감정(건)/회수(건))*/
                         FROM (SELECT A.CNSL_YM        /* 조회년도 */
                                     ,A.DATA_SECTION
                                     ,A.CLCT_CNT       /* 회수건수 */
                                FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                             ,'All' as DATA_SECTION  
                                             ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT  
                                        FROM  TB_EP_CST_CONSULT_MGMT IC
                                             ,TB_EQP_MDL IE
                                       WHERE  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                         AND  IC.DEL_YN   = 'N'
                                         AND  IE.DEL_YN   = 'N'
                                         AND  SUBSTR(IC.CNSL_MGMT_NO,0,1)='C'   /* T에코 실적  CNSL_MGMT_NO C로 시작되고 2015년3월이전, 2015년4월이후  AND 기변이아니고 클럽T가 아님*/
                                         AND  (SUBSTR(IC.CNSL_DT,0,6) <='201503' OR (SUBSTR(IC.CNSL_DT,0,6) >'201503' AND IC.SCRB_MTHD != 'C' AND  IC.SCRB_MTHD != 'T' ))
                                         AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                       GROUP  BY  SUBSTR(IC.CNSL_DT,0,6))A )T1
                            ,(SELECT E.CNSL_YM        /* 조회년도 */
                                    ,E.DATA_SECTION
                                    ,E.TLY_CNT        /* 감정건수 */
                                FROM (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                             ,'All' as DATA_SECTION  
                                             ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                        FROM  TB_EP_CST_PRCHS_MGMT  IA
                                             ,TB_EQP_MDL IE
                                       WHERE  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                                         AND  IA.DEL_YN   = 'N'
                                         AND  IE.DEL_YN   = 'N'
                                         AND  SUBSTR(IA.CNSL_MGMT_NO,0,1)='C'   /* T에코 실적  CNSL_MGMT_NO C로 시작되고 2015년3월이전, 2015년4월이후  AND 기변이아니고 클럽T가 아님*/
                                         AND  (SUBSTR(IA.CNSL_DT,0,6) <='201503' OR (SUBSTR(IA.CNSL_DT,0,6) >'201503' AND IA.SCRB_MTHD != 'C' AND  IA.SCRB_MTHD != 'T' ))
                                         AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                       GROUP  BY  SUBSTR(IA.CNSL_DT,0,6))E) T2
                           WHERE T1.CNSL_YM =   T2.CNSL_YM)
             ,TMP_E AS ( SELECT E.CNSL_YM        /* 조회년도 */
                                ,EE.NUM AS DATA_SECTION
                                ,E.TLY_CNT        /* 감정건수 */
                                ,E.BAD_JDG_CNT    /* 오감정(건)*/
                                ,E.JDG_AMT_SUM    /* 감정금액 (매입금액 - 조정금액)*/                              
                                ,NVL(E.JDG_AMT_SUM/DECODE(E.TLY_CNT,0,NULL,E.TLY_CNT),0) AS JDG_UPRC     /* 감정단가 (감정금액/감정건수)*/
                                ,E.BAD_JDG_AMT_SUM   /*오감정금액(천원)*/
                            FROM (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                         ,DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03') AS DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/  
                                         ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                         ,SUM(PRCH_AMT-ADJ_AMT)  AS  JDG_AMT_SUM  /*감정금액*/                                     
                                         ,SUM(DECODE(NVL(IA.SKN_SMPL_JDG_DAMT,0),'0','1')) AS BAD_JDG_CNT /*오감정(건)*/
                                         ,SUM(IA.SKN_SMPL_JDG_DAMT) AS BAD_JDG_AMT_SUM /*오감정금액(천원)*/
                                    FROM  TB_EP_CST_PRCHS_MGMT  IA
                                         ,TB_EQP_MDL IE
                                   WHERE  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                                     AND  IA.DEL_YN   = 'N'
                                     AND  IE.DEL_YN   = 'N'
                                     AND  SUBSTR(IA.CNSL_MGMT_NO,0,1)='C'   /* T에코 실적  CNSL_MGMT_NO C로 시작되고 2015년3월이전, 2015년4월이후  AND 기변이아니고 클럽T가 아님*/
                                     AND  (SUBSTR(IA.CNSL_DT,0,6) <='201503' OR (SUBSTR(IA.CNSL_DT,0,6) >'201503' AND IA.SCRB_MTHD != 'C' AND  IA.SCRB_MTHD != 'T' ))
                                     AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                   GROUP  BY  SUBSTR(IA.CNSL_DT,0,6),DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03'))E
                                  ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=3 ) EE
                          WHERE  E.DATA_SECTION(+)= EE.NUM)
               ,TMP_F AS  (SELECT F.CNSL_YM        /* 조회년도 */
                                ,FF.NUM AS DATA_SECTION
                                ,F.TLY_CNT        /* 감정건수 */
                                ,F.BAD_JDG_CNT    /* 오감정(건)*/
                                ,F.JDG_AMT_SUM    /* 감정금액 (매입금액 - 조정금액)*/                           
                                ,NVL(F.JDG_AMT_SUM/DECODE(F.TLY_CNT,0,NULL,F.TLY_CNT),0) AS JDG_UPRC     /* 감정단가 (감정금액/감정건수)*/
                                ,F.BAD_JDG_AMT_SUM   /*오감정금액(천원)*/
                           FROM (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                        ,DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                            '수도권마케팅2본부','22',
                                                            '부산마케팅본부','23',
                                                            '대구마케팅본부','24',
                                                            '서부마케팅본부','25',
                                                            '중부마케팅본부','26',
                                                            '유통사업부','27',
                                                            '특수마케팅본부','28','29') AS DATA_SECTION  /*마케팅본부분류*/
                                         ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                         ,SUM(PRCH_AMT-ADJ_AMT)  AS  JDG_AMT_SUM  /*감정금액*/
                                         ,SUM(DECODE(NVL(IA.SKN_SMPL_JDG_DAMT,0),'0','1')) AS BAD_JDG_CNT /*오감정(건)*/
                                         ,SUM(IA.SKN_SMPL_JDG_DAMT) AS BAD_JDG_AMT_SUM /*오감정금액(천원)*/
                                  FROM TB_EP_CST_PRCHS_MGMT IA
                                       ,TB_DEALCO IB 
                                       ,TB_EQP_MDL IE
                                       ,(SELECT A.HEADQ_NM 
                                               ,A.MKT_TEAM_NM 
                                               ,A.UKEY_AGN_CD
                                           FROM  TB_EP_BAS_DEAL_CO_MARKETING A
                                               ,(SELECT UKEY_AGN_CD
                                                       ,MAX(AGN_SEQ) AS AGN_SEQ
                                                   FROM TB_EP_BAS_DEAL_CO_MARKETING 
                                                  GROUP BY UKEY_AGN_CD ) B
                                         WHERE A.UKEY_AGN_CD = B.UKEY_AGN_CD
                                           AND A.AGN_SEQ = B.AGN_SEQ 
                                           AND A.DEL_YN ='N'
                                           ) IG
                                 WHERE  IA.CNSL_DEALCO_CD = IB.DEALCO_CD
                                   AND  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                                   AND  IB.UKEY_AGN_CD = IG.UKEY_AGN_CD(+)
                                   AND  IB.EFF_STA_DT <= IA.CNSL_DT
                                   AND  IB.EFF_END_DT >= IA.CNSL_DT
                                   AND  IA.DEL_YN   = 'N'
                                   AND  IB.DEL_YN   = 'N'
                                   AND  SUBSTR(IA.CNSL_MGMT_NO,0,1)='C'   /* T에코 실적  CNSL_MGMT_NO C로 시작되고 2015년3월이전, 2015년4월이후  AND 기변이아니고 클럽T가 아님*/
                                   AND  (SUBSTR(IA.CNSL_DT,0,6) <='201503' OR (SUBSTR(IA.CNSL_DT,0,6) >'201503' AND IA.SCRB_MTHD != 'C' AND  IA.SCRB_MTHD != 'T' ))
                                   AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                 GROUP  BY  SUBSTR(IA.CNSL_DT,0,6),DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                                                      '수도권마케팅2본부','22',
                                                                                      '부산마케팅본부','23',
                                                                                      '대구마케팅본부','24',
                                                                                      '서부마케팅본부','25',
                                                                                      '중부마케팅본부','26',
                                                                                      '유통사업부','27',
                                                                                      '특수마케팅본부','28','29'))F
                               ,(SELECT LPAD(LEVEL,2,'2') AS NUM FROM DUAL CONNECT BY LEVEL <=9 ) FF
                          WHERE  F.DATA_SECTION(+)= FF.NUM)
        SELECT  A1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'02'  AS  DATA_GB /* 접수(건) */
                       ,GROUPING(TMP_A.DATA_SECTION) AS G_ID 
                       ,DATA_SECTION /*폰타입구분*/
                       ,NVL(SUM(TMP_A.CNSL_CNT),0)  AS  RSLT_SUM
                       ,NVL(TRUNC(SUM(TMP_A.CNSL_CNT)/12),0)  AS  MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
                 FROM  TMP_A  
                GROUP BY #CNSL_YR#, ROLLUP(TMP_A.DATA_SECTION)
                ORDER  BY TMP_A.DATA_SECTION) A1
        UNION ALL
        SELECT  A2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'02'  AS  DATA_GB /* 접수(건) */
                       , 0 AS G_ID
                       ,DATA_SECTION /*요금납부구분*/
                       ,NVL(SUM(TMP_B.CNSL_CNT),0)  AS  RSLT_SUM
                       ,NVL(TRUNC(SUM(TMP_B.CNSL_CNT)/12),0)  AS  MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
                 FROM  TMP_B  
                GROUP  BY #CNSL_YR#,TMP_B.DATA_SECTION 
                ORDER  BY TMP_B.DATA_SECTION) A2
        UNION ALL
        SELECT  A3.*
         FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'02'  AS  DATA_GB /* 접수(건) */ 
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,NVL(SUM(TMP_C.CNSL_CNT),0)  AS  RSLT_SUM
                       ,NVL(TRUNC(SUM(TMP_C.CNSL_CNT)/12),0)  AS  MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
                 FROM  TMP_C  
                GROUP  BY #CNSL_YR#,TMP_C.DATA_SECTION 
                ORDER  BY TMP_C.DATA_SECTION)  A3
        UNION ALL
        SELECT  H1.*
          FROM (SELECT #CNSL_YR# AS CNSL_YR 
                      ,'04' AS DATA_GB /* 접수금액(천원) */
                      ,GROUPING(TMP_C.DATA_SECTION) AS G_ID
                      ,DATA_SECTION /*마케팅본부분류*/
                      ,ROUND(NVL(SUM(TMP_C.CNSL_AMT_SUM)/1000,0))  AS RSLT_SUM 
                      ,NVL(ROUND((SUM(TMP_C.CNSL_AMT_SUM)/12)/1000),0) AS MTH_AVG 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CNSL_AMT_SUM )),0)/1000) AS MTH_1 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CNSL_AMT_SUM )),0)/1000) AS MTH_2 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CNSL_AMT_SUM )),0)/1000) AS MTH_3 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CNSL_AMT_SUM )),0)/1000) AS MTH_4 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CNSL_AMT_SUM )),0)/1000) AS MTH_5 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CNSL_AMT_SUM )),0)/1000) AS MTH_6 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CNSL_AMT_SUM )),0)/1000) AS MTH_7 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CNSL_AMT_SUM )),0)/1000) AS MTH_8 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CNSL_AMT_SUM )),0)/1000) AS MTH_9 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CNSL_AMT_SUM )),0)/1000) AS MTH_10
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CNSL_AMT_SUM )),0)/1000) AS MTH_11 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CNSL_AMT_SUM )),0)/1000) AS MTH_12
                 FROM  TMP_C
                GROUP  BY #CNSL_YR#,ROLLUP(TMP_C.DATA_SECTION)
                ORDER  BY TMP_C.DATA_SECTION) H1
        UNION ALL
        SELECT J1.*
          FROM (SELECT #CNSL_YR# AS CNSL_YR 
                      ,'05' AS DATA_GB  /* 접수단가(원) */
                      ,GROUPING(TMP_C.DATA_SECTION) AS G_ID 
                      ,DATA_SECTION  /*마케팅본부분류*/
                      ,ROUND(NVL(SUM(TMP_C.CNSL_AMT_SUM)/DECODE(SUM(TMP_C.CNSL_CNT),0,NULL,SUM(TMP_C.CNSL_CNT)),0),0)     AS RSLT_SUM 
                      ,ROUND(NVL(SUM(TMP_C.CNSL_AMT_SUM)/DECODE(SUM(TMP_C.CNSL_CNT),0,NULL,SUM(TMP_C.CNSL_CNT)),0),0)     AS MTH_AVG 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',TMP_C.CNSL_CNT)),0)) AS MTH_1 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',TMP_C.CNSL_CNT)),0)) AS MTH_2 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',TMP_C.CNSL_CNT)),0)) AS MTH_3 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',TMP_C.CNSL_CNT)),0)) AS MTH_4 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',TMP_C.CNSL_CNT)),0)) AS MTH_5 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',TMP_C.CNSL_CNT)),0)) AS MTH_6 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',TMP_C.CNSL_CNT)),0)) AS MTH_7 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',TMP_C.CNSL_CNT)),0)) AS MTH_8 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',TMP_C.CNSL_CNT)),0)) AS MTH_9 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',TMP_C.CNSL_CNT)),0)) AS MTH_10
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',TMP_C.CNSL_CNT)),0)) AS MTH_11 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',TMP_C.CNSL_CNT)),0)) AS MTH_12
                FROM  TMP_C
               GROUP  BY #CNSL_YR#,ROLLUP(TMP_C.DATA_SECTION)
               ORDER  BY TMP_C.DATA_SECTION) J1
        UNION ALL
        SELECT  B1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'06'  AS  DATA_GB /* 회수(건) */
                       ,GROUPING(TMP_A.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/
                       ,NVL(SUM(TMP_A.CLCT_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_A.CLCT_CNT)/12),0) AS MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CLCT_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CLCT_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CLCT_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CLCT_CNT )),0) AS MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CLCT_CNT )),0) AS MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CLCT_CNT )),0) AS MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CLCT_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CLCT_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CLCT_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CLCT_CNT )),0) AS MTH_10 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CLCT_CNT )),0) AS MTH_11 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CLCT_CNT )),0) AS MTH_12
                 FROM  TMP_A  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_A.DATA_SECTION)
                 ORDER BY TMP_A.DATA_SECTION)  B1    
        UNION ALL
        SELECT  B2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'06'  AS  DATA_GB /* 회수(건) */
                        , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,NVL(SUM(TMP_C.CLCT_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_C.CLCT_CNT)/12),0) AS MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CLCT_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CLCT_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CLCT_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CLCT_CNT )),0) AS MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CLCT_CNT )),0) AS MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CLCT_CNT )),0) AS MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CLCT_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CLCT_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CLCT_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CLCT_CNT )),0) AS MTH_10 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CLCT_CNT )),0) AS MTH_11 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CLCT_CNT )),0) AS MTH_12
                 FROM  TMP_C  
                GROUP  BY #CNSL_YR#,TMP_C.DATA_SECTION 
                ORDER  BY TMP_C.DATA_SECTION)  B2
        UNION ALL
        SELECT  C2.*
          FROM (SELECT C.CNSL_YR 
                      ,C.DATA_GB 
                      ,0 AS G_ID 
                      ,C.DATA_SECTION
                      ,NVL(ROUND((C.CLCT_SUM)/( DECODE((SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR)),0,NULL,(SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR))) ),3)*100,0) AS RSLT_SUM 
                      ,NVL(ROUND((C.CLCT_SUM)/( DECODE((SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR)),0,NULL,(SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR))) ),3)*100,0) AS MTH_AVG
                      ,ROUND(C.MTH_1,3)  *100 AS MTH_1 
                      ,ROUND(C.MTH_2,3)  *100 AS MTH_2 
                      ,ROUND(C.MTH_3,3)  *100 AS MTH_3 
                      ,ROUND(C.MTH_4,3)  *100 AS MTH_4 
                      ,ROUND(C.MTH_5,3)  *100 AS MTH_5 
                      ,ROUND(C.MTH_6,3)  *100 AS MTH_6 
                      ,ROUND(C.MTH_7,3)  *100 AS MTH_7 
                      ,ROUND(C.MTH_8,3)  *100 AS MTH_8 
                      ,ROUND(C.MTH_9,3)  *100 AS MTH_9 
                      ,ROUND(C.MTH_10,3) *100 AS MTH_10 
                      ,ROUND(C.MTH_11,3) *100 AS MTH_11 
                      ,ROUND(C.MTH_12,3) *100 AS MTH_12
                FROM 
                    (SELECT  #CNSL_YR#  AS  CNSL_YR
                              ,'07'  AS  DATA_GB /* 회수율(%)  각회수(건)/전체회수(건)*100*/ 
                              ,DATA_SECTION /*마케팅본부분류*/
                              ,NVL(SUM(TMP_C.CLCT_CNT),0) AS CLCT_SUM
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CLCT_RT )),0) AS MTH_1 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CLCT_RT )),0) AS MTH_2 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CLCT_RT )),0) AS MTH_3 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CLCT_RT )),0) AS MTH_4
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CLCT_RT )),0) AS MTH_5
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CLCT_RT )),0) AS MTH_6
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CLCT_RT )),0) AS MTH_7 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CLCT_RT )),0) AS MTH_8 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CLCT_RT )),0) AS MTH_9 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CLCT_RT )),0) AS MTH_10 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CLCT_RT )),0) AS MTH_11 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CLCT_RT )),0) AS MTH_12
                     FROM  TMP_C  
                   GROUP BY #CNSL_YR#,TMP_C.DATA_SECTION
                    ORDER  BY TMP_C.DATA_SECTION)C )C2
        UNION ALL
        SELECT  D1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'08'  AS  DATA_GB /* 감정(건) */
                       ,GROUPING(TMP_E.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/
                       ,NVL(SUM(TMP_E.TLY_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_E.TLY_CNT)/12),0) AS MTH_AVG 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',TLY_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',TLY_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',TLY_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',TLY_CNT )),0) AS MTH_4 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',TLY_CNT )),0) AS MTH_5 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',TLY_CNT )),0) AS MTH_6 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',TLY_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',TLY_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',TLY_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',TLY_CNT )),0) AS MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',TLY_CNT )),0) AS MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',TLY_CNT )),0) AS MTH_12
                 FROM  TMP_E  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_E.DATA_SECTION)
                 ORDER BY TMP_E.DATA_SECTION) D1
        UNION ALL
        SELECT  D2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'08'  AS  DATA_GB /* 감정(건) */
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,NVL(SUM(TMP_F.TLY_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_F.TLY_CNT)/12),0) AS MTH_AVG 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',TLY_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',TLY_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',TLY_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',TLY_CNT )),0) AS MTH_4 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',TLY_CNT )),0) AS MTH_5 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',TLY_CNT )),0) AS MTH_6 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',TLY_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',TLY_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',TLY_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',TLY_CNT )),0) AS MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',TLY_CNT )),0) AS MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',TLY_CNT )),0) AS MTH_12
                 FROM  TMP_F  
                GROUP  BY #CNSL_YR#,TMP_F.DATA_SECTION 
                ORDER  BY TMP_F.DATA_SECTION) D2      
        UNION ALL
        SELECT  E1.*
          FROM (SELECT E.CNSL_YR 
                      ,E.DATA_GB 
                      ,1 AS G_ID 
                      ,E.DATA_SECTION
                      ,NVL(ROUND((E.TLY_SUM)/( DECODE((SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR)),0,NULL,(SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR))) ),3)*100,0) AS RSLT_SUM 
                      ,NVL(ROUND((E.TLY_SUM)/( DECODE((SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR)),0,NULL,(SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR))) ),3)*100,0) AS MTH_AVG
                      ,ROUND(E.MTH_1,3)  *100 AS MTH_1 
                      ,ROUND(E.MTH_2,3)  *100 AS MTH_2 
                      ,ROUND(E.MTH_3,3)  *100 AS MTH_3 
                      ,ROUND(E.MTH_4,3)  *100 AS MTH_4 
                      ,ROUND(E.MTH_5,3)  *100 AS MTH_5 
                      ,ROUND(E.MTH_6,3)  *100 AS MTH_6 
                      ,ROUND(E.MTH_7,3)  *100 AS MTH_7 
                      ,ROUND(E.MTH_8,3)  *100 AS MTH_8 
                      ,ROUND(E.MTH_9,3)  *100 AS MTH_9 
                      ,ROUND(E.MTH_10,3) *100 AS MTH_10 
                      ,ROUND(E.MTH_11,3) *100 AS MTH_11 
                      ,ROUND(E.MTH_12,3) *100 AS MTH_12
                FROM 
                    (SELECT  #CNSL_YR#  AS  CNSL_YR
                            ,'09'  AS  DATA_GB /*감정율 (전체감정(건)/전체회수(건))*/
                            ,DATA_SECTION
                            ,NVL(SUM(TMP_D.TLY_CNT),0) AS TLY_SUM
                            ,NVL(SUM(TMP_D.CLCT_CNT),0) AS CLCT_SUM 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'01',TLY_RT )),0) AS MTH_1 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'02',TLY_RT )),0) AS MTH_2 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'03',TLY_RT )),0) AS MTH_3 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'04',TLY_RT )),0) AS MTH_4
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'05',TLY_RT )),0) AS MTH_5
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'06',TLY_RT )),0) AS MTH_6
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'07',TLY_RT )),0) AS MTH_7 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'08',TLY_RT )),0) AS MTH_8 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'09',TLY_RT )),0) AS MTH_9 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'10',TLY_RT )),0) AS MTH_10 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'11',TLY_RT )),0) AS MTH_11 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'12',TLY_RT )),0) AS MTH_12
                      FROM  TMP_D  
                     GROUP  BY #CNSL_YR#,TMP_D.DATA_SECTION
                     ORDER  BY TMP_D.DATA_SECTION)E )E1
        UNION ALL             
        SELECT  F1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'10'  AS  DATA_GB  /* 감정금액(천원) */
                       ,GROUPING(TMP_E.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION   /*01스마트폰 02피쳐폰 03기타*/
                       ,ROUND(NVL(SUM(TMP_E.JDG_AMT_SUM)/1000,0))  AS  RSLT_SUM
                       ,NVL(ROUND((SUM(TMP_E.JDG_AMT_SUM)/12)/1000),0)  AS  MTH_AVG
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',JDG_AMT_SUM )),0)/1000)  AS  MTH_1
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',JDG_AMT_SUM )),0)/1000)  AS  MTH_2
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',JDG_AMT_SUM )),0)/1000)  AS  MTH_3
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',JDG_AMT_SUM )),0)/1000)  AS  MTH_4
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',JDG_AMT_SUM )),0)/1000)  AS  MTH_5
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',JDG_AMT_SUM )),0)/1000)  AS  MTH_6
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',JDG_AMT_SUM )),0)/1000)  AS  MTH_7
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',JDG_AMT_SUM )),0)/1000)  AS  MTH_8
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',JDG_AMT_SUM )),0)/1000)  AS  MTH_9
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',JDG_AMT_SUM )),0)/1000)  AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',JDG_AMT_SUM )),0)/1000)  AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',JDG_AMT_SUM )),0)/1000)  AS  MTH_12
                 FROM  TMP_E  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_E.DATA_SECTION)
                 ORDER BY TMP_E.DATA_SECTION) F1
        UNION ALL
        SELECT  F2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'10'  AS  DATA_GB  /* 감정금액(천원) */
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,ROUND(NVL(SUM(TMP_F.JDG_AMT_SUM)/1000,0))  AS  RSLT_SUM
                       ,NVL(ROUND((SUM(TMP_F.JDG_AMT_SUM)/12)/1000),0)  AS  MTH_AVG
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',JDG_AMT_SUM )),0)/1000)  AS  MTH_1
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',JDG_AMT_SUM )),0)/1000)  AS  MTH_2
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',JDG_AMT_SUM )),0)/1000)  AS  MTH_3
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',JDG_AMT_SUM )),0)/1000)  AS  MTH_4
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',JDG_AMT_SUM )),0)/1000)  AS  MTH_5
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',JDG_AMT_SUM )),0)/1000)  AS  MTH_6
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',JDG_AMT_SUM )),0)/1000)  AS  MTH_7
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',JDG_AMT_SUM )),0)/1000)  AS  MTH_8
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',JDG_AMT_SUM )),0)/1000)  AS  MTH_9
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',JDG_AMT_SUM )),0)/1000)  AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',JDG_AMT_SUM )),0)/1000)  AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',JDG_AMT_SUM )),0)/1000)  AS  MTH_12
                 FROM  TMP_F  
                GROUP  BY #CNSL_YR#,TMP_F.DATA_SECTION 
                ORDER  BY TMP_F.DATA_SECTION) F2    
        UNION ALL
        SELECT  G1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'11'  AS  DATA_GB  /* 감정단가(원)	*/
                       ,GROUPING(TMP_E.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION   /*01스마트폰 02피쳐폰 03기타*/
                       ,ROUND(NVL(SUM(TMP_E.JDG_AMT_SUM)/DECODE(SUM(TMP_E.TLY_CNT),0,NULL,SUM(TMP_E.TLY_CNT)),0),0)  AS  RSLT_SUM
                       ,ROUND(NVL(SUM(TMP_E.JDG_AMT_SUM)/DECODE(SUM(TMP_E.TLY_CNT),0,NULL,SUM(TMP_E.TLY_CNT)),0),0)  AS  MTH_AVG
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',TMP_E.TLY_CNT)),0)) AS  MTH_1
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',TMP_E.TLY_CNT)),0)) AS  MTH_2
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',TMP_E.TLY_CNT)),0))	AS  MTH_3
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',TMP_E.TLY_CNT)),0))	AS  MTH_4
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',TMP_E.TLY_CNT)),0))	AS  MTH_5
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',TMP_E.TLY_CNT)),0))	AS  MTH_6
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',TMP_E.TLY_CNT)),0))	AS  MTH_7
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',TMP_E.TLY_CNT)),0))	AS  MTH_8
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',TMP_E.TLY_CNT)),0))	AS  MTH_9
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',TMP_E.TLY_CNT)),0))	AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',TMP_E.TLY_CNT)),0))	AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',TMP_E.TLY_CNT)),0))	AS  MTH_12
                 FROM  TMP_E  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_E.DATA_SECTION)
                 ORDER BY TMP_E.DATA_SECTION) G1
        UNION ALL
        SELECT  G2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'11'  AS  DATA_GB  /* 감정단가(원)	*/
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/                                                                                                                   
                       ,ROUND(NVL(SUM(TMP_F.JDG_AMT_SUM)/DECODE(SUM(TMP_F.TLY_CNT),0,NULL,SUM(TMP_F.TLY_CNT)),0),0)  AS  RSLT_SUM                                         
                       ,ROUND(NVL(SUM(TMP_F.JDG_AMT_SUM)/DECODE(SUM(TMP_F.TLY_CNT),0,NULL,SUM(TMP_F.TLY_CNT)),0),0)  AS  MTH_AVG                                          
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',TMP_F.TLY_CNT)),0)) AS  MTH_1 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',TMP_F.TLY_CNT)),0)) AS  MTH_2 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',TMP_F.TLY_CNT)),0))	AS  MTH_3 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',TMP_F.TLY_CNT)),0))	AS  MTH_4 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',TMP_F.TLY_CNT)),0))	AS  MTH_5 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',TMP_F.TLY_CNT)),0))	AS  MTH_6 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',TMP_F.TLY_CNT)),0))	AS  MTH_7 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',TMP_F.TLY_CNT)),0))	AS  MTH_8 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',TMP_F.TLY_CNT)),0))	AS  MTH_9 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',TMP_F.TLY_CNT)),0))	AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',TMP_F.TLY_CNT)),0))	AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',TMP_F.TLY_CNT)),0))	AS  MTH_12
                 FROM  TMP_F  
                GROUP  BY #CNSL_YR#,TMP_F.DATA_SECTION 
                ORDER  BY TMP_F.DATA_SECTION) G2
      UNION ALL
      SELECT K1.*
        FROM (SELECT #CNSL_YR# AS CNSL_YR 
                    ,'12' AS DATA_GB  /* 오감정(건) */
                    ,GROUPING(TMP_F.DATA_SECTION) AS G_ID 
                    ,DATA_SECTION    /*마케팅본부분류*/
                    ,NVL(SUM(TMP_F.BAD_JDG_CNT),0) AS RSLT_SUM 
                    ,NVL(TRUNC(SUM(TMP_F.BAD_JDG_CNT)/12),0) AS MTH_AVG 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',BAD_JDG_CNT )),0) AS MTH_1 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',BAD_JDG_CNT )),0) AS MTH_2 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',BAD_JDG_CNT )),0) AS MTH_3 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',BAD_JDG_CNT )),0) AS MTH_4 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',BAD_JDG_CNT )),0) AS MTH_5 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',BAD_JDG_CNT )),0) AS MTH_6 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',BAD_JDG_CNT )),0) AS MTH_7 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',BAD_JDG_CNT )),0) AS MTH_8 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',BAD_JDG_CNT )),0) AS MTH_9 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',BAD_JDG_CNT )),0) AS MTH_10
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',BAD_JDG_CNT )),0) AS MTH_11 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',BAD_JDG_CNT )),0) AS MTH_12
              FROM  TMP_F
              GROUP BY #CNSL_YR#,ROLLUP(TMP_F.DATA_SECTION)
              ORDER BY TMP_F.DATA_SECTION) K1
      UNION ALL
      SELECT K2.*
        FROM (SELECT #CNSL_YR# AS CNSL_YR
                    ,'13' AS DATA_GB /* 오감정금액(천원) */
                    ,GROUPING(TMP_F.DATA_SECTION) AS G_ID
                    ,DATA_SECTION /*마케팅본부분류*/
                    ,ROUND(NVL(SUM(TMP_F.BAD_JDG_AMT_SUM)/1000,0)) AS RSLT_SUM 
                    ,NVL(ROUND((SUM(TMP_F.BAD_JDG_AMT_SUM)/12)/1000),0) AS MTH_AVG 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_1 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_2 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_3 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_4 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_5 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_6 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_7 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_8 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_9 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_10
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_11
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_12
              FROM  TMP_F
              GROUP BY #CNSL_YR#,ROLLUP(TMP_F.DATA_SECTION)
              ORDER BY TMP_F.DATA_SECTION ) K2            
)T
ORDER BY T.DATA_GB,T.G_ID DESC ,T.DATA_SECTION]]>
	</select>
	<select id="SInqJoinSaleList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SInqJoinSaleList 제휴채널실적현황조회 */
/* IO: 박민정,2015-11-18T17:19:23(박민정,2015-10-23T16:21:23) */
SELECT T.* 
  FROM (
WITH  TMP_A  AS  ( SELECT  A.CNSL_YM                         /* 조회년도 */
                           ,B.NUM AS DEALCO_TYP               /* 제휴채널유형 */
                           ,A.CNSL_CNT                        /* 접수건수 */
                           ,A.CLCT_CNT                        /* 회수건수 */
                           ,A.TLY_CNT                         /* 감정건수 */
                           ,A.JDG_AMT_SUM                     /* 감정금액 (매입금액 - 조정금액)*/
                           ,NVL(A.CNSL_CNT/DECODE((SUM(A.CNSL_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CNSL_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0)  AS  CNSL_RT /* 접수점유비 (전체접수건수/매입유형접수건수) */
                           ,NVL(A.CLCT_CNT/DECODE((SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0)  AS  CLCT_RT /* 회수점유비 (전체매입건수/매입유형회수건수) */
                           ,NVL(A.JDG_AMT_SUM/DECODE(A.TLY_CNT,0,NULL,A.TLY_CNT),0)  AS  JDG_UPRC /* 감정단가 (감정금액/감정건수)*/
                      FROM(
                            SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                   ,DECODE(IC.DEALCO_GRP_CD,'emart_super','01','samsungES','02','etland','03','04') AS DEALCO_TYP
                                   ,COUNT(IA.CNSL_MGMT_NO)  AS  CNSL_CNT
                                   ,SUM(DECODE(IC.IN_CONF_YN,'Y',1,0))  AS  CLCT_CNT
                                   ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                   ,SUM(PRCH_AMT-ADJ_AMT)  AS  JDG_AMT_SUM
                              FROM  TB_EP_CST_PRCHS_MGMT  IA
                                   ,TB_EP_CST_CONSULT_MGMT IC
                             WHERE  IA.CNSL_MGMT_NO = IC.CNSL_MGMT_NO(+)
                               AND  IA.DEL_YN   = 'N'
                               AND  IC.CUST_GRP IS NOT NULL
                               AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                             GROUP  BY  SUBSTR(IA.CNSL_DT,0,6),DECODE(IC.DEALCO_GRP_CD,'emart_super','01','samsungES','02','etland','03','04')
                       ) A 
                       ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=4 ) B
                     WHERE  A.DEALCO_TYP(+)= B.NUM)
      ,TMP_D  AS  ( SELECT  A.CNSL_YM                         /* 조회년도 */
                           ,A.DEALCO_TYP                      /* 제휴채널유형 */
                           ,A.CNSL_CNT                        /* 접수건수 */
                           ,A.CLCT_CNT                        /* 회수건수 */
                           ,A.TLY_CNT                         /* 감정건수 */
                           ,A.JDG_AMT_SUM                     /* 감정금액 (매입금액 - 조정금액)*/
                           ,NVL(A.CNSL_CNT/DECODE((SUM(A.CNSL_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CNSL_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0)  AS  CNSL_RT /* 접수점유비 (전체접수건수/매입유형접수건수) */
                           ,NVL(A.CLCT_CNT/DECODE((SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0)  AS  CLCT_RT /* 회수점유비 (전체매입건수/매입유형회수건수) */
                           ,NVL(A.JDG_AMT_SUM/DECODE(A.TLY_CNT,0,NULL,A.TLY_CNT),0)  AS  JDG_UPRC /* 감정단가 (감정금액/감정건수)*/
                           ,NVL(DECODE((SUM(A.TLY_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.TLY_CNT) OVER (PARTITION BY A.CNSL_YM)))/DECODE((SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0) AS TLY_RT /*감정율 (감정(건)/회수(건))*/
                      FROM(
                            SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                   ,'All' AS DEALCO_TYP
                                   ,COUNT(IA.CNSL_MGMT_NO)  AS  CNSL_CNT
                                   ,SUM(DECODE(IC.IN_CONF_YN,'Y',1,0))  AS  CLCT_CNT
                                   ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                   ,SUM(PRCH_AMT-ADJ_AMT)  AS  JDG_AMT_SUM
                              FROM  TB_EP_CST_PRCHS_MGMT  IA
                                   ,TB_EP_CST_CONSULT_MGMT IC
                             WHERE  IA.CNSL_MGMT_NO = IC.CNSL_MGMT_NO(+)
                               AND  IA.DEL_YN   = 'N'
                               AND  IC.CUST_GRP IS NOT NULL
                               AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                             GROUP  BY  SUBSTR(IA.CNSL_DT,0,6))A)                    
SELECT  C.*
  FROM(
        SELECT  #CNSL_YR#  AS  CNSL_YR
               ,'01'  AS  DATA_GB /* 접수(건) */
               ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
               ,TMP_A.DEALCO_TYP
               ,NVL(SUM(TMP_A.CNSL_CNT),0)  AS  RSLT_SUM
               ,NVL(ROUND(SUM(TMP_A.CNSL_CNT)/12),0)  AS  MTH_AVG
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
               ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  IA.CNSL_YR
              ,IA.DATA_GB 
              ,0  AS  G_ID
              ,IA.DEALCO_TYP
              ,NVL(ROUND((IA.CNSL_SUM)/DECODE((SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR))),3)*100,0)  AS  RSLT_SUM
              ,NVL(ROUND((IA.CNSL_SUM)/DECODE((SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CNSL_SUM) OVER (PARTITION BY IA.CNSL_YR))),3)*100,0)  AS  MTH_AVG
              ,ROUND(IA.MTH_1,3)*100 AS  MTH_1
              ,ROUND(IA.MTH_2,3)*100 AS  MTH_2
              ,ROUND(IA.MTH_3,3)*100 AS  MTH_3
              ,ROUND(IA.MTH_4,3)*100 AS  MTH_4
              ,ROUND(IA.MTH_5,3)*100 AS  MTH_5
              ,ROUND(IA.MTH_6,3)*100 AS  MTH_6
              ,ROUND(IA.MTH_7,3)*100 AS  MTH_7
              ,ROUND(IA.MTH_8,3)*100 AS  MTH_8
              ,ROUND(IA.MTH_9,3)*100 AS  MTH_9
              ,ROUND(IA.MTH_10,3)*100 AS  MTH_10
              ,ROUND(IA.MTH_11,3)*100 AS  MTH_11
              ,ROUND(IA.MTH_12,3)*100 AS  MTH_12
         FROM(
                SELECT  #CNSL_YR#  AS  CNSL_YR
                        ,'02'  AS  DATA_GB /* 접수점유비(%) */
                        ,TMP_A.DEALCO_TYP
                        ,NVL(SUM(TMP_A.CNSL_CNT),0)  AS  CNSL_SUM
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CNSL_RT )),0)  AS  MTH_1
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CNSL_RT )),0)  AS  MTH_2
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CNSL_RT )),0)  AS  MTH_3
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CNSL_RT )),0)  AS  MTH_4
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CNSL_RT )),0)  AS  MTH_5
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CNSL_RT )),0)  AS  MTH_6
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CNSL_RT )),0)  AS  MTH_7
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CNSL_RT )),0)  AS  MTH_8
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CNSL_RT )),0)  AS  MTH_9
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CNSL_RT )),0)  AS  MTH_10
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CNSL_RT )),0)  AS  MTH_11
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CNSL_RT )),0)  AS  MTH_12
                   FROM  TMP_A  
                  GROUP  BY #CNSL_YR#,TMP_A.DEALCO_TYP 
         )  IA
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'03'  AS  DATA_GB /* 회수(건) */
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,NVL(SUM(TMP_A.CLCT_CNT),0)  AS  RSLT_SUM
              ,NVL(ROUND(SUM(TMP_A.CLCT_CNT)/12),0)  AS  MTH_AVG
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CLCT_CNT )),0)  AS  MTH_1
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CLCT_CNT )),0)  AS  MTH_2
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CLCT_CNT )),0)  AS  MTH_3
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CLCT_CNT )),0)  AS  MTH_4
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CLCT_CNT )),0)  AS  MTH_5
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CLCT_CNT )),0)  AS  MTH_6
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CLCT_CNT )),0)  AS  MTH_7
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CLCT_CNT )),0)  AS  MTH_8
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CLCT_CNT )),0)  AS  MTH_9
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CLCT_CNT )),0)  AS  MTH_10
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CLCT_CNT )),0)  AS  MTH_11
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CLCT_CNT )),0)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  IA.CNSL_YR
              ,IA.DATA_GB
              ,0  AS  G_ID
              ,IA.DEALCO_TYP 
              ,NVL(ROUND((IA.CLCT_SUM)/( DECODE((SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR))) ),3)*100,0)  AS  RSLT_SUM
              ,NVL(ROUND((IA.CLCT_SUM)/( DECODE((SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR)),0,NULL,(SUM(IA.CLCT_SUM) OVER (PARTITION BY IA.CNSL_YR))) ),3)*100,0)  AS  MTH_AVG
              ,ROUND(IA.MTH_1,3)*100 AS  MTH_1
              ,ROUND(IA.MTH_2,3)*100 AS  MTH_2
              ,ROUND(IA.MTH_3,3)*100 AS  MTH_3
              ,ROUND(IA.MTH_4,3)*100 AS  MTH_4
              ,ROUND(IA.MTH_5,3)*100 AS  MTH_5
              ,ROUND(IA.MTH_6,3)*100 AS  MTH_6
              ,ROUND(IA.MTH_7,3)*100 AS  MTH_7
              ,ROUND(IA.MTH_8,3)*100 AS  MTH_8
              ,ROUND(IA.MTH_9,3)*100 AS  MTH_9
              ,ROUND(IA.MTH_10,3)*100 AS  MTH_10
              ,ROUND(IA.MTH_11,3)*100 AS  MTH_11
              ,ROUND(IA.MTH_12,3)*100 AS  MTH_12
         FROM(
                SELECT  #CNSL_YR#  AS  CNSL_YR
                        ,'04'  AS  DATA_GB
                        ,TMP_A.DEALCO_TYP /* 회수점유비(%) */
                        ,NVL(SUM(TMP_A.CLCT_CNT),0)  AS  CLCT_SUM
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CLCT_RT )),0)  AS  MTH_1
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CLCT_RT )),0)  AS  MTH_2
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CLCT_RT )),0)  AS  MTH_3
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CLCT_RT )),0)  AS  MTH_4
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CLCT_RT )),0)  AS  MTH_5
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CLCT_RT )),0)  AS  MTH_6
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CLCT_RT )),0)  AS  MTH_7
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CLCT_RT )),0)  AS  MTH_8
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CLCT_RT )),0)  AS  MTH_9
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CLCT_RT )),0)  AS  MTH_10
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CLCT_RT )),0)  AS  MTH_11
                        ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CLCT_RT )),0)  AS  MTH_12
                   FROM  TMP_A  
                  GROUP  BY #CNSL_YR#,TMP_A.DEALCO_TYP 
         )  IA
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'05'  AS  DATA_GB /* 감정(건) */
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,NVL(SUM(TMP_A.TLY_CNT),0)  AS  RSLT_SUM
              ,NVL(ROUND(SUM(TMP_A.TLY_CNT)/12),0)  AS  MTH_AVG
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',TLY_CNT )),0)  AS  MTH_1
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',TLY_CNT )),0)  AS  MTH_2
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',TLY_CNT )),0)  AS  MTH_3
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',TLY_CNT )),0)  AS  MTH_4
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',TLY_CNT )),0)  AS  MTH_5
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',TLY_CNT )),0)  AS  MTH_6
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',TLY_CNT )),0)  AS  MTH_7
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',TLY_CNT )),0)  AS  MTH_8
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',TLY_CNT )),0)  AS  MTH_9
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',TLY_CNT )),0)  AS  MTH_10
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',TLY_CNT )),0)  AS  MTH_11
              ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',TLY_CNT )),0)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'07'  AS  DATA_GB /* 감정금액(천원) */
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,ROUND(NVL(SUM(TMP_A.JDG_AMT_SUM)/1000,0))  AS  RSLT_SUM
              ,NVL(ROUND((SUM(TMP_A.JDG_AMT_SUM)/12)/1000),0)  AS  MTH_AVG
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',JDG_AMT_SUM )),0)/1000)  AS  MTH_1
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',JDG_AMT_SUM )),0)/1000)  AS  MTH_2
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',JDG_AMT_SUM )),0)/1000)  AS  MTH_3
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',JDG_AMT_SUM )),0)/1000)  AS  MTH_4
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',JDG_AMT_SUM )),0)/1000)  AS  MTH_5
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',JDG_AMT_SUM )),0)/1000)  AS  MTH_6
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',JDG_AMT_SUM )),0)/1000)  AS  MTH_7
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',JDG_AMT_SUM )),0)/1000)  AS  MTH_8
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',JDG_AMT_SUM )),0)/1000)  AS  MTH_9
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',JDG_AMT_SUM )),0)/1000)  AS  MTH_10
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',JDG_AMT_SUM )),0)/1000)  AS  MTH_11
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',JDG_AMT_SUM )),0)/1000)  AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)
        UNION ALL
       SELECT  #CNSL_YR#  AS  CNSL_YR
              ,'08'  AS  DATA_GB /* 감정단가(원)	*/
              ,GROUPING(TMP_A.DEALCO_TYP)  AS  G_ID
              ,TMP_A.DEALCO_TYP
              ,ROUND(NVL(SUM(TMP_A.JDG_AMT_SUM)/DECODE(SUM(TMP_A.TLY_CNT),0,NULL,SUM(TMP_A.TLY_CNT)),0),0)  AS  RSLT_SUM
              ,ROUND(NVL(SUM(TMP_A.JDG_AMT_SUM)/DECODE(SUM(TMP_A.TLY_CNT),0,NULL,SUM(TMP_A.TLY_CNT)),0),0)  AS  MTH_AVG
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',TMP_A.TLY_CNT)),0))  AS  MTH_1
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',TMP_A.TLY_CNT)),0))  AS  MTH_2
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',TMP_A.TLY_CNT)),0))	AS  MTH_3
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',TMP_A.TLY_CNT)),0))	AS  MTH_4
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',TMP_A.TLY_CNT)),0))	AS  MTH_5
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',TMP_A.TLY_CNT)),0))	AS  MTH_6
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',TMP_A.TLY_CNT)),0))	AS  MTH_7
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',TMP_A.TLY_CNT)),0))	AS  MTH_8
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',TMP_A.TLY_CNT)),0))	AS  MTH_9
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',TMP_A.TLY_CNT)),0))	AS  MTH_10
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',TMP_A.TLY_CNT)),0))	AS  MTH_11
              ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',TMP_A.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',TMP_A.TLY_CNT)),0))	AS  MTH_12
         FROM  TMP_A  
        GROUP  BY #CNSL_YR#,ROLLUP(TMP_A.DEALCO_TYP)) C
UNION ALL
SELECT  E1.*
  FROM (SELECT E.CNSL_YR 
              ,E.DATA_GB 
              ,1 AS G_ID 
              ,E.DEALCO_TYP 
              ,NVL(ROUND((E.TLY_SUM)/( DECODE((SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR)),0,NULL,(SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR))) ),3)*100,0) AS RSLT_SUM 
              ,NVL(ROUND((E.TLY_SUM)/( DECODE((SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR)),0,NULL,(SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR))) ),3)*100,0) AS MTH_AVG
              ,ROUND(E.MTH_1,3)  *100 AS MTH_1 
              ,ROUND(E.MTH_2,3)  *100 AS MTH_2 
              ,ROUND(E.MTH_3,3)  *100 AS MTH_3 
              ,ROUND(E.MTH_4,3)  *100 AS MTH_4 
              ,ROUND(E.MTH_5,3)  *100 AS MTH_5 
              ,ROUND(E.MTH_6,3)  *100 AS MTH_6 
              ,ROUND(E.MTH_7,3)  *100 AS MTH_7 
              ,ROUND(E.MTH_8,3)  *100 AS MTH_8 
              ,ROUND(E.MTH_9,3)  *100 AS MTH_9 
              ,ROUND(E.MTH_10,3) *100 AS MTH_10 
              ,ROUND(E.MTH_11,3) *100 AS MTH_11 
              ,ROUND(E.MTH_12,3) *100 AS MTH_12
        FROM 
            (SELECT  #CNSL_YR#  AS  CNSL_YR
                    ,'06'  AS  DATA_GB /*감정율 (전체감정(건)/전체회수(건))*/
                    ,DEALCO_TYP 
                    ,NVL(SUM(TMP_D.TLY_CNT),0) AS TLY_SUM
                    ,NVL(SUM(TMP_D.CLCT_CNT),0) AS CLCT_SUM 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'01',TLY_RT )),0) AS MTH_1 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'02',TLY_RT )),0) AS MTH_2 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'03',TLY_RT )),0) AS MTH_3 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'04',TLY_RT )),0) AS MTH_4
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'05',TLY_RT )),0) AS MTH_5
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'06',TLY_RT )),0) AS MTH_6
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'07',TLY_RT )),0) AS MTH_7 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'08',TLY_RT )),0) AS MTH_8 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'09',TLY_RT )),0) AS MTH_9 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'10',TLY_RT )),0) AS MTH_10 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'11',TLY_RT )),0) AS MTH_11 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'12',TLY_RT )),0) AS MTH_12
              FROM  TMP_D  
             GROUP  BY #CNSL_YR# ,TMP_D.DEALCO_TYP
             ORDER  BY TMP_D.DEALCO_TYP)E )E1
)T
ORDER BY T.DATA_GB,T.G_ID DESC ,T.DEALCO_TYP]]>
	</select>
	<select id="SInqClubTSaleList" parameterClass="map" resultClass="hmap" fetchSize="50" ><![CDATA[/* Biz: dms.ep.epsrpbase.db.DEPReportMgmt.SInqClubTSaleList 클럽T실적현황조회 */
/* IO: 박민정,2015-11-18T10:33:23(박민정,2015-10-26T10:33:26) */
SELECT T.* 
  FROM (WITH  TMP_A  AS  (SELECT A.CNSL_YM        /* 조회년도 */
                                 ,AA.NUM AS DATA_SECTION
                                 ,A.CNSL_CNT       /* 접수건수 */
                                 ,A.CLCT_CNT       /* 회수건수 */
                                 ,A.CNSL_AMT_SUM      /* 접수금액*/
                                 ,NVL(A.CNSL_AMT_SUM/DECODE(A.CNSL_CNT,0,NULL,A.CNSL_CNT),0) AS CNSL_UPRC  /* 접수단가 (접수금액/접수건수)*/
                                 ,NVL(A.CLCT_CNT/DECODE((SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM)),0,NULL,(SUM(A.CLCT_CNT) OVER (PARTITION BY A.CNSL_YM))) ,0) AS CLCT_RT  /* 회수율 (매입유형회수(건)/전체회수(건)) */
                            FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                         ,DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03') AS DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/
                                         ,COUNT(IC.CNSL_MGMT_NO)  AS  CNSL_CNT
                                         ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                                         ,SUM(IC.CNSL_AMT)  AS CNSL_AMT_SUM    /*접수금액(상담금액)*/
                                    FROM  TB_EP_CST_CONSULT_MGMT IC
                                         ,TB_EQP_MDL IE
                                   WHERE  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                     AND  IC.DEL_YN   = 'N'
                                     AND  IE.DEL_YN   = 'N'
                                     AND  IC.SCRB_MTHD = 'T'     /* 클럽T 실적  AND IA.SCRB_MTHD = 'T'*/
                                     AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                   GROUP  BY  SUBSTR(IC.CNSL_DT,0,6),DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03'))A
                                  ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=3 ) AA
                                   WHERE  A.DATA_SECTION(+)= AA.NUM)              
             ,TMP_B  AS  (SELECT B.CNSL_YM       /* 조회년도 */
                                 ,BB.NUM AS DATA_SECTION
                                 ,B.CNSL_CNT      /* 접수건수 */
                                 ,B.CLCT_CNT      /* 회수건수 */
                                 ,B.CNSL_AMT_SUM      /* 접수금액*/
                            FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                         ,NVL(ID.DATA_SECTION,'15') DATA_SECTION
                                         ,COUNT(IC.CNSL_MGMT_NO)  AS  CNSL_CNT /*접수건*/
                                         ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                                         ,SUM(IC.CNSL_AMT)  AS CNSL_AMT_SUM    /*접수금액(상담금액)*/
                                    FROM  TB_EP_CST_CONSULT_MGMT IC
                                          ,(SELECT A.CNSL_MGMT_NO
                                                  ,NVL(DECODE(NVL(A.SKN_CL,'N'),'Y'
                                                      ,DECODE(NVL(A.PRE_DC_CL,'N'),'Y','11'   /*선할인구분*/
                                                      ,DECODE(NVL(A.ASIANA_CARD_NO,'N'),'N'   /*아시아나카드여부*/
                                                      ,DECODE(A.PAY_MTHD,'02','12'             /*요금선납 */
                                                      ,DECODE(A.PAY_MTHD,'01','13','15')),'14'))
                                                      ,DECODE(NVL(B.FEE_DEDC_YN,'0'),'1','12','13')),'15') AS DATA_SECTION
                                              FROM TB_EP_CST_CONSULT_MGMT A
                                                   , (SELECT CNSL_MGMT_NO, MAX(FEE_DEDC_YN) FEE_DEDC_YN FROM TB_EP_CST_PRCHS_MGMT WHERE DEL_YN = 'N' GROUP BY CNSL_MGMT_NO) B
                                             WHERE A.DEL_YN = 'N'
                                               AND A.CNSL_MGMT_NO = B.CNSL_MGMT_NO(+)
                                         ) ID
                                         ,TB_EQP_MDL IE
                                   WHERE  IC.CNSL_MGMT_NO = ID.CNSL_MGMT_NO(+)
                                     AND  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                     AND  IC.DEL_YN   = 'N'
                                     AND  IE.DEL_YN   = 'N'
                                     AND  IC.SCRB_MTHD = 'T'     /* 클럽T 실적  AND IA.SCRB_MTHD = 'T'*/
                                     AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                   GROUP BY SUBSTR(IC.CNSL_DT,0,6), NVL(ID.DATA_SECTION,'15'))B
                                 ,(SELECT LPAD(LEVEL,2,'1') AS NUM FROM DUAL CONNECT BY LEVEL <=5 ) BB
                                   WHERE  B.DATA_SECTION(+)= BB.NUM)
             ,TMP_C  AS  (SELECT C.CNSL_YM        /* 조회년도 */
                                ,CC.NUM AS DATA_SECTION
                                ,C.CNSL_CNT       /* 접수건수 */
                                ,C.CLCT_CNT       /* 회수건수 */
                                ,C.CNSL_AMT_SUM      /* 접수금액*/
                                ,NVL(C.CNSL_AMT_SUM/DECODE(C.CNSL_CNT,0,NULL,C.CNSL_CNT),0) AS CNSL_UPRC  /* 접수단가 (접수금액/접수건수)*/
                                ,NVL(C.CLCT_CNT/DECODE((SUM(C.CLCT_CNT) OVER (PARTITION BY C.CNSL_YM)),0,NULL,(SUM(C.CLCT_CNT) OVER (PARTITION BY C.CNSL_YM))) ,0) AS CLCT_RT  /* 회수율 (매입유형회수(건)/전체회수(건)) */
                           FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                        ,DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                            '수도권마케팅2본부','22',
                                                            '부산마케팅본부','23',
                                                            '대구마케팅본부','24',
                                                            '서부마케팅본부','25',
                                                            '중부마케팅본부','26',
                                                            '유통사업부','27',
                                                            '특수마케팅본부','28','29') AS DATA_SECTION  /*마케팅본부분류*/
                                        ,COUNT(IC.CNSL_MGMT_NO)  AS  CNSL_CNT
                                        ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT
                                        ,SUM(IC.CNSL_AMT)  AS CNSL_AMT_SUM    /*접수금액(상담금액)*/
                                  FROM  TB_EP_CST_CONSULT_MGMT IC
                                       ,TB_DEALCO IB 
                                       ,TB_EQP_MDL IE
                                       ,(SELECT A.HEADQ_NM 
                                               ,A.MKT_TEAM_NM 
                                               ,A.UKEY_AGN_CD
                                           FROM  TB_EP_BAS_DEAL_CO_MARKETING A
                                               ,(SELECT UKEY_AGN_CD
                                                       ,MAX(AGN_SEQ) AS AGN_SEQ
                                                   FROM TB_EP_BAS_DEAL_CO_MARKETING 
                                                  GROUP BY UKEY_AGN_CD ) B
                                         WHERE A.UKEY_AGN_CD = B.UKEY_AGN_CD
                                           AND A.AGN_SEQ = B.AGN_SEQ 
                                           AND A.DEL_YN ='N'
                                           ) IG
                                 WHERE  IC.CNSL_DEALCO_CD = IB.DEALCO_CD
                                   AND  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                   AND  IB.UKEY_AGN_CD = IG.UKEY_AGN_CD(+)
                                   AND  IB.EFF_STA_DT <= IC.CNSL_DT
                                   AND  IB.EFF_END_DT >= IC.CNSL_DT
                                   AND  IC.DEL_YN   = 'N'
                                   AND  IB.DEL_YN   = 'N'
                                   AND  IC.SCRB_MTHD = 'T'     /* 클럽T 실적  AND IA.SCRB_MTHD = 'T'*/
                                   AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                 GROUP  BY  SUBSTR(IC.CNSL_DT,0,6),DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                                                      '수도권마케팅2본부','22',
                                                                                      '부산마케팅본부','23',
                                                                                      '대구마케팅본부','24',
                                                                                      '서부마케팅본부','25',
                                                                                      '중부마케팅본부','26',
                                                                                      '유통사업부','27',
                                                                                      '특수마케팅본부','28','29'))C
                               ,(SELECT LPAD(LEVEL,2,'2') AS NUM FROM DUAL CONNECT BY LEVEL <=9 ) CC
                               WHERE  C.DATA_SECTION(+)= CC.NUM)
             ,TMP_D  AS (SELECT T1.CNSL_YM
                               ,T1.DATA_SECTION
                               ,T1.CLCT_CNT /* 회수건수 */
                               ,T2.TLY_CNT  /* 감정건수 */
                               ,NVL(DECODE((SUM(T2.TLY_CNT) OVER (PARTITION BY T2.CNSL_YM)),0,NULL,(SUM(T2.TLY_CNT) OVER (PARTITION BY T2.CNSL_YM)))/DECODE((SUM(T1.CLCT_CNT) OVER (PARTITION BY T1.CNSL_YM)),0,NULL,(SUM(T1.CLCT_CNT) OVER (PARTITION BY T1.CNSL_YM))) ,0) AS TLY_RT /*감정율 (감정(건)/회수(건))*/
                         FROM (SELECT A.CNSL_YM        /* 조회년도 */
                                     ,A.DATA_SECTION
                                     ,A.CLCT_CNT       /* 회수건수 */
                                FROM (SELECT  SUBSTR(IC.CNSL_DT,0,6)  AS  CNSL_YM
                                             ,'All' as DATA_SECTION  
                                             ,SUM(DECODE(IC.CLCT_YN,'Y',1,0))  AS  CLCT_CNT  
                                        FROM  TB_EP_CST_CONSULT_MGMT IC
                                             ,TB_EQP_MDL IE
                                        WHERE  IC.EQP_MDL_CD = IE.EQP_MDL_CD
                                          AND  IC.DEL_YN   = 'N'
                                          AND  IE.DEL_YN   = 'N'
                                          AND  IC.SCRB_MTHD = 'T'     /* 클럽T 실적  AND IA.SCRB_MTHD = 'T'*/
                                          AND  IC.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                       GROUP  BY  SUBSTR(IC.CNSL_DT,0,6))A )T1
                            ,(SELECT E.CNSL_YM        /* 조회년도 */
                                    ,E.DATA_SECTION
                                    ,E.TLY_CNT        /* 감정건수 */
                                FROM (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                             ,'All' as DATA_SECTION  
                                             ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                        FROM  TB_EP_CST_PRCHS_MGMT  IA 
                                             ,TB_EQP_MDL IE
                                       WHERE  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                                         AND  IA.DEL_YN   = 'N'
                                         AND  IE.DEL_YN   = 'N'
                                         AND  IA.SCRB_MTHD = 'T'     /* 클럽T 실적  AND IA.SCRB_MTHD = 'T'*/
                                         AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                       GROUP  BY  SUBSTR(IA.CNSL_DT,0,6))E) T2
                       WHERE T1.CNSL_YM =   T2.CNSL_YM) 
             ,TMP_E AS ( SELECT E.CNSL_YM        /* 조회년도 */
                                ,EE.NUM AS DATA_SECTION
                                ,E.TLY_CNT        /* 감정건수 */
                                ,E.BAD_JDG_CNT    /* 오감정(건)*/
                                ,E.JDG_AMT_SUM    /* 감정금액 (매입금액 - 조정금액)*/                              
                                ,NVL(E.JDG_AMT_SUM/DECODE(E.TLY_CNT,0,NULL,E.TLY_CNT),0) AS JDG_UPRC     /* 감정단가 (감정금액/감정건수)*/
                                ,E.BAD_JDG_AMT_SUM   /*오감정금액(천원)*/
                            FROM (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                         ,DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03') AS DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/  
                                         ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                         ,SUM(PRCH_AMT-ADJ_AMT)  AS  JDG_AMT_SUM  /*감정금액*/                                     
                                         ,SUM(DECODE(NVL(IA.SKN_SMPL_JDG_DAMT,0),'0','1')) AS BAD_JDG_CNT /*오감정(건)*/
                                         ,SUM(IA.SKN_SMPL_JDG_DAMT) AS BAD_JDG_AMT_SUM /*오감정금액(천원)*/
                                    FROM  TB_EP_CST_PRCHS_MGMT  IA
                                         ,TB_EQP_MDL IE
                                   WHERE  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                                     AND  IA.DEL_YN   = 'N'
                                     AND  IE.DEL_YN   = 'N'
                                     AND  IA.SCRB_MTHD = 'T'     /* 클럽T 실적  AND IA.SCRB_MTHD = 'T'*/
                                     AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                   GROUP  BY  SUBSTR(IA.CNSL_DT,0,6),DECODE(IE.PROD_CHRTIC_1,'S','01','P','02','03'))E
                                  ,(SELECT LPAD(LEVEL,2,'0') AS NUM FROM DUAL CONNECT BY LEVEL <=3 ) EE
                          WHERE  E.DATA_SECTION(+)= EE.NUM)
               ,TMP_F AS  (SELECT F.CNSL_YM        /* 조회년도 */
                                ,FF.NUM AS DATA_SECTION
                                ,F.TLY_CNT        /* 감정건수 */
                                ,F.BAD_JDG_CNT    /* 오감정(건)*/
                                ,F.JDG_AMT_SUM    /* 감정금액 (매입금액 - 조정금액)*/                           
                                ,NVL(F.JDG_AMT_SUM/DECODE(F.TLY_CNT,0,NULL,F.TLY_CNT),0) AS JDG_UPRC     /* 감정단가 (감정금액/감정건수)*/
                                ,F.BAD_JDG_AMT_SUM   /*오감정금액(천원)*/
                           FROM (SELECT  SUBSTR(IA.CNSL_DT,0,6)  AS  CNSL_YM
                                        ,DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                            '수도권마케팅2본부','22',
                                                            '부산마케팅본부','23',
                                                            '대구마케팅본부','24',
                                                            '서부마케팅본부','25',
                                                            '중부마케팅본부','26',
                                                            '유통사업부','27',
                                                            '특수마케팅본부','28','29') AS DATA_SECTION  /*마케팅본부분류*/
                                         ,SUM(DECODE(IA.TLY_DT,NULL,0,1))  AS  TLY_CNT
                                         ,SUM(PRCH_AMT-ADJ_AMT)  AS  JDG_AMT_SUM  /*감정금액*/
                                         ,SUM(DECODE(NVL(IA.SKN_SMPL_JDG_DAMT,0),'0','1')) AS BAD_JDG_CNT /*오감정(건)*/
                                         ,SUM(IA.SKN_SMPL_JDG_DAMT) AS BAD_JDG_AMT_SUM /*오감정금액(천원)*/
                                  FROM TB_EP_CST_PRCHS_MGMT IA
                                       ,TB_DEALCO IB 
                                       ,TB_EQP_MDL IE
                                       ,(SELECT A.HEADQ_NM 
                                               ,A.MKT_TEAM_NM 
                                               ,A.UKEY_AGN_CD
                                           FROM  TB_EP_BAS_DEAL_CO_MARKETING A
                                               ,(SELECT UKEY_AGN_CD
                                                       ,MAX(AGN_SEQ) AS AGN_SEQ
                                                   FROM TB_EP_BAS_DEAL_CO_MARKETING 
                                                  GROUP BY UKEY_AGN_CD ) B
                                         WHERE A.UKEY_AGN_CD = B.UKEY_AGN_CD
                                           AND A.AGN_SEQ = B.AGN_SEQ 
                                           AND A.DEL_YN ='N'
                                           ) IG
                                 WHERE  IA.CNSL_DEALCO_CD = IB.DEALCO_CD
                                   AND  IA.EQP_MDL_CD = IE.EQP_MDL_CD
                                   AND  IB.UKEY_AGN_CD = IG.UKEY_AGN_CD(+)
                                   AND  IB.EFF_STA_DT <= IA.CNSL_DT
                                   AND  IB.EFF_END_DT >= IA.CNSL_DT
                                   AND  IA.DEL_YN   = 'N'
                                   AND  IB.DEL_YN   = 'N'
                                   AND  IA.SCRB_MTHD = 'T'     /* 클럽T 실적  AND IA.SCRB_MTHD = 'T'*/
                                   AND  IA.CNSL_DT BETWEEN #CNSL_YR#||'0101' AND #CNSL_YR#||'1231'
                                 GROUP  BY  SUBSTR(IA.CNSL_DT,0,6),DECODE(IG.HEADQ_NM,'수도권마케팅1본부','21',
                                                                                      '수도권마케팅2본부','22',
                                                                                      '부산마케팅본부','23',
                                                                                      '대구마케팅본부','24',
                                                                                      '서부마케팅본부','25',
                                                                                      '중부마케팅본부','26',
                                                                                      '유통사업부','27',
                                                                                      '특수마케팅본부','28','29'))F
                               ,(SELECT LPAD(LEVEL,2,'2') AS NUM FROM DUAL CONNECT BY LEVEL <=9 ) FF
                          WHERE  F.DATA_SECTION(+)= FF.NUM)         
        SELECT  A1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'02'  AS  DATA_GB /* 접수(건) */
                       ,GROUPING(TMP_A.DATA_SECTION) AS G_ID 
                       ,DATA_SECTION /*폰타입구분*/
                       ,NVL(SUM(TMP_A.CNSL_CNT),0)  AS  RSLT_SUM
                       ,NVL(TRUNC(SUM(TMP_A.CNSL_CNT)/12),0)  AS  MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
                 FROM  TMP_A  
                GROUP BY #CNSL_YR#, ROLLUP(TMP_A.DATA_SECTION)
                ORDER  BY TMP_A.DATA_SECTION) A1
        UNION ALL
        SELECT  A2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'02'  AS  DATA_GB /* 접수(건) */
                       , 0 AS G_ID
                       ,DATA_SECTION /*요금납부구분*/
                       ,NVL(SUM(TMP_B.CNSL_CNT),0)  AS  RSLT_SUM
                       ,NVL(TRUNC(SUM(TMP_B.CNSL_CNT)/12),0)  AS  MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_B.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
                 FROM  TMP_B  
                GROUP  BY #CNSL_YR#,TMP_B.DATA_SECTION 
                ORDER  BY TMP_B.DATA_SECTION) A2
        UNION ALL
        SELECT  A3.*
         FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'02'  AS  DATA_GB /* 접수(건) */ 
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,NVL(SUM(TMP_C.CNSL_CNT),0)  AS  RSLT_SUM
                       ,NVL(TRUNC(SUM(TMP_C.CNSL_CNT)/12),0)  AS  MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CNSL_CNT )),0)  AS  MTH_1
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CNSL_CNT )),0)  AS  MTH_2
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CNSL_CNT )),0)  AS  MTH_3
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CNSL_CNT )),0)  AS  MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CNSL_CNT )),0)  AS  MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CNSL_CNT )),0)  AS  MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CNSL_CNT )),0)  AS  MTH_7
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CNSL_CNT )),0)  AS  MTH_8
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CNSL_CNT )),0)  AS  MTH_9
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CNSL_CNT )),0)  AS  MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CNSL_CNT )),0)  AS  MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CNSL_CNT )),0)  AS  MTH_12
                 FROM  TMP_C  
                GROUP  BY #CNSL_YR#,TMP_C.DATA_SECTION 
                ORDER  BY TMP_C.DATA_SECTION)  A3
        UNION ALL
        SELECT  H1.*
          FROM (SELECT #CNSL_YR# AS CNSL_YR 
                      ,'04' AS DATA_GB /* 접수금액(천원) */
                      ,GROUPING(TMP_C.DATA_SECTION) AS G_ID
                      ,DATA_SECTION /*마케팅본부분류*/
                      ,ROUND(NVL(SUM(TMP_C.CNSL_AMT_SUM)/1000,0))  AS RSLT_SUM 
                      ,NVL(ROUND((SUM(TMP_C.CNSL_AMT_SUM)/12)/1000),0) AS MTH_AVG 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CNSL_AMT_SUM )),0)/1000) AS MTH_1 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CNSL_AMT_SUM )),0)/1000) AS MTH_2 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CNSL_AMT_SUM )),0)/1000) AS MTH_3 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CNSL_AMT_SUM )),0)/1000) AS MTH_4 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CNSL_AMT_SUM )),0)/1000) AS MTH_5 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CNSL_AMT_SUM )),0)/1000) AS MTH_6 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CNSL_AMT_SUM )),0)/1000) AS MTH_7 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CNSL_AMT_SUM )),0)/1000) AS MTH_8 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CNSL_AMT_SUM )),0)/1000) AS MTH_9 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CNSL_AMT_SUM )),0)/1000) AS MTH_10
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CNSL_AMT_SUM )),0)/1000) AS MTH_11 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CNSL_AMT_SUM )),0)/1000) AS MTH_12
                 FROM  TMP_C
                GROUP  BY #CNSL_YR#,ROLLUP(TMP_C.DATA_SECTION)
                ORDER  BY TMP_C.DATA_SECTION) H1
        UNION ALL
        SELECT J1.*
          FROM (SELECT #CNSL_YR# AS CNSL_YR 
                      ,'05' AS DATA_GB  /* 접수단가(원) */
                      ,GROUPING(TMP_C.DATA_SECTION) AS G_ID 
                      ,DATA_SECTION  /*마케팅본부분류*/
                      ,ROUND(NVL(SUM(TMP_C.CNSL_AMT_SUM)/DECODE(SUM(TMP_C.CNSL_CNT),0,NULL,SUM(TMP_C.CNSL_CNT)),0),0)     AS RSLT_SUM 
                      ,ROUND(NVL(SUM(TMP_C.CNSL_AMT_SUM)/DECODE(SUM(TMP_C.CNSL_CNT),0,NULL,SUM(TMP_C.CNSL_CNT)),0),0)     AS MTH_AVG 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',TMP_C.CNSL_CNT)),0)) AS MTH_1 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',TMP_C.CNSL_CNT)),0)) AS MTH_2 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',TMP_C.CNSL_CNT)),0)) AS MTH_3 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',TMP_C.CNSL_CNT)),0)) AS MTH_4 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',TMP_C.CNSL_CNT)),0)) AS MTH_5 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',TMP_C.CNSL_CNT)),0)) AS MTH_6 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',TMP_C.CNSL_CNT)),0)) AS MTH_7 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',TMP_C.CNSL_CNT)),0)) AS MTH_8 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',TMP_C.CNSL_CNT)),0)) AS MTH_9 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',TMP_C.CNSL_CNT)),0)) AS MTH_10
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',TMP_C.CNSL_CNT)),0)) AS MTH_11 
                      ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',TMP_C.CNSL_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',TMP_C.CNSL_CNT)),0)) AS MTH_12
                FROM  TMP_C
               GROUP  BY #CNSL_YR#,ROLLUP(TMP_C.DATA_SECTION)
               ORDER  BY TMP_C.DATA_SECTION) J1
        UNION ALL
        SELECT  B1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'06'  AS  DATA_GB /* 회수(건) */
                       ,GROUPING(TMP_A.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/
                       ,NVL(SUM(TMP_A.CLCT_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_A.CLCT_CNT)/12),0) AS MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'01',CLCT_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'02',CLCT_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'03',CLCT_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'04',CLCT_CNT )),0) AS MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'05',CLCT_CNT )),0) AS MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'06',CLCT_CNT )),0) AS MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'07',CLCT_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'08',CLCT_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'09',CLCT_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'10',CLCT_CNT )),0) AS MTH_10 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'11',CLCT_CNT )),0) AS MTH_11 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_A.CNSL_YM,5,6) ,'12',CLCT_CNT )),0) AS MTH_12
                 FROM  TMP_A  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_A.DATA_SECTION)
                 ORDER BY TMP_A.DATA_SECTION)  B1    
        UNION ALL
        SELECT  B2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'06'  AS  DATA_GB /* 회수(건) */
                        , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,NVL(SUM(TMP_C.CLCT_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_C.CLCT_CNT)/12),0) AS MTH_AVG
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CLCT_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CLCT_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CLCT_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CLCT_CNT )),0) AS MTH_4
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CLCT_CNT )),0) AS MTH_5
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CLCT_CNT )),0) AS MTH_6
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CLCT_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CLCT_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CLCT_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CLCT_CNT )),0) AS MTH_10 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CLCT_CNT )),0) AS MTH_11 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CLCT_CNT )),0) AS MTH_12
                 FROM  TMP_C  
                GROUP  BY #CNSL_YR#,TMP_C.DATA_SECTION 
                ORDER  BY TMP_C.DATA_SECTION)  B2
        UNION ALL
        SELECT  C2.*
          FROM (SELECT C.CNSL_YR 
                      ,C.DATA_GB 
                      ,0 AS G_ID 
                      ,C.DATA_SECTION
                      ,NVL(ROUND((C.CLCT_SUM)/( DECODE((SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR)),0,NULL,(SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR))) ),3)*100,0) AS RSLT_SUM 
                      ,NVL(ROUND((C.CLCT_SUM)/( DECODE((SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR)),0,NULL,(SUM(C.CLCT_SUM) OVER (PARTITION BY C.CNSL_YR))) ),3)*100,0) AS MTH_AVG
                      ,ROUND(C.MTH_1,3)  *100 AS MTH_1 
                      ,ROUND(C.MTH_2,3)  *100 AS MTH_2 
                      ,ROUND(C.MTH_3,3)  *100 AS MTH_3 
                      ,ROUND(C.MTH_4,3)  *100 AS MTH_4 
                      ,ROUND(C.MTH_5,3)  *100 AS MTH_5 
                      ,ROUND(C.MTH_6,3)  *100 AS MTH_6 
                      ,ROUND(C.MTH_7,3)  *100 AS MTH_7 
                      ,ROUND(C.MTH_8,3)  *100 AS MTH_8 
                      ,ROUND(C.MTH_9,3)  *100 AS MTH_9 
                      ,ROUND(C.MTH_10,3) *100 AS MTH_10 
                      ,ROUND(C.MTH_11,3) *100 AS MTH_11 
                      ,ROUND(C.MTH_12,3) *100 AS MTH_12
                FROM 
                    (SELECT  #CNSL_YR#  AS  CNSL_YR
                              ,'07'  AS  DATA_GB /* 회수율(%)  각회수(건)/전체회수(건)*100*/ 
                              ,DATA_SECTION /*마케팅본부분류*/
                              ,NVL(SUM(TMP_C.CLCT_CNT),0) AS CLCT_SUM
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'01',CLCT_RT )),0) AS MTH_1 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'02',CLCT_RT )),0) AS MTH_2 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'03',CLCT_RT )),0) AS MTH_3 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'04',CLCT_RT )),0) AS MTH_4
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'05',CLCT_RT )),0) AS MTH_5
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'06',CLCT_RT )),0) AS MTH_6
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'07',CLCT_RT )),0) AS MTH_7 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'08',CLCT_RT )),0) AS MTH_8 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'09',CLCT_RT )),0) AS MTH_9 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'10',CLCT_RT )),0) AS MTH_10 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'11',CLCT_RT )),0) AS MTH_11 
                              ,NVL(SUM(DECODE(SUBSTR(TMP_C.CNSL_YM,5,6) ,'12',CLCT_RT )),0) AS MTH_12
                     FROM  TMP_C  
                   GROUP BY #CNSL_YR#,TMP_C.DATA_SECTION
                    ORDER  BY TMP_C.DATA_SECTION)C )C2
        UNION ALL
        SELECT  D1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'08'  AS  DATA_GB /* 감정(건) */
                       ,GROUPING(TMP_E.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION /*01스마트폰 02피쳐폰 03기타*/
                       ,NVL(SUM(TMP_E.TLY_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_E.TLY_CNT)/12),0) AS MTH_AVG 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',TLY_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',TLY_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',TLY_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',TLY_CNT )),0) AS MTH_4 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',TLY_CNT )),0) AS MTH_5 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',TLY_CNT )),0) AS MTH_6 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',TLY_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',TLY_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',TLY_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',TLY_CNT )),0) AS MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',TLY_CNT )),0) AS MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',TLY_CNT )),0) AS MTH_12
                 FROM  TMP_E  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_E.DATA_SECTION)
                 ORDER BY TMP_E.DATA_SECTION) D1
        UNION ALL
        SELECT  D2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'08'  AS  DATA_GB /* 감정(건) */
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,NVL(SUM(TMP_F.TLY_CNT),0) AS RSLT_SUM 
                       ,NVL(ROUND(SUM(TMP_F.TLY_CNT)/12),0) AS MTH_AVG 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',TLY_CNT )),0) AS MTH_1 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',TLY_CNT )),0) AS MTH_2 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',TLY_CNT )),0) AS MTH_3 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',TLY_CNT )),0) AS MTH_4 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',TLY_CNT )),0) AS MTH_5 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',TLY_CNT )),0) AS MTH_6 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',TLY_CNT )),0) AS MTH_7 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',TLY_CNT )),0) AS MTH_8 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',TLY_CNT )),0) AS MTH_9 
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',TLY_CNT )),0) AS MTH_10
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',TLY_CNT )),0) AS MTH_11
                       ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',TLY_CNT )),0) AS MTH_12
                 FROM  TMP_F  
                GROUP  BY #CNSL_YR#,TMP_F.DATA_SECTION 
                ORDER  BY TMP_F.DATA_SECTION) D2      
         UNION ALL
        SELECT  E1.*
          FROM (SELECT E.CNSL_YR 
                      ,E.DATA_GB 
                      ,1 AS G_ID 
                      ,E.DATA_SECTION
                      ,NVL(ROUND((E.TLY_SUM)/( DECODE((SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR)),0,NULL,(SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR))) ),3)*100,0) AS RSLT_SUM 
                      ,NVL(ROUND((E.TLY_SUM)/( DECODE((SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR)),0,NULL,(SUM(E.CLCT_SUM ) OVER (PARTITION BY E.CNSL_YR))) ),3)*100,0) AS MTH_AVG
                      ,ROUND(E.MTH_1,3)  *100 AS MTH_1 
                      ,ROUND(E.MTH_2,3)  *100 AS MTH_2 
                      ,ROUND(E.MTH_3,3)  *100 AS MTH_3 
                      ,ROUND(E.MTH_4,3)  *100 AS MTH_4 
                      ,ROUND(E.MTH_5,3)  *100 AS MTH_5 
                      ,ROUND(E.MTH_6,3)  *100 AS MTH_6 
                      ,ROUND(E.MTH_7,3)  *100 AS MTH_7 
                      ,ROUND(E.MTH_8,3)  *100 AS MTH_8 
                      ,ROUND(E.MTH_9,3)  *100 AS MTH_9 
                      ,ROUND(E.MTH_10,3) *100 AS MTH_10 
                      ,ROUND(E.MTH_11,3) *100 AS MTH_11 
                      ,ROUND(E.MTH_12,3) *100 AS MTH_12
                FROM 
                    (SELECT  #CNSL_YR#  AS  CNSL_YR
                            ,'09'  AS  DATA_GB /*감정율 (전체감정(건)/전체회수(건))*/
                            ,DATA_SECTION
                            ,NVL(SUM(TMP_D.TLY_CNT),0) AS TLY_SUM
                            ,NVL(SUM(TMP_D.CLCT_CNT),0) AS CLCT_SUM 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'01',TLY_RT )),0) AS MTH_1 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'02',TLY_RT )),0) AS MTH_2 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'03',TLY_RT )),0) AS MTH_3 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'04',TLY_RT )),0) AS MTH_4
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'05',TLY_RT )),0) AS MTH_5
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'06',TLY_RT )),0) AS MTH_6
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'07',TLY_RT )),0) AS MTH_7 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'08',TLY_RT )),0) AS MTH_8 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'09',TLY_RT )),0) AS MTH_9 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'10',TLY_RT )),0) AS MTH_10 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'11',TLY_RT )),0) AS MTH_11 
                            ,NVL(SUM(DECODE(SUBSTR(TMP_D.CNSL_YM,5,6) ,'12',TLY_RT )),0) AS MTH_12
                      FROM  TMP_D  
                     GROUP  BY #CNSL_YR#,TMP_D.DATA_SECTION
                     ORDER  BY TMP_D.DATA_SECTION)E )E1
        UNION ALL             
        SELECT  F1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'10'  AS  DATA_GB  /* 감정금액(천원) */
                       ,GROUPING(TMP_E.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION   /*01스마트폰 02피쳐폰 03기타*/
                       ,ROUND(NVL(SUM(TMP_E.JDG_AMT_SUM)/1000,0))  AS  RSLT_SUM
                       ,NVL(ROUND((SUM(TMP_E.JDG_AMT_SUM)/12)/1000),0)  AS  MTH_AVG
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',JDG_AMT_SUM )),0)/1000)  AS  MTH_1
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',JDG_AMT_SUM )),0)/1000)  AS  MTH_2
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',JDG_AMT_SUM )),0)/1000)  AS  MTH_3
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',JDG_AMT_SUM )),0)/1000)  AS  MTH_4
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',JDG_AMT_SUM )),0)/1000)  AS  MTH_5
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',JDG_AMT_SUM )),0)/1000)  AS  MTH_6
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',JDG_AMT_SUM )),0)/1000)  AS  MTH_7
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',JDG_AMT_SUM )),0)/1000)  AS  MTH_8
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',JDG_AMT_SUM )),0)/1000)  AS  MTH_9
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',JDG_AMT_SUM )),0)/1000)  AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',JDG_AMT_SUM )),0)/1000)  AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',JDG_AMT_SUM )),0)/1000)  AS  MTH_12
                 FROM  TMP_E  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_E.DATA_SECTION)
                 ORDER BY TMP_E.DATA_SECTION) F1
        UNION ALL
        SELECT  F2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'10'  AS  DATA_GB  /* 감정금액(천원) */
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/
                       ,ROUND(NVL(SUM(TMP_F.JDG_AMT_SUM)/1000,0))  AS  RSLT_SUM
                       ,NVL(ROUND((SUM(TMP_F.JDG_AMT_SUM)/12)/1000),0)  AS  MTH_AVG
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',JDG_AMT_SUM )),0)/1000)  AS  MTH_1
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',JDG_AMT_SUM )),0)/1000)  AS  MTH_2
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',JDG_AMT_SUM )),0)/1000)  AS  MTH_3
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',JDG_AMT_SUM )),0)/1000)  AS  MTH_4
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',JDG_AMT_SUM )),0)/1000)  AS  MTH_5
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',JDG_AMT_SUM )),0)/1000)  AS  MTH_6
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',JDG_AMT_SUM )),0)/1000)  AS  MTH_7
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',JDG_AMT_SUM )),0)/1000)  AS  MTH_8
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',JDG_AMT_SUM )),0)/1000)  AS  MTH_9
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',JDG_AMT_SUM )),0)/1000)  AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',JDG_AMT_SUM )),0)/1000)  AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',JDG_AMT_SUM )),0)/1000)  AS  MTH_12
                 FROM  TMP_F  
                GROUP  BY #CNSL_YR#,TMP_F.DATA_SECTION 
                ORDER  BY TMP_F.DATA_SECTION) F2    
        UNION ALL
        SELECT  G1.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'11'  AS  DATA_GB  /* 감정단가(원)	*/
                       ,GROUPING(TMP_E.DATA_SECTION) AS G_ID  
                       ,DATA_SECTION   /*01스마트폰 02피쳐폰 03기타*/
                       ,ROUND(NVL(SUM(TMP_E.JDG_AMT_SUM)/DECODE(SUM(TMP_E.TLY_CNT),0,NULL,SUM(TMP_E.TLY_CNT)),0),0)  AS  RSLT_SUM
                       ,ROUND(NVL(SUM(TMP_E.JDG_AMT_SUM)/DECODE(SUM(TMP_E.TLY_CNT),0,NULL,SUM(TMP_E.TLY_CNT)),0),0)  AS  MTH_AVG
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'01',TMP_E.TLY_CNT)),0)) AS  MTH_1
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'02',TMP_E.TLY_CNT)),0)) AS  MTH_2
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'03',TMP_E.TLY_CNT)),0))	AS  MTH_3
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'04',TMP_E.TLY_CNT)),0))	AS  MTH_4
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'05',TMP_E.TLY_CNT)),0))	AS  MTH_5
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'06',TMP_E.TLY_CNT)),0))	AS  MTH_6
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'07',TMP_E.TLY_CNT)),0))	AS  MTH_7
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'08',TMP_E.TLY_CNT)),0))	AS  MTH_8
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'09',TMP_E.TLY_CNT)),0))	AS  MTH_9
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'10',TMP_E.TLY_CNT)),0))	AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'11',TMP_E.TLY_CNT)),0))	AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',TMP_E.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_E.CNSL_YM,5,6) ,'12',TMP_E.TLY_CNT)),0))	AS  MTH_12
                 FROM  TMP_E  
                 GROUP BY #CNSL_YR#, ROLLUP(TMP_E.DATA_SECTION)
                 ORDER BY TMP_E.DATA_SECTION) G1
        UNION ALL
        SELECT  G2.*
          FROM (SELECT  #CNSL_YR#  AS  CNSL_YR
                       ,'11'  AS  DATA_GB  /* 감정단가(원)	*/
                       , 0 AS G_ID
                       ,DATA_SECTION /*마케팅본부분류*/                                                                                                                   
                       ,ROUND(NVL(SUM(TMP_F.JDG_AMT_SUM)/DECODE(SUM(TMP_F.TLY_CNT),0,NULL,SUM(TMP_F.TLY_CNT)),0),0)  AS  RSLT_SUM                                         
                       ,ROUND(NVL(SUM(TMP_F.JDG_AMT_SUM)/DECODE(SUM(TMP_F.TLY_CNT),0,NULL,SUM(TMP_F.TLY_CNT)),0),0)  AS  MTH_AVG                                          
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',TMP_F.TLY_CNT)),0)) AS  MTH_1 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',TMP_F.TLY_CNT)),0)) AS  MTH_2 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',TMP_F.TLY_CNT)),0))	AS  MTH_3 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',TMP_F.TLY_CNT)),0))	AS  MTH_4 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',TMP_F.TLY_CNT)),0))	AS  MTH_5 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',TMP_F.TLY_CNT)),0))	AS  MTH_6 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',TMP_F.TLY_CNT)),0))	AS  MTH_7 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',TMP_F.TLY_CNT)),0))	AS  MTH_8 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',TMP_F.TLY_CNT)),0))	AS  MTH_9 
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',TMP_F.TLY_CNT)),0))	AS  MTH_10
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',TMP_F.TLY_CNT)),0))	AS  MTH_11
                       ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',TMP_F.JDG_AMT_SUM))/SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',TMP_F.TLY_CNT)),0))	AS  MTH_12
                 FROM  TMP_F  
                GROUP  BY #CNSL_YR#,TMP_F.DATA_SECTION 
                ORDER  BY TMP_F.DATA_SECTION) G2
      UNION ALL
      SELECT K1.*
        FROM (SELECT #CNSL_YR# AS CNSL_YR 
                    ,'12' AS DATA_GB  /* 오감정(건) */
                    ,GROUPING(TMP_F.DATA_SECTION) AS G_ID 
                    ,DATA_SECTION    /*마케팅본부분류*/
                    ,NVL(SUM(TMP_F.BAD_JDG_CNT),0) AS RSLT_SUM 
                    ,NVL(TRUNC(SUM(TMP_F.BAD_JDG_CNT)/12),0) AS MTH_AVG 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',BAD_JDG_CNT )),0) AS MTH_1 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',BAD_JDG_CNT )),0) AS MTH_2 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',BAD_JDG_CNT )),0) AS MTH_3 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',BAD_JDG_CNT )),0) AS MTH_4 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',BAD_JDG_CNT )),0) AS MTH_5 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',BAD_JDG_CNT )),0) AS MTH_6 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',BAD_JDG_CNT )),0) AS MTH_7 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',BAD_JDG_CNT )),0) AS MTH_8 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',BAD_JDG_CNT )),0) AS MTH_9 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',BAD_JDG_CNT )),0) AS MTH_10
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',BAD_JDG_CNT )),0) AS MTH_11 
                    ,NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',BAD_JDG_CNT )),0) AS MTH_12
              FROM  TMP_F
              GROUP BY #CNSL_YR#,ROLLUP(TMP_F.DATA_SECTION)
              ORDER BY TMP_F.DATA_SECTION) K1
      UNION ALL
      SELECT K2.*
        FROM (SELECT #CNSL_YR# AS CNSL_YR
                    ,'13' AS DATA_GB /* 오감정금액(천원) */
                    ,GROUPING(TMP_F.DATA_SECTION) AS G_ID
                    ,DATA_SECTION /*마케팅본부분류*/
                    ,ROUND(NVL(SUM(TMP_F.BAD_JDG_AMT_SUM)/1000,0)) AS RSLT_SUM 
                    ,NVL(ROUND((SUM(TMP_F.BAD_JDG_AMT_SUM)/12)/1000),0) AS MTH_AVG 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'01',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_1 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'02',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_2 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'03',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_3 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'04',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_4 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'05',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_5 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'06',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_6 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'07',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_7 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'08',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_8 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'09',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_9 
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'10',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_10
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'11',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_11
                    ,ROUND(NVL(SUM(DECODE(SUBSTR(TMP_F.CNSL_YM,5,6) ,'12',BAD_JDG_AMT_SUM )),0)/1000) AS MTH_12
              FROM  TMP_F
              GROUP BY #CNSL_YR#,ROLLUP(TMP_F.DATA_SECTION)
              ORDER BY TMP_F.DATA_SECTION ) K2            
)T
ORDER BY T.DATA_GB,T.G_ID DESC ,T.DATA_SECTION]]>
	</select>
</sqlMap>