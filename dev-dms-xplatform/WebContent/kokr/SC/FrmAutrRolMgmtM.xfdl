<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="BUSC011M01" classname="ProgramReg" inheritanceid="" position="absolute 0 0 1038 528" titletext="화면권한역할관리" style="font:arial,11;" onload="Form_onload" ondragmove="BUSC011M01_ondragmove" onkeydown="BUSC011M01_onkeydown">
    <Layouts>
      <Layout>
        <Static id="Static06" text="w&#13;&#10;20" class="tip_guide" visible="false" position2="absolute l:1018 w:20 t:27 h:485" positiontype="position2"/>
        <Static id="Static00" text="h10" class="tip_guide" visible="false" position2="absolute l:101 w:42 t:0 h:10" positiontype="position2"/>
        <Div id="div_search" anchor="left top right" taborder="2" text="Div00" class="bg_search" position="absolute 0 0 1018 40" applystyletype="cascade,keep">
          <Layouts>
            <Layout>
              <Static id="Static01" text="권한역할" class="sta_WFDA_detail_Label_P" position="absolute 14 9 82 29" anchor="default"/>
              <Static id="Static08" text="w&#13;&#10;&#13;10" class="tip_guide" visible="false" position2="absolute l:71 w:10 t:2 h:42" positiontype="position2"/>
              <Static id="Static12" text="w&#13;&#10;&#13;15" class="tip_guide" visible="false" position2="absolute l:-1 w:15 t:2 h:42" positiontype="position2"/>
              <Edit id="edt_rollId" taborder="0" position="absolute 81 9 215 29" anchor="default" onkeydown="div_Search_edt_id_onkeydown" maxlength="5" validate="title:권한역할ID,maxlengthB:5" inputtype="digit,alpha" class="Code" imemode="alpha"/>
              <Edit id="edt_rollNm" taborder="1" position="absolute 217 9 351 29" anchor="default" onkeydown="div_Search_edt_id_onkeydown" imemode="hangul" maxlength="50" validate="title:권한역할명,maxlengthB:50" oneditclick="div_search_edt_rollNm_oneditclick"/>
              <Button id="btn_00" taborder="2" onclick="fn_Popup_search" class="btn_WFSA_search" position="absolute 352 9 372 29" tooltiptype="hover" anchor="default" tooltiptext="권한코드검색"/>
              <Button id="btn_reset" taborder="4" onclick="div_search_btn_reset_onclick" class="btn_WFSA_reset" position="absolute 373 9 393 29" anchor="default" tooltiptext="초기화"/>
            </Layout>
          </Layouts>
        </Div>
        <Button id="btn_search" taborder="27" text="조회" onclick="btn_search_onclick" class="btn_WFSA_Search_M" position="absolute 959 12 1017 39" anchor="top right" style="align:center middle;"/>
        <Div id="Div_down" anchor="all" taborder="40" scrollbars="none" position="absolute 0 362 1019 529">
          <Layouts>
            <Layout width="1017" height="260">
              <Static id="stc_subTitle03" visible="false" position="absolute 117 3 472 23" anchor="left top" style="color:#31a3dcff;align:left middle;"/>
              <Static id="stc_subTitle02" text="화면 세부 권한" class="sub_title" position="absolute 0 4 111 22" anchor="left top"/>
              <Button id="btn_del" taborder="1" onclick="fn_frmrol_dtl_delete" class="btn_common_delTxt" enable="false" position="absolute 917 4 967 24" anchor="top right" tooltiptype="hover" tooltiptext="행삭제" text="삭제"/>
              <Static id="Static16" text="h3" class="tip_guide" visible="false" position2="absolute l:964 w:42 t:24 h:3" positiontype="position2"/>
              <Static id="Static14" text="h8" class="tip_guide" visible="false" position2="absolute l:6 w:42 t:19 h:8" positiontype="position2"/>
              <Button id="btn_save" taborder="2" text="저장" onclick="btn_save_onclick" class="btn_common_saveTxt" enable="false" position="absolute 968 4 1018 24" anchor="top right" tooltiptype="hover" tooltiptext="저장"/>
              <UserGrid id="grd_frmrol_dtl" class="grd_subGrid" taborder="3" binddataset="ds_frmRol_detail" autoenter="select" useinputpanel="false" cellsizingtype="col" cellmovingtype="col" autofittype="col" hideendline="col" position="absolute 0 27 1018 166" anchor="all" style="cursor:hand;" _number="false" _status="true" _check="false" _checkColumnName="_checkcol" _checkedallevent="false" _nodataimage="true" _sort="true" _tooltip="true">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="153"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="78"/>
                      <Column size="81"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell rowspan="2" text="화면항목그룹ID" taborder="undefined"/>
                      <Cell col="1" colspan="6" taborder="undefined">
                        <Cell colspan="5" text="권 한" taborder="undefined"/>
                        <Cell col="5"/>
                      </Cell>
                      <Cell col="7" rowspan="2" text="사용여부" taborder="undefined"/>
                      <Cell row="1" col="1" text="조회"/>
                      <Cell row="1" col="2" text="저장"/>
                      <Cell row="1" col="3" text="삭제"/>
                      <Cell row="1" col="4" text="출력"/>
                      <Cell row="1" col="5" text="엑셀"/>
                      <Cell row="1" col="6" text="개인정보"/>
                    </Band>
                    <Band id="body">
                      <Cell displaytype="expr:expr:dataset.getRowType(currow)==2  ?  'GRP1' : 'text'" edittype="readonly" text="bind:FRM_ITEM_GRP_ID"/>
                      <Cell col="1" displaytype="checkbox" edittype="checkbox" text="bind:INQ_AUTR_YN"/>
                      <Cell col="2" displaytype="checkbox" edittype="checkbox" text="bind:SAVE_AUTR_YN"/>
                      <Cell col="3" displaytype="checkbox" edittype="checkbox" text="bind:DEL_AUTR_YN"/>
                      <Cell col="4" displaytype="checkbox" edittype="checkbox" text="bind:OPUT_AUTR_YN"/>
                      <Cell col="5" displaytype="checkbox" edittype="checkbox" text="bind:EXL_AUTR_YN"/>
                      <Cell col="6" displaytype="checkbox" edittype="checkbox" text="bind:PRN_INFO_INQ_AUTR_YN"/>
                      <Cell col="7" displaytype="checkbox" edittype="checkbox" text="bind:USE_YN"/>
                    </Band>
                  </Format>
                </Formats>
              </UserGrid>
              <Button id="btn_add" taborder="4" text="추가" onclick="fn_frmrol_dtl_insert" class="btn_common_addTxt" enable="false" position="absolute 866 4 916 24" anchor="top right" tooltiptype="hover" tooltiptext="행추가"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="Div_up" anchor="all" taborder="41" scrollbars="none" position="absolute 0 40 1019 344">
          <Layouts>
            <Layout width="1017" height="260">
              <Static id="stc_subTitle03" visible="false" position="absolute 117 11 361 31" anchor="left top" style="color:#31a3dcff;align:left middle;"/>
              <Static id="Static03" text="권한 있는 화면" class="sub_title" position="absolute 0 12 243 32" anchor="default"/>
              <Static id="Static02" text="h14" class="tip_guide" visible="false" position2="absolute l:5 w:42 t:0 h:14" positiontype="position2"/>
              <Static id="Static04" text="h8" class="tip_guide" visible="false" position2="absolute l:6 w:42 t:27 h:8" positiontype="position2"/>
              <Static id="Static05" text="h25" class="tip_guide" visible="false" position2="absolute l:202 w:42 t:36 h:25" positiontype="position2"/>
              <UserGrid id="grd_frmrol_N" class="grd_Folder" taborder="1" binddataset="ds_frmRol_N" autoenter="select" useinputpanel="false" cellsizingtype="col" cellmovingtype="col" autofittype="col" hideendline="col" treeinitstatus="collapse,all" onlbuttonup="grd_frmrol_N_onlbuttonup" oncellclick="grd_frmrol_N_oncellclick" ondrag="grd_frmrol_N_ondrag" position="absolute 531 35 1018 300" anchor="top right bottom" style="cursor:hand;moveeffect:none;" _number="false" _status="false" _check="false" _checkColumnName="_checkcol" _checkedallevent="false" _nodataimage="true" _sort="true" _tooltip="true">
                <Formats>
                  <Format id="filterF">
                    <Columns>
                      <Column size="80"/>
                    </Columns>
                    <Rows>
                      <Row size="24"/>
                    </Rows>
                    <Band id="body">
                      <Cell displaytype="tree" edittype="expr:getColumn(currow,'AUTR_YN')==0 ? 'tree':'none'" style="color:expr:getColumn(currow,'AUTR_YN')==0 ? '':'#c0c0c0ff';" text="bind:MENU_NM" treelevel="bind:MENU_LV" treecheck="bind:CHK"/>
                    </Band>
                  </Format>
                  <Format id="format_copy"/>
                </Formats>
              </UserGrid>
              <UserGrid id="grd_frmrol_Y" class="grd_Folder" taborder="2" binddataset="ds_frmRol_Y" autoenter="select" useinputpanel="false" cellsizingtype="col" cellmovingtype="col" autofittype="col" hideendline="col" treeinitstatus="collapse,all" onlbuttonup="grd_frmrol_Y_onlbuttonup" oncellclick="grd_frmrol_Y_oncellclick" oncelldblclick="grd_frmrol_Y_oncelldblclick" ondrag="grd_frmrol_Y_ondrag" position="absolute 0 35 488 300" anchor="all" style="cursor:hand;" _number="false" _status="false" _check="false" _checkColumnName="_checkcol" _checkedallevent="false" _nodataimage="true" _sort="false" _tooltip="true">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="80"/>
                    </Columns>
                    <Rows>
                      <Row size="24"/>
                    </Rows>
                    <Band id="body">
                      <Cell displaytype="tree" edittype="tree" style="color: ;" text="bind:MENU_NM" treelevel="bind:MENU_LV" treecheck="bind:CHK"/>
                    </Band>
                  </Format>
                </Formats>
              </UserGrid>
              <Static id="Static07" text="h14" class="tip_guide" visible="false" position2="absolute l:575 w:42 t:0 h:14" positiontype="position2"/>
              <Static id="Static12" text="권한 없는 화면" class="sub_title" position="absolute 542 12 809 32" anchor="top right"/>
              <Static id="Static17" text="h8" class="tip_guide" visible="false" position2="absolute l:578 w:42 t:27 h:8" positiontype="position2"/>
              <Static id="stc_01" text="화면명" class="sta_WFSA_Label" position="absolute 842 12 890 32" anchor="top right" style="font:Dotum,9;"/>
              <Edit id="edt_autrRol" taborder="3" imemode="hangul" maxlength="50" onkeydown="edt_autrRol_onkeydown" enable="false" position="absolute 892 12 974 32" anchor="top right" validate="title:권한역할명,maxlengthB:50"/>
              <Button id="btn_search_filter" taborder="4" onclick="btn_search_filter_onclick" class="btn_common_search2" enable="false" position="absolute 975 12 995 32" anchor="top right" tooltiptype="hover"/>
              <Button id="btn_reset_filter" taborder="5" onclick="btn_reset_filter_onclick" class="btn_common_reset" enable="false" position="absolute 996 12 1018 32" anchor="top right" tooltiptext="초기화"/>
              <Static id="Static08" text="h3" class="tip_guide" visible="false" position2="absolute l:975 w:42 t:-3 h:3" positiontype="position2"/>
              <Static id="stc_00" text="화면명" class="sta_WFSA_Label" position="absolute 312 12 360 32" anchor="top right" style="font:Dotum,9;"/>
              <Edit id="edt_autrRol00" taborder="6" imemode="hangul" maxlength="50" onkeydown="edt_autrRol00_onkeydown" enable="false" position="absolute 362 12 444 32" anchor="top right" validate="title:권한역할명,maxlengthB:50"/>
              <Button id="btn_search_filter00" taborder="7" onclick="btn_search_filter00_onclick" class="btn_common_search2" enable="false" position="absolute 445 12 465 32" anchor="top right" tooltiptype="hover"/>
              <Button id="btn_reset_filter00" taborder="8" onclick="btn_reset_filter00_onclick" class="btn_common_reset" enable="false" position="absolute 466 12 488 32" anchor="top right" tooltiptext="초기화"/>
              <Button id="btn_role_Del_All" taborder="9" onclick="btn_role_Del_All_onclick" class="btn_suttleRightAll" position="absolute 498 192 521 215" anchor="top right" tooltiptext="모두제거"/>
              <Button id="btn_role_Add_All" taborder="10" onclick="btn_role_Add_All_onclick" class="btn_suttleLeftAll" position="absolute 498 120 521 143" anchor="top right" tooltiptext="모두추가"/>
              <Static id="Static01" text="w20" class="tip_guide" visible="false" position2="absolute l:488 w:10 t:118 h:33" positiontype="position2"/>
              <Static id="Static13" text="w20" class="tip_guide" visible="false" position2="absolute l:521 w:10 t:182 h:33" positiontype="position2"/>
              <Button id="btn_roll_add" taborder="11" onclick="btn_roll_add_onclick" class="btn_suttleLeft" position="absolute 498 144 521 167" anchor="top right" tooltiptext="추가"/>
              <Button id="btn_roll_del" taborder="12" onclick="btn_roll_del_onclick" class="btn_suttleRight" position="absolute 498 168 521 191" anchor="top right" tooltiptext="제거"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="Static12" text="h15" class="tip_guide" visible="false" position2="absolute l:436 w:42 t:340 h:15" positiontype="position2"/>
        <Splitter id="Splitter03" min="200" max="550" type="vertical" position="absolute 4 349 1016 362" anchor="left top right">
          <Formats>
            <Format id="default">
              <SplitterItems id="items">
                <SplitterItem id="item00" componentid="Div_up" bindtype="resize" position="leftortop" offset="10"/>
                <SplitterItem id="item01" componentid="Div_down" bindtype="resize" position="rightorbottom" offset="10"/>
                <SplitterItem id="item02" bindtype="move" position="leftortop" offset="0" componentid="btn_hUp"/>
                <SplitterItem id="item03" bindtype="move" position="rightorbottom" offset="0" componentid="btn_hDown"/>
              </SplitterItems>
            </Format>
          </Formats>
        </Splitter>
        <Static id="btn_hUp" class="sta_splitterV_Up" position="absolute 496 345 516 351" anchor="left top right"/>
        <Static id="btn_hDown" class="sta_splitterV_Down" position="absolute 496 361 516 367" anchor="left top right"/>
        <Static id="Static01" text="h33" class="tip_guide" visible="false" position2="absolute l:436 w:42 t:356 h:33" positiontype="position2"/>
        <Static id="sta_frmrol_N_Move" text="grd_frmrol_N_Move" visible="false" position="absolute 544 91 944 115" anchor="left top" style="color:#3f3f3f6c;padding:0 0 0 10;"/>
        <Static id="sta_frmrol_Y_Move" text="grd_frmrol_Y_Move" visible="false" position="absolute 548 119 948 143" anchor="left top" style="color:#3f3f3f6c;padding:0 0 0 10;"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_ncFieldMap" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="AUTR_ROL_ID" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_gridMenuList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="MENU_LEVEL" type="STRING" size="256"/>
          <Column id="MENU_NM" type="STRING" size="256"/>
          <Column id="MENU_ID" type="STRING" size="256"/>
          <Column id="FUNCTION_ID" type="STRING" size="256"/>
          <Column id="ENABLE_YN" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="MENU_NM">행추가</Col>
            <Col id="MENU_LEVEL">0</Col>
            <Col id="MENU_ID">btn_add</Col>
            <Col id="FUNCTION_ID">fn_frmrol_dtl_insert</Col>
            <Col id="ENABLE_YN">Y</Col>
          </Row>
          <Row>
            <Col id="MENU_NM">행삭제</Col>
            <Col id="MENU_LEVEL">0</Col>
            <Col id="MENU_ID">btn_del</Col>
            <Col id="FUNCTION_ID">fn_frmrol_dtl_delete</Col>
            <Col id="ENABLE_YN">Y</Col>
          </Row>
          <Row>
            <Col id="MENU_LEVEL">0</Col>
            <Col id="MENU_NM">저장</Col>
            <Col id="MENU_ID">btn_save</Col>
            <Col id="FUNCTION_ID">btn_save_onclick</Col>
            <Col id="ENABLE_YN">Y</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_frmRol_Y" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="MENU_ID" type="STRING" size="256"/>
          <Column id="MENU_NM" type="STRING" size="256"/>
          <Column id="MENU_DESC" type="STRING" size="1500"/>
          <Column id="MENU_LV" type="STRING" size="256"/>
          <Column id="MENU_SORT_ORD" type="STRING" size="256"/>
          <Column id="FRM_ID" type="STRING" size="256"/>
          <Column id="FRM_NM" type="STRING" size="256"/>
          <Column id="SUP_MENU_ID" type="STRING" size="256"/>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="AUTR_YN" type="STRING" size="256"/>
          <Column id="AUTR_ROL_ID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_frmRol_N" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="MENU_ID" type="STRING" size="256"/>
          <Column id="MENU_NM" type="STRING" size="256"/>
          <Column id="MENU_DESC" type="STRING" size="1500"/>
          <Column id="MENU_LV" type="STRING" size="256"/>
          <Column id="MENU_SORT_ORD" type="STRING" size="256"/>
          <Column id="FRM_ID" type="STRING" size="256"/>
          <Column id="FRM_NM" type="STRING" size="256"/>
          <Column id="SUP_MENU_ID" type="STRING" size="256"/>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="AUTR_YN" type="STRING" size="256"/>
          <Column id="AUTR_ROL_ID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_frmRol_detail" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="reset" reversesubsum="false">
        <ColumnInfo>
          <Column id="AUTR_ROL_ID" type="STRING" size="256"/>
          <Column id="FRM_ID" type="STRING" size="256"/>
          <Column id="FRM_ITEM_GRP_ID" type="STRING" size="256"/>
          <Column id="INQ_AUTR_YN" type="STRING" size="256"/>
          <Column id="SAVE_AUTR_YN" type="STRING" size="256"/>
          <Column id="UPD_AUTR_YN" type="STRING" size="256"/>
          <Column id="DEL_AUTR_YN" type="STRING" size="256"/>
          <Column id="OPUT_AUTR_YN" type="STRING" size="256"/>
          <Column id="EXL_AUTR_YN" type="STRING" size="256"/>
          <Column id="PRN_INFO_INQ_AUTR_YN" type="STRING" size="256"/>
          <Column id="USE_YN" type="STRING" size="256"/>
          <Column id="FRM_ITEM_GRP_ID_NUM" type="INT" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ncFieldMap2" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="AUTR_ROL_ID" type="STRING" size="256"/>
          <Column id="FRM_ID" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_frmRol_P" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="MENU_ID" type="STRING" size="256"/>
          <Column id="MENU_NM" type="STRING" size="256"/>
          <Column id="MENU_DESC" type="STRING" size="1500"/>
          <Column id="MENU_LV" type="STRING" size="256"/>
          <Column id="MENU_SORT_ORD" type="STRING" size="256"/>
          <Column id="FRM_ID" type="STRING" size="256"/>
          <Column id="FRM_NM" type="STRING" size="256"/>
          <Column id="SUP_MENU_ID" type="STRING" size="256"/>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="AUTR_YN" type="STRING" size="256"/>
          <Column id="AUTR_ROL_ID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_moving" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="MENU_ID" type="STRING" size="256"/>
          <Column id="MENU_NM" type="STRING" size="256"/>
          <Column id="MENU_DESC" type="STRING" size="1500"/>
          <Column id="MENU_LV" type="STRING" size="256"/>
          <Column id="MENU_SORT_ORD" type="STRING" size="256"/>
          <Column id="FRM_ID" type="STRING" size="256"/>
          <Column id="FRM_NM" type="STRING" size="256"/>
          <Column id="SUP_MENU_ID" type="STRING" size="256"/>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="AUTR_YN" type="STRING" size="256"/>
          <Column id="AUTR_ROL_ID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item1" compid="div_search.edt_rollId" propid="value" datasetid="ds_ncFieldMap" columnid="AUTR_ROL_ID"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/*
 * 01. 업무구분 : 공통
 * 02. 화면 : FrmAutrRolMgmtM.xfdl
 * 03. 화면 설명 : 화면권한역할관리
 * 04. 관련 화면/서비스 : 
 * 05. 작성자 : 심상준
 * 06. 작성일 : 2015.06.12
 * 07. 수정이력 :
 ************************************************************************************************
 *     수정일        이  름    사유
 ************************************************************************************************
 *     2015.06.12    심상준    최초 작성
 *     2014.10.07    심상준    최종 수정
 ************************************************************************************************
 */
 
/*===============================================================================================
 * [ PART 1 ] Form에서 Include 할 라이브러리(xjs)파일 정의
================================================================================================*/
include "LIB::common.xjs"; //공통함수 호출

/*===============================================================================================
 * [ PART 2 ] Form에서 사용될 전역변수를 선언
================================================================================================*/
var select_data = ""; //그리드영역에서 드래그시 선택데이터
var bDetailSearch = false; //상세조회여부 
/*===============================================================================================
 * [ PART 3 ] Form Event 처리
================================================================================================*/
/*----------------------------------------------------------------------------------------------
 * 설명   : Form Load Event
-----------------------------------------------------------------------------------------------*/
function Form_onload(obj:Form, e:LoadEventInfo)
{
	//공통 Form 초기화
	gfn_setInitForm(obj, e, "FRM0017M");
	
 	//Form 초기 개발자 셋팅
 	//공통코드 초기화
 	fn_setInitCode(obj, e);
 	//그리드 초기화
 	fn_setInitGrid(obj, e);
 	//기본값 초기화
 	fn_setInitForm(obj, e);
}

/*----------------------------------------------------------------------------------------------
 * 설명   : Form 종료전 Check 함수(공통)
-----------------------------------------------------------------------------------------------*/
function Form_checkBeforeClose()
{
	//변경된 Dataset검증
	if ( gfn_formBeforeOnClose(this, "ds_ncFieldMap") ) {
		return true;
	} else {
		return false;
	}
}


/*----------------------------------------------------------------------------------------------
 * 설명   :  form 내에서 esc버튼 클릭시 그리드 데이터셋 초기화 
 * param   : obj - Form
 * param   : e  - KeyEventInfo
 * return  : true/false
-----------------------------------------------------------------------------------------------*/
function BUSC011M01_onkeydown(obj:Form, e:KeyEventInfo)
{
	if(e.keycode ==KEYCODE_ESC) {	//ESC
		fn_clearDataset();
	}
}
/*----------------------------------------------------------------------------------------------
 * 설명   :  데이터셋초기화
 * return  : true/false
-----------------------------------------------------------------------------------------------*/
function fn_clearDataset(mode){
	if(gfn_isEmpty(mode)){
		if ( ds_frmRol_detail.rowposition != -1 && gfn_isUpdated(ds_frmRol_detail) ) {		
			if (!gfn_message("C","DMS00024","Q")){ //편집중인 데이터가 있습니다. 계속하시겠습니까?
				return false;
			} 
		} 
		div_search.edt_rollId.value = "";
		div_search.edt_rollNm.value = "";
	}
	Div_down.stc_subTitle03.text = "";
	Div_down.stc_subTitle03.visible = false;
	ds_frmRol_Y.clearData();
	ds_frmRol_N.clearData(); 
	ds_frmRol_P.clearData();
	ds_frmRol_detail.clearData();
	
	//변경시 필터 에디트 초기화 	
	if( Div_up.edt_autrRol00.enable) Div_up.edt_autrRol00.value = "";
	if( Div_up.edt_autrRol.enable ) Div_up.edt_autrRol.value = "";
}
/*===============================================================================================
 * [ PART 4 ] Load 후 초기설정
================================================================================================*/
/*----------------------------------------------------------------------------------------------
 * 설명   : 공통코드 초기화
-----------------------------------------------------------------------------------------------*/
function fn_setInitCode(obj:Form, e:LoadEventInfo)
{

}

/*----------------------------------------------------------------------------------------------
 * 설명   : 그리드 초기화
-----------------------------------------------------------------------------------------------*/
function fn_setInitGrid(obj:Form, e:LoadEventInfo)
{
	// 그리드 초기화 
	//gfn_initGrid(grd_main, bReadonly, bSortable, bTooltip, sSelectType, innerDs);
	gfn_initGrid(Div_down.grd_frmrol_dtl, false, true, true, "row", "ds_gridMenuList");
}

/*----------------------------------------------------------------------------------------------
 * 설명   : 기본값 설정
-----------------------------------------------------------------------------------------------*/
function fn_setInitForm(obj:Form, e:LoadEventInfo)
{
	div_search.edt_rollId.setFocus();
	fn_setEnable("save",false);			
}

/*===============================================================================================
 * [ PART 5 ] Transaction 처리
================================================================================================*/
/*----------------------------------------------------------------------------------------------
 * 설명   : 메인조회
 * param   : 
 * return  : void
-----------------------------------------------------------------------------------------------*/
function fn_searchMain()
{
	var sSvcID		 = "searchMain"; 
	var sTrID		     = "PSCFrmAutrRolMgmt_pInqAutrRolMenuLst"; //권한메뉴리스트조회 
	//var sTrID	     = "PSCFrmAutrRol_pInqFrmAutrRolLst";
	var sPtrn		     = "R";  //입력C,조회R,수정U,삭제D,복합M
	var sInputDs	     = "ncFieldMap=ds_ncFieldMap";
	var sOutputDs	 = "ds_frmRol_Y=RS_FRM_ROL_LIST_Y ds_frmRol_P=RS_FRM_ROL_LIST_P";
	//var sOutputDs	 = "ds_frmRol_Y=rsFrmRolListY";
	var sArgs		 = "";
	var sCallBackFnc = "fn_callBack";

	gfn_transaction(sSvcID, sTrID, sPtrn, sInputDs, sOutputDs, sArgs, sCallBackFnc);
}
/*----------------------------------------------------------------------------------------------
 * 설명   : 특정화면의 상세권한조회
 * param   : 
 * return  : void
-----------------------------------------------------------------------------------------------*/
function fn_seldetailAutr()
{
	var sSvcID		 = "searchDetail"; 
	var sTrID		 = "PSCFrmAutrRolMgmt_pInqFrmDtlAutr"; //화면권한조회 
	//var sTrID	     = "PSCFrmAutrRol_pInqFrmAutrRolLst";
	var sPtrn		 = "R";  //입력C,조회R,수정U,삭제D,복합M
	var sInputDs	 = "ncFieldMap=ds_ncFieldMap2";
	var sOutputDs	 = "ds_frmRol_detail=RS_FRM_ROL_LIST";  
	var sArgs		 = "";
	var sCallBackFnc = "fn_callBack";

	gfn_transaction(sSvcID, sTrID, sPtrn, sInputDs, sOutputDs, sArgs, sCallBackFnc);
}
/*----------------------------------------------------------------------------------------------
 * 설명   : 메인저장
 * param   : 
 * return  : void
-----------------------------------------------------------------------------------------------*/
function fn_saveMain()
{
	
	var sSvcID	 = "saveMain";
	var sTrID		 = "PSCFrmAutrRolMgmt_pSaveFrmAutr";	
	var sPtrn		 = "M";
	var sInputDs	 = "RS_FRM_ROL_LIST_Y=ds_frmRol_Y:u, RS_FRM_ROL_LIST=ds_frmRol_detail:u";
	var sOutputDs	 = "";
	var sArgs		 = "";
	var sCallBackFnc = "fn_callBack";

	gfn_transaction(sSvcID, sTrID, sPtrn, sInputDs, sOutputDs, sArgs, sCallBackFnc);

}

/*===============================================================================================
 * [ PART 6 ] CallBack 처리
================================================================================================*/
/*----------------------------------------------------------------------------------------------
 * 설명   : Transaction CallBack
 * param   : sSvcID, iErrorCode, sErrorMsg(ncMsgId,ncMsg)
 * return  : void
-----------------------------------------------------------------------------------------------*/
function fn_callBack(sSvcID, iErrorCode, sErrorMsg, ncMsgId, ncMsg)
{
	switch(sSvcID) {
		case "searchMain" : 
			if ( iErrorCode == 0 ) {
				fn_setAfterSearch();
				gfn_message("B","DMS00001");	//MSGI0003 :정상 조회되었습니다.				
			} 		
			Div_up.grd_frmrol_Y.binddataset = "ds_frmRol_Y";
			
			break;
		case "searchDetail" : 
			if ( iErrorCode == 0 ) {
				Div_down.stc_subTitle03.visible = true;
				fn_setEnable("dtlSave",true);	
			} else {
				Div_down.stc_subTitle03.visible = false;
			}			
			break;	
		case "saveMain" : 
			if ( iErrorCode == 0 ) {
				gfn_message("A","DMS00000","I");	//MSGI0001 : 정상 처리되었습니다.
				btn_search_onclick();
			}
			break;
		default :
			break;
	}
}
/*----------------------------------------------------------------------------------------------
 * 설명   : 메인조회 후 처리 
-----------------------------------------------------------------------------------------------*/
function fn_setAfterSearch(){
	//상위메뉴 비활성화
	//권한메뉴DS에 팝업화면DS appending
	ds_frmRol_Y.appendData(ds_frmRol_P);
	//권한없는메뉴DS에 권한있는메뉴DS 내용 붙이기
	ds_frmRol_N.copyData(ds_frmRol_Y);
	
	var tMenuId;
	for(var i=ds_frmRol_Y.rowcount-1; i>=0; i--){
		if(gfn_isEmpty(ds_frmRol_Y.getColumn(i,"FRM_ID")) ){  //상위메뉴
			tMenuId = ds_frmRol_Y.getColumn(i,"MENU_ID");			
			 if(ds_frmRol_Y.getCaseCount("SUP_MENU_ID == '"+tMenuId+"' && (AUTR_YN == 1 || (FRM_ID == '' && AUTR_YN == 0)) ") ==0){
			 
			    ds_frmRol_Y.updatecontrol = false;
				ds_frmRol_Y.setColumn(i,"FRM_ID","%");
				ds_frmRol_Y.updatecontrol = true;
			 }
		}
	}

	fn_setEnable("save",true);
	
	//권한없는화면 목록 데이터가 있는 경우 필터버튼 활성화 
	if (ds_frmRol_N.rowcount > 0){
		fn_setEnable("n",true);			
	} else {
		fn_setEnable("n",false);					
	}
	
	//권한있는화면 목록 데이터가 있는 경우 필터버튼 활성화 
	if (ds_frmRol_Y.rowcount > 0){
		fn_setEnable("y",true);			
	} else {
		fn_setEnable("y",false);					
	}

	//권한메뉴목록 필터링
	ds_frmRol_Y.filter("AUTR_YN==1 || FRM_ID =='' || FRM_ID == null ");				
	//Div_up.grd_frmrol_Y.treeinitstatus = "expand,all";
	//rowPostion 기본 설정
	ds_frmRol_Y.rowposition = 0;
	
	//접기
	Div_up.grd_frmrol_Y.treeinitstatus = "collapse,all";
	Div_up.grd_frmrol_N.treeinitstatus = "collapse,all";
	
	
}
/*===============================================================================================
 * [ PART 7 ] Main Button Event
================================================================================================*/
/*----------------------------------------------------------------------------------------------
 * 설명   : search
-----------------------------------------------------------------------------------------------*/
function btn_search_onclick(obj:Button,  e:ClickEventInfo)
{
	if( gfn_isEmpty(div_search.edt_rollId.value) || gfn_isEmpty(div_search.edt_rollNm.value))
	{
		gfn_message("A","DMS00023","I","","권한역할"); 
		fn_Popup_search();
		return false;
	}
	
	
	// 입력 항목 Validate Check
	if (!gfn_getValidateCompList(div_search)) {	
		return false;
	}
	Div_up.grd_frmrol_Y.binddataset = "";
	fn_clearDataset("mode");
	fn_searchMain();

}


/*----------------------------------------------------------------------------------------------
 * 설명   : save
-----------------------------------------------------------------------------------------------*/
function btn_save_onclick(obj:Button,  e:ClickEventInfo)
{
	if ( fn_chkBeforeSave() ) fn_saveMain();
}

/*----------------------------------------------------------------------------------------------
 * 설명   : insert
-----------------------------------------------------------------------------------------------*/
function btn_insert_onclick(obj:Button,  e:ClickEventInfo)
{
	var row = ds_userLst_mod.addRow();
	
}

/*----------------------------------------------------------------------------------------------
 * 설명   : 권한없는화면 목록 grid 필터 버튼 클릭시 이벤트 
-----------------------------------------------------------------------------------------------*/
function btn_search_filter_onclick(obj:Button,  e:ClickEventInfo)
{
	if(gfn_isEmpty(Div_up.edt_autrRol.value)) btn_reset_filter_onclick();
	
	// 입력 항목 Validate Check
	if (!gfn_getValidateCompList(this)) {	
		return false;
	}
	var str =Div_up.edt_autrRol.value;
	ds_frmRol_N.filter(""); //초기화 
	ds_frmRol_N.filter("String(MENU_NM).indexOf(\""+str+"\") >= 0");
	Div_up.grd_frmrol_N.treeinitstatus = "expand,all";
	ds_frmRol_N.rowposition= 0;
}
/*----------------------------------------------------------------------------------------------
 * 설명   : 권한없는화면 목록 grid 필터 새로고침 클릭시 이벤트 
-----------------------------------------------------------------------------------------------*/
function btn_reset_filter_onclick(obj:Button,  e:ClickEventInfo)
{
	Div_up.edt_autrRol.value = "";
	ds_frmRol_N.filter("");
	Div_up.grd_frmrol_N.treeinitstatus = "collapse,all";
}
/*----------------------------------------------------------------------------------------------
 * 설명   : 권한없는화면 목록 필터 Enter key 입력시 이벤트 
-----------------------------------------------------------------------------------------------*/
function edt_autrRol_onkeydown(obj:Edit, e:KeyEventInfo)
{
	if (e.keycode == KEYCODE_ENTER) {
		btn_search_filter_onclick();
	}	
}

/*----------------------------------------------------------------------------------------------
 * 설명   : 권한있는 화면 목록 grid 필터 버튼 클릭시 이벤트 
-----------------------------------------------------------------------------------------------*/
function btn_search_filter00_onclick(obj:Button,  e:ClickEventInfo)
{
	if(gfn_isEmpty(Div_up.edt_autrRol00.value)) Div_up.btn_reset_filter00_onclick();
	
	// 입력 항목 Validate Check
	if (!gfn_getValidateCompList(this)) {	
		return false;
	}
	var str =Div_up.edt_autrRol00.value;
	ds_frmRol_Y.filter("AUTR_YN ==1 || FRM_ID =='' || FRM_ID == null ");
	ds_frmRol_Y.filter("(AUTR_YN ==1 || FRM_ID =='' || FRM_ID == null) && String(MENU_NM).indexOf(\""+str+"\") >= 0");
	Div_up.grd_frmrol_Y.treeinitstatus = "expand,all";
	ds_frmRol_Y.rowposition= 0;
	
	//Div_up.grd_frmrol_Y_oncellclick(); //상세 grp권한 조회 
}

/*----------------------------------------------------------------------------------------------
 * 설명   : 권한있는 화면 목록 grid 필터 새로고침 클릭시 이벤트 
-----------------------------------------------------------------------------------------------*/
function btn_reset_filter00_onclick(obj:Button,  e:ClickEventInfo)
{
	Div_up.edt_autrRol00.value = "";
	ds_frmRol_Y.filter("AUTR_YN==1 || FRM_ID =='' || FRM_ID == null ");
	Div_up.grd_frmrol_Y.treeinitstatus = "collapse,all";
}

/*===============================================================================================
 * [ PART 8 ] Event
================================================================================================*/
/*----------------------------------------------------------------------------------------------
 * 설명   : 조회조건에서 엔터키가 눌러졌을때 검색창 호출
-----------------------------------------------------------------------------------------------*/
function div_Search_edt_id_onkeydown(obj:Edit, e:KeyEventInfo)
{
	if (e.keycode == KEYCODE_ENTER) {
		fn_Popup_search();
	} else {
		if(obj.name=="edt_rollNm") div_search.edt_rollId.value= "";
		if(obj.name=="edt_rollId") div_search.edt_rollNm.value= "";
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명   : 조회조건 리셋
-----------------------------------------------------------------------------------------------*/
function div_search_btn_reset_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_clearDataset();
}

/*----------------------------------------------------------------------------------------------
 * 설명   : 권한있는 화면 목록 필터 Enter key 입력시 이벤트 
-----------------------------------------------------------------------------------------------*/
function edt_autrRol00_onkeydown(obj:Edit, e:KeyEventInfo)
{
	if (e.keycode == KEYCODE_ENTER) {
		btn_search_filter00_onclick();
	}	
}
/*===============================================================================================
 * [ PART 9 ] User Defined
================================================================================================*/
/*----------------------------------------------------------------------------------------------
 * 설명   : 저장전 유효성 검사
 * param   : 
 * return  : true/false
-----------------------------------------------------------------------------------------------*/
function fn_chkBeforeSave()	
{
	//Div_up.grd_frmrol_Y.treeinitstatus = "collapse,null";
	ds_frmRol_Y.filter("");
	
	if(!gfn_isUpdated(ds_frmRol_Y) && !gfn_isUpdated(ds_frmRol_detail))//저장할 테이타셋 ds_Save
	{
		gfn_message("A","DMS00022","I");	//MSGI0020 : 변경된 정보가 없습니다.
		ds_frmRol_Y.filter("AUTR_YN==1 || FRM_ID =='' || FRM_ID == null ");
		//Div_up.grd_frmrol_Y.treeinitstatus = "expand,all";
		return false;
	}	
	return true;
}

/************************************************************************************************
 * 설명   :   < '추가' 버튼 클릭시 이벤트  
 * param   : obj - Button
 * param   : e  - ClickEventInfo
*************************************************************************************************/
function btn_roll_add_onclick(obj:Button,  e:ClickEventInfo)
{
	Fn_Rol_add2();
}
function	Fn_Rol_add2()
{
	if(ds_frmRol_N.getCaseCount("CHK ==1") ==0){
		gfn_message("A","DMS00020","W");	//DMS00020 : 선택된 정보가 없습니다.
		return;
	}
	
	//상세데이터셋 초기화 
	fn_clearDetailDs();
		
	var chkValue;
	var menuId;
	var frmId;
	var tRow;
	var spRow;
	var lastMenuId;
	var lastTRow;
	//권한메뉴목록 필터링		
	ds_frmRol_Y.filter("");
	
	for(var i=0; i<ds_frmRol_N.getRowCount(); i++){
		//권한없는화면데이터셋에서 해당 데이터 비활성화처리 
		chkValue = ds_frmRol_N.getColumn(i,"CHK");
		menuId = ds_frmRol_N.getColumn(i,"MENU_ID");
		frmId =  ds_frmRol_N.getColumn(i,"FRM_ID");
		tRow = ds_frmRol_Y.findRow("MENU_ID",menuId);
		if(chkValue ){
			if(!gfn_isEmpty(frmId)){
				ds_frmRol_N.setColumn(i,"AUTR_YN",1); //권한없는화면목록에서  활성화
				ds_frmRol_Y.setColumn(tRow ,"AUTR_YN",1); 	
			} else {
				//상위메뉴원복
				if(ds_frmRol_Y.getColumn(tRow,"FRM_ID")=="%") {
				    spRow = ds_frmRol_Y.findRow( "MENU_ID", ds_frmRol_Y.getColumn(tRow,"SUP_MENU_ID") );

					ds_frmRol_Y.updatecontrol = false;
					ds_frmRol_Y.setColumn(spRow,"FRM_ID","");	
					ds_frmRol_Y.setColumn(tRow,"FRM_ID","");	
					ds_frmRol_Y.updatecontrol = true;
				}			
			}
			
			ds_frmRol_N.setColumn(i,"CHK",0);
			lastMenuId = menuId;
			lastTRow = tRow; 
		}
	}
	var supMenuId;
	var superMenuArray = new Array;
	//상위메뉴 확인하여 활성화시키기 
	for(var i=ds_frmRol_Y.getRowCount()-1; i>=0; i--){
		menuId = ds_frmRol_Y.getColumn(i,"MENU_ID"); 
		if(ds_frmRol_Y.getColumn(i,"FRM_ID")=="%"){
			 if(ds_frmRol_Y.getCaseCount("(SUP_MENU_ID == '"+menuId+"' && AUTR_YN == '1' ) || (SUP_MENU_ID == '"+menuId+"' && FRM_ID==''  && AUTR_YN == '0' ) ") >0){
				ds_frmRol_Y.setColumn(i,"FRM_ID","");			
			 }
		}
	}
		
	//권한메뉴목록 필터링		
	ds_frmRol_Y.filter("AUTR_YN ==1  || FRM_ID =='' || FRM_ID == null ");
	//권한메뉴 그리드 접기
	Div_up.grd_frmrol_Y.treeinitstatus = "collapse,all";
	//Div_up.grd_frmrol_N.treeinitstatus = "collapse,all";
	
	//변경시 필터 에디트 초기화 	
	Div_up.edt_autrRol00.value = "";
	Div_up.edt_autrRol.value = "";
}

/*************************************************************************************************
 * 설명   :   > '제거' 버튼 클릭시 이벤트  
 * param   : obj - Button
 * param   : e  - ClickEventInfo
*************************************************************************************************/
function btn_roll_del_onclick(obj:Button,  e:ClickEventInfo)
{
	Fn_Rol_delete2();
}
function Fn_Rol_delete2(){
	
	if(ds_frmRol_Y.getCaseCount("CHK ==1") ==0){
		gfn_message("A","DMS00020","W");	//DMS00020 : 선택된 정보가 없습니다.
		return;
	}
		
	if ( ds_frmRol_detail.rowposition != -1 && gfn_isUpdated(ds_frmRol_detail)) {		
		if (!gfn_message("C","DMS00024","Q")){ //편집중인 데이터가 있습니다. 계속하시겠습니까?
			return false;
		} 
	} 
	//상세데이터셋 초기화 
	fn_clearDetailDs();
	
	var chkValue;
	var menuId;
	var frmId;
	var tRow;
	var childRowCnt;
	
	for(var j=ds_frmRol_Y.getRowCount()-1; j>=0;j--){
		//권한있는화면데이터셋에서 해당 데이터 삭제처리 
		chkValue = ds_frmRol_Y.getColumn(j,"CHK");
		
		if(chkValue){
			menuId = ds_frmRol_Y.getColumn(j,"MENU_ID");
			frmId =  ds_frmRol_Y.getColumn(j,"FRM_ID");		
			
			if( !gfn_isEmpty(frmId)){
				tRow = ds_frmRol_N.findRow("MENU_ID",menuId);
				ds_frmRol_N.setColumn(tRow,"AUTR_YN",0); //권한없는화면목록에서  활성화
				ds_frmRol_Y.setColumn(j,"AUTR_YN",0);	 //권한목록에서 비활성화 
				ds_frmRol_Y.setColumn(j,"CHK",0);
			} else {
				ds_frmRol_Y.setColumn(j,"FRM_ID","%");	
				ds_frmRol_Y.updatecontrol = false;
				ds_frmRol_Y.setRowType(j,Dataset.ROWTYPE_NORMAL); //수정되지 않은 데이터로 변경
				ds_frmRol_Y.setColumn(j,"CHK",0);
				ds_frmRol_Y.updatecontrol = true;
			}
		}
		
	}		
	
	//상위메뉴 확인하여 비활성화시키기 (화면이 하나도 없는 경우 상위메뉴를 트리상에서 지우기) 
	for(var i=ds_frmRol_Y.getRowCount()-1; i>=0; i--){
		menuId = ds_frmRol_Y.getColumn(i,"MENU_ID"); 
		if(gfn_isEmpty(ds_frmRol_Y.getColumn(i,"FRM_ID"))){
			 if(ds_frmRol_Y.getCaseCount("(SUP_MENU_ID == '"+menuId+"' && AUTR_YN == '1' ) || (SUP_MENU_ID == '"+menuId+"' && FRM_ID==''  && AUTR_YN == '0' ) ")==0){
				ds_frmRol_Y.setColumn(i,"FRM_ID","%");			
			 }
		}
	}
	
	//권한메뉴목록 필터링
	ds_frmRol_Y.filter("AUTR_YN ==1 || FRM_ID =='' || FRM_ID == null ");
	//Div_up.grd_frmrol_N.treeinitstatus = "expand,all";
	//Div_up.grd_frmrol_Y.treeinitstatus = "expand,all";
	ds_frmRol_N.rowposition = tRow; //권한없는화면목록의 포커스 이동 
	
	if(ds_frmRol_Y.getRowCount()==0){
		//상세권한 데이터셋 초기화 
		fn_clearDetailDs();
	}
	
	//변경시 필터 에디트 초기화 	
	Div_up.edt_autrRol00.value = "";
	Div_up.edt_autrRol.value = "";
}
/************************************************************************************************
 * 설명   :   << 버튼 클릭시 이벤트  
 * param   : obj - Button
 * param   : e  - ClickEventInfo
*************************************************************************************************/
function btn_role_Add_All_onclick(obj:Button,  e:ClickEventInfo)
{
	//전체 권한 선택
	for(var i = 0; i < ds_frmRol_N.getRowCount(); i++){
		ds_frmRol_N.setColumn(i,"CHK",1);
	}

	Fn_Rol_add2();
}

/*************************************************************************************************
 * 설명   :   >> 버튼 클릭시 이벤트  
 * param   : obj - Button
 * param   : e  - ClickEventInfo
*************************************************************************************************/
function btn_role_Del_All_onclick(obj:Button,  e:ClickEventInfo)
{	
	//전체 권한 선택
	for(var i = 0; i < ds_frmRol_Y.getRowCount(); i++){
		ds_frmRol_Y.setColumn(i,"CHK",1);
	}

	Fn_Rol_delete2();
}

/*----------------------------------------------------------------------------------------------
 * 설명   :  조회후  버튼활성화 제어 
-----------------------------------------------------------------------------------------------*/
function fn_setEnable(mode, bFlag){
	switch(mode) {
		case "dtlSave" : 
			Div_down.btn_add.enable = bFlag;
			Div_down.btn_del.enable = bFlag;
			break;
		case "save" : 
			//btn_add.enable = bFlag;
			//btn_del.enable = bFlag;
			Div_down.btn_save.enable = bFlag;
			break;
		case "y" : //권한있는화면목록
			Div_up.edt_autrRol00.enable       = bFlag;
			Div_up.btn_search_filter00.enable = bFlag;
			Div_up.btn_reset_filter00.enable   = bFlag;
			break;
		case "n" : //권한없는화면목록
			Div_up.btn_search_filter.enable = bFlag;
			Div_up.btn_reset_filter.enable = bFlag;
			Div_up.edt_autrRol.enable = bFlag;
			break;			
		default :
			break;
	}		
}
/*----------------------------------------------------------------------------------------------
 * 설명   : 화면세부권한 행추가
-----------------------------------------------------------------------------------------------*/
function fn_frmrol_dtl_insert(obj:Button,  e:ClickEventInfo)
{
	var tFrmId = ds_ncFieldMap2.getColumn(0, "FRM_ID"); //ds_frmRol_Y.getColumn(Div_up.grd_frmrol_Y.currentrow, 'frmId');
	if( gfn_isEmpty(tFrmId) || tFrmId == "%"){
		return;
	}

	//권한목록 그리드 활성화제어
	Div_up.grd_frmrol_Y.enable  = false;
	
	var maxGrpId = ds_frmRol_detail.getMax("FRM_ITEM_GRP_ID_NUM");
	var grpId = ds_frmRol_detail.getRowCount() ==0 ? "1" : toNumber(maxGrpId)+1;
	var row = ds_frmRol_detail.addRow();
	
	ds_frmRol_detail.setColumn(row,'FRM_ITEM_GRP_ID',"GRP"+grpId);//ds_frmRol_detail.getRowCount());
	ds_frmRol_detail.setColumn(row,"FRM_ITEM_GRP_ID_NUM",grpId);
	ds_frmRol_detail.setColumn(row,'AUTR_ROL_ID',ds_ncFieldMap.getColumn(0, "AUTR_ROL_ID"));
	ds_frmRol_detail.setColumn(row,'FRM_ID',tFrmId);
	//행추가시 디폴트로 모든권한추가 -20141015 lje
	ds_frmRol_detail.setColumn(row,"INQ_AUTR_YN", 1);
	ds_frmRol_detail.setColumn(row,"SAVE_AUTR_YN", 1);
	ds_frmRol_detail.setColumn(row,"UPD_AUTR_YN", 1);
	ds_frmRol_detail.setColumn(row,"DEL_AUTR_YN", 1);
	ds_frmRol_detail.setColumn(row,"OPUT_AUTR_YN", 1);
	ds_frmRol_detail.setColumn(row,"EXL_AUTR_YN", 1);
	ds_frmRol_detail.setColumn(row,"PRN_INFO_INQ_AUTR_YN", 1);
	ds_frmRol_detail.setColumn(row,"USE_YN", 1);
	
	//권한목록 그리드 활성화제어
	Div_up.grd_frmrol_Y.enable  = true;
}
/*----------------------------------------------------------------------------------------------
 * 설명   : 화면세부권한 행삭제
-----------------------------------------------------------------------------------------------*/

function fn_frmrol_dtl_delete(obj:Button,  e:ClickEventInfo)
{
	var tFrmId = ds_frmRol_Y.getColumn(Div_up.grd_frmrol_Y.currentrow, 'FRM_ID');
	if( gfn_isEmpty(tFrmId) || tFrmId == "%"){
		return;
	}
	ds_frmRol_detail.deleteRow(ds_frmRol_detail.rowposition);
}
/*----------------------------------------------------------------------------------------------
 * 설명   : 권한검색팝업
-----------------------------------------------------------------------------------------------*/
function fn_Popup_search(obj:Button,  e:ClickEventInfo)
{
	var sParam01 = div_search.edt_rollId.value;
	var sParam02 = div_search.edt_rollNm.value;
	var sParam03 = "";
	if ( e == null ) {
		sParam03 = "key";
	} else {
		sParam03 = "button";
	}
	var arrArgs = {argAutoSelect:true, argCallProgram:"FrmAutrRolMgmtM", argParam01:sParam01, argParam02:sParam02, argParam03:sParam03};
	var sRtnVal = gfn_dialog("FSC033P", arrArgs);

	if ( gfn_isNull(sRtnVal) || sRtnVal == "cancel" ) {
		//취소시 값 제거
		div_search.edt_rollId.value = "";
		div_search.edt_rollNm.value = "";
	} else {	//Object이용시
		div_search.edt_rollId.value  = sRtnVal["ROL_ID"];
		div_search.edt_rollNm.value  = sRtnVal["ROL_NM"];
		
		//값이 있는 경우 자동조회하기 
		if(!gfn_isEmpty(div_search.edt_rollId.value)) btn_search_onclick();  
	}
	div_search.edt_rollId.setFocus();
}

/*----------------------------------------------------------------------------------------------
 * 설명   :  권한있는화면목록 그리드 ondrag 이벤트
 * param   : obj - Dataset
 * param   : e  - GridDragEventInfo
 * return  : true/false
-----------------------------------------------------------------------------------------------*/
function grd_frmrol_Y_ondrag(obj:Grid, e:GridDragEventInfo)
{	
	select_data = e.row;
	//움직일 텍스트의 바인드 데이터셋 초기화 
	ds_moving.clearData();
	ds_moving.insertRow(0);
	 //선택된 데이터 복사 
	var bSucc = ds_moving.copyRow(0,ds_frmRol_Y,select_data);

	if(bSucc){
		sta_frmrol_Y_Move.text = "   "+ds_moving.getColumn(0,"MENU_ID")+"      "+ds_moving.getColumn(0,"MENU_NM");
		var objDragData:DragDataObject = new DragDataObject();
		e.dragdata = select_data; //선택된 row index를 넘기기
		
		//var cell_rect = obj.getCellRect(select_data, e.cell);
		//sta_frmrol_Y_Move.position.left = cell_rect.left;
		
		var moveX;
	    var moveY;
	    var originWidth= sta_frmrol_Y_Move.position.width;
	    var originHeight= sta_frmrol_Y_Move.position.height;
	    if( sta_frmrol_Y_Move.position.left > e.clientX){
			moveX = Div_up.grd_frmrol_Y.position.left+e.clientX;
	    } else {
			moveX = e.clientX;		
	    }
	    
	    if( sta_frmrol_Y_Move.position.top > e.clientY){
			moveY = Div_up.grd_frmrol_Y.position.top+e.clientY;
	    } else {
			moveY  = e.clientY;		
		}	
		sta_frmrol_Y_Move.position.left =moveX;		
		sta_frmrol_Y_Move.position.width =originWidth;
		sta_frmrol_Y_Move.position.height =originHeight;
		sta_frmrol_Y_Move.move( moveX, moveY );
		sta_frmrol_Y_Move.visible = true;
		
		return true;
	} else {
		return false;
	}
}
/*----------------------------------------------------------------------------------------------
 * 설명   :  권한없는화면목록 그리드 ondrag 이벤트
 * param   : obj - Dataset
 * param   : e  - GridDragEventInfo
 * return  : true/false
-----------------------------------------------------------------------------------------------*/
function grd_frmrol_N_ondrag(obj:Grid, e:GridDragEventInfo)
{
    //여러개 선택한 경우 드래그를 하지 않는다.  
     var selCnt = 0; 
     for(var i = 0; i < ds_frmRol_N.getRowCount(); i++){
		if(ds_frmRol_N.getSelect(i)){
			 selCnt++;
		}
	} //loop end	
   
    if(selCnt >1) { return; }
   
	//움직일 텍스트의 바인드 데이터셋 초기화 
	ds_moving.clearData();
	ds_moving.insertRow(0);
	 //선택된 데이터 복사 
	select_data = e.row;
	var bSucc = ds_moving.copyRow(0,ds_frmRol_N,select_data);
	
	if(bSucc){
		sta_frmrol_N_Move.text = "  "+(select_data+1)+"     "+ds_moving.getColumn(0,"MENU_ID")+"      "+ds_moving.getColumn(0,"MENU_NM");
		var objDragData:DragDataObject = new DragDataObject();
		e.dragdata = select_data; //선택된 row index를 넘기기		
	    var cell_rect = obj.getCellRect(select_data, e.cell);
	    
	    var moveX;
	    var moveY;
	    var originWidth= sta_frmrol_N_Move.position.width;
	    var originHeight= sta_frmrol_N_Move.position.height;
	    if( sta_frmrol_N_Move.position.left > e.clientX){
			moveX = Div_up.grd_frmrol_N.position.left+e.clientX;
	    } else {
			moveX = e.clientX;		
	    }
	    
	    if( sta_frmrol_N_Move.position.top > e.clientY){
			moveY = Div_up.grd_frmrol_N.position.top+e.clientY;
	    } else {
			moveY  = e.clientY;		
		}	
		sta_frmrol_N_Move.position.left =moveX;		
		sta_frmrol_N_Move.position.width =originWidth;
		sta_frmrol_N_Move.position.height =originHeight;
		sta_frmrol_N_Move.move( moveX, moveY );		
		sta_frmrol_N_Move.visible = true;
		
		return true;
	} else {
		return false;
	}
		
}

/*----------------------------------------------------------------------------------------------
 * 설명   :  권한있는화면목록 그리드 onlbuttonup 이벤트
 * param   : obj - Dataset
 * param   : e  - GridMouseEventInfo
-----------------------------------------------------------------------------------------------*/
function grd_frmrol_Y_onlbuttonup(obj:UserGrid, e:GridMouseEventInfo)
{
	//선택한 데이터가 권한있는 화면그리드범위에서 벗어난  경우에만  데이터를 이동한다. 
    if( sta_frmrol_Y_Move.visible == true ) {
	   //허용범위 구하기 
       var startX = Div_up.grd_frmrol_Y.position.left;
       var startY = Div_up.grd_frmrol_Y.position.top;
       var endX =  startX+Div_up.grd_frmrol_Y.position.width;
       var endY =  startY+ Div_up.grd_frmrol_Y.position.height;
       //움직인 static항목의 위치구하기 
       var targetX = sta_frmrol_Y_Move.position.left;
       var targetY = sta_frmrol_Y_Move.position.top;
     
     //  trace(targetX+"  "+startX + "  "+ endX+"  "+targetY+"  "+startY+"  "+endY );
     
       //endX좌표범위 밖으로 드래그했는지 확인
      if( targetX > endX ){    
			//권한삭제 
			//상위메뉴인경우 소속메뉴체크
			ds_frmRol_Y.setColumn(select_data,"CHK",1);
			fn_setCheckGridYes(select_data);
	    	Fn_Rol_delete2(); 
		}
		//static항목 비활성화 
		sta_frmrol_Y_Move.visible = false;
		Div_up.grd_frmrol_Y.selecttype="row";
		//선택row index 초기화
		select_data = "";
    }
}

/*----------------------------------------------------------------------------------------------
 * 설명   :  권한없는화면목록 그리드 onlbuttonup 이벤트
 * param   : obj - Dataset
 * param   : e  - GridMouseEventInfo
-----------------------------------------------------------------------------------------------*/
function grd_frmrol_N_onlbuttonup(obj:UserGrid, e:GridMouseEventInfo)
{
	//선택한 데이터가 권한있는 화면목록에 위치한 경우에만  데이터를 이동한다. 
    if( sta_frmrol_N_Move.visible == true ) {
	   //허용범위 구하기 
       var startX = Div_up.grd_frmrol_Y.position.left;
       var startY = Div_up.grd_frmrol_Y.position.top;
       var endX =  startX+ Div_up.grd_frmrol_Y.position.width;
       var endY =  startY+ Div_up.grd_frmrol_Y.position.height+50;
       //움직인 static항목의 위치구하기 
       var targetX = sta_frmrol_N_Move.position.left;
       var targetY = sta_frmrol_N_Move.position.top;
       
       //x좌표범위,Y좌표범위에 위치했는지 확인
      if((targetX> startX &&  targetX< endX ) && (targetY> startY && targetY < endY)){    
  
			//권한추가 
			//상위메뉴인경우 소속메뉴체크
			ds_frmRol_N.setColumn(select_data,"CHK",1);
			fn_setCheckGridNo(select_data);
	    	Fn_Rol_add2(); 
		}
		//static항목 비활성화 
		sta_frmrol_N_Move.visible = false;
		Div_up.grd_frmrol_N.selecttype="row";
		//선택row index 초기화
		select_data = "";
    }
    
}
/*----------------------------------------------------------------------------------------------
 * 설명   :  화면 form ondragmove 이벤트
 * param   : obj - Form
 * param   : e  - DragEventInfo
-----------------------------------------------------------------------------------------------*/
function BUSC011M01_ondragmove(obj:Form, e:DragEventInfo)
{
	DragTextMove(obj,e);
}
/*----------------------------------------------------------------------------------------------
 * 설명   :   선택 권한의 drag and drop 
 * param   : obj - Form
 * param   : e  - DragEventInfo
-----------------------------------------------------------------------------------------------*/
function DragTextMove(obj:Form, e:DragEventInfo)
{
	//선택한 데이터가 담긴 static의 위치를 변경한다.
    if( sta_frmrol_N_Move.visible == true ) {
		Div_up.grd_frmrol_N.selecttype="row";
		sta_frmrol_N_Move.move( e.clientX, e.clientY );
    } else if( sta_frmrol_Y_Move.visible == true ) {
		Div_up.grd_frmrol_Y.selecttype="row";
		sta_frmrol_Y_Move.move( e.clientX, e.clientY );
    } 
}
/*----------------------------------------------------------------------------------------------
 * 설명   :   권한있는화면 그리드 oncellclick 이벤트
 * param   : obj - Grid
 * param   : e  - GridClickEventInfo
-----------------------------------------------------------------------------------------------*/
function grd_frmrol_Y_oncellclick(obj:Grid, e:GridClickEventInfo)
{
	//선택한 행 체크
	fn_setCheckGridYes(ds_frmRol_Y.rowposition);

}
/*----------------------------------------------------------------------------------------------
 * 설명   :   권한있는메뉴 그리드 하위메뉴 일괄체크
-----------------------------------------------------------------------------------------------*/
function fn_setCheckGridYes(idx)
{
	var nstate = ds_frmRol_Y.getColumn(idx,"CHK");
	var nlevel = ds_frmRol_Y.getColumn(idx,"MENU_LV");	

	//하위레벨 체크
	for(var i=idx +1;i<ds_frmRol_Y.getRowCount();i++){
		if(ds_frmRol_Y.getColumn(i,"MENU_LV")!=nlevel && nlevel<ds_frmRol_Y.getColumn(i,"MENU_LV")){
			ds_frmRol_Y.updatecontrol = false;
			ds_frmRol_Y.setColumn(i,"CHK",nstate);
			ds_frmRol_Y.updatecontrol = true;
		}else{
			break;
		}
	}
	ds_frmRol_Y.updatecontrol = false;
	ds_frmRol_Y.setRowType(idx,Dataset.ROWTYPE_NORMAL);
	ds_frmRol_Y.updatecontrol = true;
}
/*----------------------------------------------------------------------------------------------
 * 설명   :   권한있는화면 그리드 oncelldblclick 이벤트
 * param   : obj - Grid
 * param   : e  - GridClickEventInfo
-----------------------------------------------------------------------------------------------*/
function grd_frmrol_Y_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	//선택한 행 index
	var idx = ds_frmRol_Y.rowposition;
	var oldRow = e.oldrow;
	var nlevel = ds_frmRol_Y.getColumn(idx,"MENU_LV");
	var frmId = ds_frmRol_Y.getColumn(idx,"FRM_ID");
	var menuNm = ds_frmRol_Y.getColumn(idx,"MENU_NM");
	var bSelect = true;
	//trace(idx);
	//권한목록에 데이터가 없는 경우 상세권한목록 데이터셋 초기화 
	if( oldRow == -1){
		fn_clearDetailDs();
	}
	
	if ( oldRow != -1 && gfn_isUpdated(ds_frmRol_detail)) {		
		if (!gfn_message("C","DMS00024","Q")){ //편집중인 데이터가 있습니다. 계속하시겠습니까?
			bSelect = false;
			ds_frmRol_Y.rowposition = oldRow;
			return;
		} else {
			ds_frmRol_detail.reset();
		}
	} 
	
	if(bSelect){
		//선택한 데이터의 화면ID가 존재하는 경우 상세권한 조회   
		if(!gfn_isEmpty(frmId) && frmId != "%"){
			ds_ncFieldMap2.setColumn(0,"FRM_ID",frmId);
			ds_ncFieldMap2.setColumn(0,"AUTR_ROL_ID", ds_ncFieldMap.getColumn(0,"AUTR_ROL_ID"));
			Div_down.stc_subTitle03.text = "[" + frmId + "] " + menuNm;
			fn_seldetailAutr();
		} else {
			//상위메뉴 클릭시 상세권한초기화 
			fn_clearDetailDs();
		}
	}
}


/*----------------------------------------------------------------------------------------------
 * 설명      :  상세권한데이터셋 초기화 
-----------------------------------------------------------------------------------------------*/
function fn_clearDetailDs(){	
	//상위메뉴 클릭시 상세권한초기화 
	Div_down.stc_subTitle03.text = "";
	Div_down.stc_subTitle03.visible = false;
	fn_setEnable("dtlSave",false);
	ds_frmRol_detail.clearData();
}
/*----------------------------------------------------------------------------------------------
 * 설명   :   권한없는화면 그리드 oncellclick 이벤트
 * param   : obj - Grid
 * param   : e  - GridClickEventInfo
-----------------------------------------------------------------------------------------------*/
function grd_frmrol_N_oncellclick(obj:Grid, e:GridClickEventInfo)
{
	//선택한 행 체크
	fn_setCheckGridNo(ds_frmRol_N.rowposition);
	
}
/*----------------------------------------------------------------------------------------------
 * 설명   :   권한없는메뉴 그리드 하위메뉴 일괄체크
-----------------------------------------------------------------------------------------------*/
function fn_setCheckGridNo(idx){	
	var nstate = ds_frmRol_N.getColumn(idx,"CHK");
	var nlevel = ds_frmRol_N.getColumn(idx,"MENU_LV");
	var tMenuId;
	//하위레벨 체크
	for(var i=idx +1;i<ds_frmRol_N.getRowCount();i++){
		tMenuId =  ds_frmRol_N.getColumn(i,"MENU_ID");
		//권한없는 것만 체크 
		if(ds_frmRol_N.getColumn(i,"MENU_LV")!=nlevel && nlevel<ds_frmRol_N.getColumn(i,"MENU_LV") ){
			if( (ds_frmRol_N.getColumn(i,"AUTR_YN")==0 && !gfn_isEmpty(ds_frmRol_N.getColumn(i,"FRM_ID")) ) || ds_frmRol_N.getCaseCount("SUP_MENU_ID == '"+tMenuId+"' && AUTR_YN == 0 ") > 0) {
				ds_frmRol_N.setColumn(i,"CHK",nstate);
			}	
		}else{
			break;
		}
	}
}]]></Script>
  </Form>
</FDL>
