<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="Form" classname="MainTemp" inheritanceid="" position="absolute 0 0 607 284" titletext="매입현황" onload="Form_onload" scrollbars="none" style="background:white;font:Dotum,10,bold antialias;">
    <Layouts>
      <Layout width="607" height="284">
        <Static id="Static05" text="w&#13;30" class="tip_guide" visible="false" anchor="default" position="absolute 0 37 30 87" positiontype="position"/>
        <Static id="Static03" text="h20" class="tip_guide" visible="false" anchor="default" position="absolute 356 264 432 284" positiontype="position"/>
        <Static id="Static11" text="h10" class="tip_guide" visible="false" anchor="default" position="absolute 92 146 168 156" positiontype="position"/>
        <Static id="Static04" text="w&#13;30" class="tip_guide" visible="false" position2="absolute l:577 w:30 t:21 h:98" positiontype="position2"/>
        <Static id="Static06" text="h30" class="tip_guide" visible="false" position="absolute 32 0 102 30"/>
        <Static id="stc_title" text="ECO사업 &lt;fc v='#ff9600'&gt;매입현황&lt;/fc&gt;" class="mainTitle" position="absolute 29 24 182 47" usedecorate="true"/>
        <Grid id="grd_main" class="grd_main_chart" taborder="3" binddataset="ds_sum" scrollbars="none" useinputpanel="false" position="absolute 29 54 158 146">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="60"/>
                <Column size="70"/>
              </Columns>
              <Rows>
                <Row size="24"/>
                <Row size="24"/>
                <Row size="24"/>
                <Row size="24"/>
              </Rows>
              <Band id="body">
                <Cell style="align:left middle;cursor:arrow;" text="전월매입"/>
                <Cell col="1" displaytype="number" style="align:right middle;padding:0 3 0 0;cursor:arrow;" text="bind:PMTH_SALE"/>
                <Cell row="1" style="align:left middle;cursor:arrow;" text="당월매입"/>
                <Cell row="1" col="1" displaytype="number" style="align:right middle;padding:0 3 0 0;cursor:arrow;" text="bind:TMTH_SALE"/>
                <Cell row="2" style="align:left middle;cursor:arrow;" text="누적매입"/>
                <Cell row="2" col="1" displaytype="number" style="align:right middle;padding:0 3 0 0;cursor:arrow;" text="bind:YR_SALE"/>
                <Cell row="3" style="align:left middle;" text="전월대비"/>
                <Cell row="3" col="1" displaytype="number" style="align:right middle;" class="main_pointDataB" text="bind:PMTH_CMPR"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static00" text="h13" class="tip_guide" visible="false" position="absolute 34 46 78 59"/>
        <ActiveX id="exFusionChart" position="absolute 170 0 607 284" useautobitmapcache="1" anchor="all" taborder="4" progid="ShockwaveFlash.ShockwaveFlash.10" windowed="true"/>
        <Static id="stc_unit" text="(단위:건)" class="sta_des_green" position="absolute 97 154 158 174" style="align:right top;"/>
        <Grid id="grd_main00" class="grd_main_chart" taborder="5" binddataset="ds_sum" scrollbars="none" useinputpanel="false" position="absolute 29 171 163 263" visible="false">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="80"/>
                <Column size="55"/>
              </Columns>
              <Rows>
                <Row size="24"/>
                <Row size="24"/>
                <Row size="24"/>
                <Row size="24"/>
              </Rows>
              <Band id="body">
                <Cell style="align:left middle;cursor:arrow;" text="전월매입금액"/>
                <Cell col="1" displaytype="number" style="align:right middle;padding:0 3 0 0;cursor:arrow;" text="bind:PMTH_SALE"/>
                <Cell row="1" style="align:left middle;cursor:arrow;" text="당월매입금액"/>
                <Cell row="1" col="1" displaytype="number" style="align:right middle;padding:0 3 0 0;cursor:arrow;" text="bind:TMTH_SALE"/>
                <Cell row="2" style="align:left middle;cursor:arrow;" text="누적매입금액"/>
                <Cell row="2" col="1" displaytype="number" style="align:right middle;padding:0 3 0 0;cursor:arrow;" text="bind:YR_SALE"/>
                <Cell row="3" style="align:left middle;" text="전월대비"/>
                <Cell row="3" col="1" displaytype="number" style="align:right middle;" class="main_pointDataB" text="bind:PMTH_CMPR"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static01" text="h10" class="tip_guide" visible="false" position="absolute 60 166 168 176"/>
        <Static id="Static02" text="h10" class="tip_guide" visible="false" position="absolute 92 262 168 272"/>
        <Static id="stc_unit00" text="(단위:천원)" class="sta_des_green" position="absolute 78 270 163 290" style="align:right top;" visible="false"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_sum" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PMTH_SALE" type="STRING" size="256"/>
          <Column id="TMTH_SALE" type="STRING" size="256"/>
          <Column id="YR_SALE" type="STRING" size="256"/>
          <Column id="PMTH_CMPR" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="PMTH_SALE">1</Col>
            <Col id="TMTH_SALE">2</Col>
            <Col id="YR_SALE">3</Col>
            <Col id="PMTH_CMPR">300%</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_pmth" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="MONTH" type="STRING" size="256"/>
          <Column id="LABEL" type="STRING" size="256"/>
          <Column id="VAL" type="INT" size="256"/>
          <Column id="EXPR_VAL" type="STRING" size="256"/>
          <Column id="COLOR" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_main" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <ConstColumn id="TITLE" type="STRING" size="30" value="월별매입현황"/>
          <ConstColumn id="XLABEL" type="STRING" size="30"/>
          <ConstColumn id="YLABEL" type="STRING" size="30"/>
          <ConstColumn id="CHART" type="STRING" size="30" value="Column3D.swf"/>
          <ConstColumn id="LINE_VAL" type="STRING" size="30" value="291"/>
          <ConstColumn id="LINE_LABEL" type="STRING" size="30" value="월평균"/>
          <Column id="MONTH" type="STRING" size="256"/>
          <Column id="LABEL" type="STRING" size="256"/>
          <Column id="VAL" type="INT" size="256"/>
          <Column id="EXPR_VAL" type="STRING" size="256"/>
          <Column id="COLOR" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind/>
    <Script type="xscript4.0"><![CDATA[/*
 * 01. 업무구분 : 공통
 * 02. 화면 : PrchPrstD.xfdl
 * 03. 화면 설명 : 매입현황
 * 04. 관련 화면/서비스 : 
 * 05. 작성자 : 개발자
 * 06. 작성일 : 2015.07.17
 * 07. 수정이력 :
 ************************************************************************************************
 *     수정일        이  름    사유
 ************************************************************************************************
 *     2015.07.17    개발자    최초 작성
 ************************************************************************************************
 */
/*===============================================================================================
 * [ PART 1 ] Form에서 Include 할 라이브러리(xjs)파일 정의
================================================================================================*/ 
include "LIB::common.xjs"; //공통함수 호출
include "LIB::comChart.xjs"; //차트함수 호출

/*===============================================================================================
 * [ PART 2 ] Form에서 사용될 전역변수를 선언
================================================================================================*/  

/*===============================================================================================
 * [ PART 3 ] Form Event 처리
================================================================================================*/
/*----------------------------------------------------------------------------------------------
 * Notice   : Form onload
-----------------------------------------------------------------------------------------------*/
function Form_onload(obj:Form, e:LoadEventInfo)
{
 	//공통 Form 초기화
	//gfn_setInitForm(obj, e, "FSC028D");
 	//Form 초기 개발자 셋팅
 	//공통코드 초기화
 	fn_setInitCode(obj, e);
 	//그리드 초기화
 	fn_setInitGrid(obj, e);
 	//기본값 초기화
 	fn_setInitForm(obj, e);
}

/*===============================================================================================
 * [ PART 4 ] Load 후 초기설정
================================================================================================*/
/*----------------------------------------------------------------------------------------------
 * 설명   : 공통코드 초기화
-----------------------------------------------------------------------------------------------*/
function fn_setInitCode(obj:Form, e:LoadEventInfo)
{
// 	var strCode =  "DMS010=ds_DMS010=A";
// 		strCode += ",DMS011=ds_DMS011=S";	
// 		strCode += ",DMS012=ds_DMS012=N";
// 						
// 	gfn_getCodeDs( this
// 				  , strCode
// 				  ,"fn_afterCodeCallBack");
}

/*----------------------------------------------------------------------------------------------
 * 설명   : 공통코드 호출 후 처리
-----------------------------------------------------------------------------------------------*/
function fn_afterCodeCallBack()
{
// 	div_search.cbo_anncType.index=0;
// 	div_search.cbo_srchType.index=0;
// 	div_search.cbo_delYn.index=0;
}

/*----------------------------------------------------------------------------------------------
 * 설명   : 그리드 초기화
-----------------------------------------------------------------------------------------------*/
function fn_setInitGrid(obj:Form, e:LoadEventInfo)
{
	//그리드 페이징 초기화
// 	cgp_main.setPageInit("fn_selectPageExec", false);
// 	cgp_mainCnt.setPageNoCnt(0, 0, 0);	//PageNo Count
// 	
// 	page = 1;
// 	page_size = 16;
	
	// 그리드 초기화 
	//gfn_initGrid(objGrid:UserGrid, bReadonly, bSortable, bTooltip, sSelectType, innerDs, sPage, sPageSize, sTotCnt);
//	gfn_initGrid(grd_main, true, true, true, "row", null);
}

/*----------------------------------------------------------------------------------------------
 * 설명   : 페이지 Click시 페이지조회
 * param   : iTotalRowCount - 전체 Row수
 * param   : iUnitSelRowNo  - 페이지당 Row수
 * param   : iCurrPage      - 현재 페이지
 * return  : void
-----------------------------------------------------------------------------------------------*/
function fn_selectPageExec(iTotalRowCount, iUnitSelRowNo, iCurrPage)
{
	//trace("페이징처리::total row="+iTotalRowCount+"::unit row="+iUnitSelRowNo+"::current page="+iCurrPage);
	//페이징처리
// 	page = iCurrPage;
// 	fn_searchMain();
}

/*----------------------------------------------------------------------------------------------
 * 설명   : 기본값 설정
-----------------------------------------------------------------------------------------------*/
function fn_setInitForm(obj:Form, e:LoadEventInfo)
{
// 	var objBindItem1 = new BindItem();
// 	objBindItem1.init("item19", "CommMonthCalendar00.med_cal", "value", "ds_ncFieldMap", "inqYm");
// 	this.addChild("item19", objBindItem1); 
// 	objBindItem1.bind();
// 	
// 	CommMonthCalendar00.med_cal.value = gfn_getBeforeMonth(gfn_today()).substr(0,6);
	fn_searchMain();
}

/*===============================================================================================
 * [ PART 5 ] Transaction 처리
================================================================================================*/
/*----------------------------------------------------------------------------------------------
 * 설명   : 메인조회
 * param   : 
 * return  : void
-----------------------------------------------------------------------------------------------*/
function fn_searchMain()
{
	//ds_ncFieldMap.setColumn(0,"mchtNo", mchtNo);
	//ds_ncFieldMap.setColumn(0,"inqYm",CommMonthCalendar00.getDate());	
	
	var sSvcID		 = "searchMain";
	var sTrID		 = "PBCMainMgmt_pInqMthPrchsRate";
	var sPtrn		 = "R";  //입력C,조회R,수정U,삭제D,복합M
	var sInputDs	 = "";
	var sOutputDs	 = "ds_main=RS_MTH_PRCHS_RATE ds_pmth=RS_PMTH_PRCHS_RATE";
	var sArgs		 = "";
	var sCallBackFnc = "fn_callBack";
	 
	gfn_transaction(sSvcID, sTrID, sPtrn, sInputDs, sOutputDs, sArgs, sCallBackFnc, false);
}

/*===============================================================================================
 * [ PART 6 ] CallBack 처리
================================================================================================*/
function fn_callBack(sSvcID, iErrorCode, sErrorMsg, ncMsgId, ncMsg)
{
	switch(sSvcID) {
		case "searchMain": 
			if ( iErrorCode == 0 ) {
				fn_setChart();	
			}
			break;
			
		default:
			break;
	}
}

/*===============================================================================================
 * [ PART 7 ] Event Function ( Main Button )
================================================================================================*/

/*===============================================================================================
 * [ PART 8 ] Event Function ( Others )
================================================================================================*/

/*===============================================================================================
 * [ PART 9 ] User Defined
================================================================================================*/
/*----------------------------------------------------------------------------------------------
 * 설명   : Chart
-----------------------------------------------------------------------------------------------*/
function fn_setChart(){
	var nSum = toNumber(ds_main.getSum("VAL"));

	var sMonth = gfn_today().substr(0,6);
//	var sMonth = '201507';
	var nRow = ds_main.findRow("MONTH",sMonth);
	var bRow;
/*	
	if(nRow == 0) {
		bRow = 100;
	} else {
		bRow = nRow - 1;
	}
*/	
	for(var i=nRow; i<ds_main.rowcount; i++){
		ds_main.setColumn(i,"COLOR","C0C0C0");
	}
	
	var nSale = toNumber(ds_main.getColumn(nRow,"VAL")); /* 당월매입*/
	var bSale = toNumber(isNaN(ds_pmth.getColumn(ds_pmth.rowposition,"VAL"))?0:ds_pmth.getColumn(ds_pmth.rowposition,"VAL")); /* 전월매입*/
	
	
	ds_main.addConstColumn("TITLE","월별매입현황");
	ds_main.addConstColumn("XLABEL",null);
	ds_main.addConstColumn("YLABEL",null);
	ds_main.addConstColumn("CHART","Column3D.swf");
	ds_main.addConstColumn("LINE_VAL",Math.round(nSum/sMonth.substr(4,6),0));
	ds_main.addConstColumn("LINE_LABEL","월평균");
	ds_sum.setColumn(0,"PMTH_SALE", bSale);    /* 전월매입*/
	ds_sum.setColumn(0,"TMTH_SALE", nSale);    /* 당월매입*/
	ds_sum.setColumn(0,"YR_SALE", nSum);       /* 누적매입*/
	var nCmpr; /* 전월대비*/
	if(bSale == 0) {
		nCmpr = 0;
	} else {
		//nCmpr = Math.round((nSale - bSale) / bSale,2)*100;
		nCmpr = Math.round(Math.round(((nSale - bSale) / bSale) ,2)*100);       //전월대비 : ((당월매입-전월매입)/전월매입)*100  
	}
	
	if(nCmpr <= 0) {
		grd_main.setCellProperty("body", grd_main.getBindCellIndex("body","PMTH_CMPR"), "class", "main_pointDataB");
	} else {
		grd_main.setCellProperty("body", grd_main.getBindCellIndex("body","PMTH_CMPR"), "class", "main_pointDataR");
	}
	ds_sum.setColumn(0,"PMTH_CMPR", nCmpr + "%");
	
	//gfn_drawMainColumn3D(exFusionChart, ds_main); 
	gfn_drawMainMSCombi2D(exFusionChart, ds_main);  //차트함수
}
]]></Script>
  </Form>
</FDL>
